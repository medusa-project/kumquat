import{a as Kt}from"./chunk-3UUJB7QR.js";import{a as Jt}from"./chunk-BRTUPEM7.js";import{a as Qt}from"./chunk-CHPN5XCG.js";import{a as Xt}from"./chunk-JVBOML4F.js";import{b as Vt,c as ci,d as xe,e as di,f as Gt,g as Re,h as Wt}from"./chunk-AQ772LKB.js";import{a as ve}from"./chunk-2SUYJOML.js";import{c as Ft,d as ot,e as _e,f as zt,h as rt,i as Ut,k as jt,l as Zt,m as qt}from"./chunk-4BC26SXO.js";import{a as ft,b as mt,c as st}from"./chunk-UYLDA6E6.js";import{a as dt,b as he,e as gt,f as Dt,g as Ye,h as pt,i as Nt,n as ge,p as E}from"./chunk-2YE6NNA6.js";import{a as Ne}from"./chunk-T6TTLDCO.js";import{a as Lt,b as Le,c as Mt,e as kt,g as $e}from"./chunk-MP7EINQY.js";import{b as Ht,c as Se}from"./chunk-YAXTLTJC.js";var at=Ht((exports,module)=>{function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}(function(t){t.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(s){return t.type(s)==="function"},t.isArray=Array.isArray||function(s){return t.type(s)==="array"},t.isWindow=function(s){return s&&typeof s=="object"&&"setInterval"in s},t.type=function(s){return s==null?String(s):e[i.call(s)]||"object"},t.isPlainObject=function(s){if(!s||OpenSeadragon.type(s)!=="object"||s.nodeType||t.isWindow(s)||s.constructor&&!n.call(s,"constructor")&&!n.call(s.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var a in s)o=a;return o===void 0||n.call(s,o)},t.isEmptyObject=function(s){for(var o in s)return!1;return!0},t.freezeObject=function(s){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(o){return o},t.freezeObject(s)},t.supportsCanvas=function(){var s=document.createElement("canvas");return!!(t.isFunction(s.getContext)&&s.getContext("2d"))}(),t.isCanvasTainted=function(s){var o=!1;try{s.getContext("2d").getImageData(0,0,1,1)}catch{o=!0}return o},t.pixelDensityRatio=function(){if(t.supportsCanvas){var s=document.createElement("canvas").getContext("2d"),o=window.devicePixelRatio||1,a=s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1;return Math.max(o,1)/a}else return 1}()})(OpenSeadragon);(function($){$.extend=function(){var t,e,i,n,s,o,a=arguments[0]||{},r=arguments.length,d=!1,c=1;for(typeof a=="boolean"&&(d=a,a=arguments[1]||{},c=2),typeof a!="object"&&!OpenSeadragon.isFunction(a)&&(a={}),r===c&&(a=this,--c);c<r;c++)if(t=arguments[c],t!==null||t!==void 0)for(e in t)i=a[e],n=t[e],a!==n&&(d&&n&&(OpenSeadragon.isPlainObject(n)||(s=OpenSeadragon.isArray(n)))?(s?(s=!1,o=i&&OpenSeadragon.isArray(i)?i:[]):o=i&&OpenSeadragon.isPlainObject(i)?i:{},a[e]=OpenSeadragon.extend(d,o,n)):n!==void 0&&(a[e]=n));return a};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var t=navigator.userAgent;return typeof t!="string"?!1:t.indexOf("iPhone")!==-1||t.indexOf("iPad")!==-1||t.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(t,e){return function(){var i=arguments;return i===void 0&&(i=[]),e.apply(t,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(t){return typeof t=="string"&&(t=document.getElementById(t)),t},getElementPosition:function(t){var e=new $.Point,i,n;for(t=$.getElement(t),i=$.getElementStyle(t).position=="fixed",n=getOffsetParent(t,i);n;)e.x+=t.offsetLeft,e.y+=t.offsetTop,i&&(e=e.plus($.getPageScroll())),t=n,i=$.getElementStyle(t).position=="fixed",n=getOffsetParent(t,i);return e},getElementOffset:function(t){t=$.getElement(t);var e=t&&t.ownerDocument,i,n,s={top:0,left:0};return e?(i=e.documentElement,typeof t.getBoundingClientRect!="undefined"&&(s=t.getBoundingClientRect()),n=e==e.window?e:e.nodeType===9?e.defaultView||e.parentWindow:!1,new $.Point(s.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0),s.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0))):new $.Point},getElementSize:function(t){return t=$.getElement(t),new $.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=$.getElement(t),t.currentStyle}:function(t){return t=$.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var e={};return $.getCssPropertyWithVendorPrefix=function(i){if(e[i]!==void 0)return e[i];var n=document.createElement("div").style,s=null;if(n[i]!==void 0)s=i;else for(var o=["Webkit","Moz","MS","O","webkit","moz","ms","o"],a=$.capitalizeFirstLetter(i),r=0;r<o.length;r++){var d=o[r]+a;if(n[d]!==void 0){s=d;break}}return e[i]=s,s},$.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},positiveModulo:function(t,e){var i=t%e;return i<0&&(i+=e),i},pointInElement:function(t,e){t=$.getElement(t);var i=$.getElementOffset(t),n=$.getElementSize(t);return e.x>=i.x&&e.x<i.x+n.x&&e.y<i.y+n.y&&e.y>=i.y},getEvent:function(t){return t?$.getEvent=function(e){return e}:$.getEvent=function(){return window.event},$.getEvent(t)},getMousePosition:function(t){if(typeof t.pageX=="number")$.getMousePosition=function(e){var i=new $.Point;return e=$.getEvent(e),i.x=e.pageX,i.y=e.pageY,i};else if(typeof t.clientX=="number")$.getMousePosition=function(e){var i=new $.Point;return e=$.getEvent(e),i.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,i};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},e=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(e.scrollLeft||e.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(t){if(typeof window.scrollTo!="undefined")$.setPageScroll=function(n){window.scrollTo(n.x,n.y)};else{var e=$.getPageScroll();if(e.x===t.x&&e.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var i=$.getPageScroll();if(i.x!==e.x&&i.y!==e.y){$.setPageScroll=function(n){document.body.scrollLeft=n.x,document.body.scrollTop=n.y};return}if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,i=$.getPageScroll(),i.x!==e.x&&i.y!==e.y){$.setPageScroll=function(n){document.documentElement.scrollLeft=n.x,document.documentElement.scrollTop=n.y};return}$.setPageScroll=function(n){}}return $.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},e=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(t){t=$.getElement(t);var e=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(e[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(e[1].style,{display:"table-row"}),$.extend(e[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),e[0].appendChild(e[1]),e[1].appendChild(e[2]),e[2].appendChild(t),e[0]},makeNeutralElement:function(t){var e=document.createElement(t),i=e.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",e},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(t){return $.makeTransparentImage=function(e){var i=$.makeNeutralElement("img");return i.src=e,i},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var i=$.makeNeutralElement("img"),n=null;return n=$.makeNeutralElement("span"),n.style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=e,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",n}),$.makeTransparentImage(t)},setElementOpacity:function(t,e,i){var n,s;t=$.getElement(t),i&&!$.Browser.alpha&&(e=Math.round(e)),$.Browser.opacity?t.style.opacity=e<1?e:"":e<1?(n=Math.round(100*e),s="alpha(opacity="+n+")",t.style.filter=s):t.style.filter=""},setElementTouchActionNone:function(t){t=$.getElement(t),typeof t.style.touchAction!="undefined"?t.style.touchAction="none":typeof t.style.msTouchAction!="undefined"&&(t.style.msTouchAction="none")},addClass:function(t,e){t=$.getElement(t),t.className?(" "+t.className+" ").indexOf(" "+e+" ")===-1&&(t.className+=" "+e):t.className=e},indexOf:function(t,e,i){return Array.prototype.indexOf?this.indexOf=function(n,s,o){return n.indexOf(s,o)}:this.indexOf=function(n,s,o){var a,r=o||0,d;if(!n)throw new TypeError;if(d=n.length,d===0||r>=d)return-1;for(r<0&&(r=d-Math.abs(r)),a=r;a<d;a++)if(n[a]===s)return a;return-1},this.indexOf(t,e,i)},removeClass:function(t,e){var i,n=[],s;for(t=$.getElement(t),i=t.className.split(/\s+/),s=0;s<i.length;s++)i[s]&&i[s]!==e&&n.push(i[s]);t.className=n.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,e,i,n){t=$.getElement(t),t.addEventListener(e,i,n)};if(window.attachEvent)return function(t,e,i,n){t=$.getElement(t),t.attachEvent("on"+e,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,e,i,n){t=$.getElement(t),t.removeEventListener(e,i,n)};if(window.detachEvent)return function(t,e,i,n){t=$.getElement(t),t.detachEvent("on"+e,i)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=$.getEvent(t),t.preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){e=$.getEvent(e),e.cancel=!0,e.returnValue=!1},$.cancelEvent(t)},stopEvent:function(t){t=$.getEvent(t),t.stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){e=$.getEvent(e),e.cancelBubble=!0},$.stopEvent(t)},createCallback:function(t,e){var i=[],n;for(n=2;n<arguments.length;n++)i.push(arguments[n]);return function(){var s=i.concat([]),o;for(o=0;o<arguments.length;o++)s.push(arguments[o]);return e.apply(t,s)}},getUrlParameter:function(t){var e=URLPARAMS[t];return e||null},getUrlProtocol:function(t){var e=t.match(/^([a-z]+:)\/\//i);return e===null?window.location.protocol:e[1].toLowerCase()},createAjaxRequest:function(t){var e;try{e=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{e=!1}if(e)window.XMLHttpRequest?$.createAjaxRequest=function(i){return i?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(t)},makeAjaxRequest:function(t,e,i){var n,s,o;$.isPlainObject(t)&&(e=t.success,i=t.error,n=t.withCredentials,s=t.headers,o=t.responseType||null,t=t.url);var a=$.getUrlProtocol(t),r=$.createAjaxRequest(a==="file:");if(!$.isFunction(e))throw new Error("makeAjaxRequest requires a success callback");r.onreadystatechange=function(){r.readyState==4&&(r.onreadystatechange=function(){},r.status>=200&&r.status<300||r.status===0&&a!=="http:"&&a!=="https:"?e(r):($.console.log("AJAX request returned %d: %s",r.status,t),$.isFunction(i)&&i(r)))};try{if(r.open("GET",t,!0),o&&(r.responseType=o),s)for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&s[d]&&r.setRequestHeader(d,s[d]);n&&(r.withCredentials=!0),r.send(null)}catch(y){var c=y.message,p=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(p&&typeof y.number!="undefined"&&y.number==-2147024891&&(c+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",y.name,c),r.onreadystatechange=function(){},window.XDomainRequest){var w=new window.XDomainRequest;if(w){w.onload=function(R){$.isFunction(e)&&e({responseText:w.responseText,status:200,statusText:"OK"})},w.onerror=function(R){$.isFunction(i)&&i({responseText:w.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{w.open("GET",t),w.send()}catch{$.isFunction(i)&&i(r,y)}}}else $.isFunction(i)&&i(r,y)}return r},jsonp:function(t){var e,i=t.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=t.callbackName||"openseadragon"+$.now(),o=window[s],a="$1"+s+"$2",r=t.param||"callback",d=t.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,a),i+=(/\?/.test(i)?"&":"?")+r+"="+s,window[s]=function(c){if(o)window[s]=o;else try{delete window[s]}catch{}d&&$.isFunction(d)&&d(c)},e=document.createElement("script"),(t.async!==void 0||t.async!==!1)&&(e.async="async"),t.scriptCharset&&(e.charset=t.scriptCharset),e.src=i,e.onload=e.onreadystatechange=function(c,p){(p||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,n&&e.parentNode&&n.removeChild(e),e=void 0)},n.insertBefore(e,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)$.parseXml=function(e){var i=null,n;return n=new DOMParser,i=n.parseFromString(e,"text/xml"),i};else if(window.ActiveXObject)$.parseXml=function(e){var i=null;return i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e),i};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(t)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(t){return t=t||"",!!FILEFORMATS[t.toLowerCase()]}});var nullfunction=function(t){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var t=navigator.appVersion,e=navigator.userAgent,i;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(e.substring(e.indexOf("MSIE")+5,e.indexOf(";",e.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(e.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(e.substring(e.indexOf("Firefox")+8))):e.indexOf("Safari")>=0?($.Browser.vendor=e.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(e.substring(e.substring(0,e.indexOf("Safari")).lastIndexOf("/")+1,e.indexOf("Safari")))):(i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),i.exec(e)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(t);break}var n=window.location.search.substring(1),s=n.split("&"),o,a,r;for(r=0;r<s.length;r++)if(o=s[r],a=o.indexOf("="),a>0){var d=o.substring(0,a),c=o.substring(a+1);try{URLPARAMS[d]=decodeURIComponent(c)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",d,c)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(t){var e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,i=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(e&&i)$.requestAnimationFrame=function(){return e.apply(t,arguments)},$.cancelAnimationFrame=function(){return i.apply(t,arguments)};else{var n=[],s=[],o=0,a;$.requestAnimationFrame=function(r){return n.push([++o,r]),a||(a=setInterval(function(){if(n.length){var d=$.now(),c=s;for(s=n,n=c;s.length;)s.shift()[1](d)}else clearInterval(a),a=void 0},1e3/50)),o},$.cancelAnimationFrame=function(r){var d,c;for(d=0,c=n.length;d<c;d+=1)if(n[d][0]===r){n.splice(d,1);return}for(d=0,c=s.length;d<c;d+=1)if(s[d][0]===r){s.splice(d,1);return}}}}(window);function getOffsetParent(t,e){return e&&t!=document.body?document.body:t.offsetParent}})(OpenSeadragon);(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof module=="object"&&module.exports?module.exports=e():t.OpenSeadragon=e()})(exports,function(){return OpenSeadragon});(function(t){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.fullscreenElement},e.requestFullScreen=function(i){return i.requestFullscreen()},e.exitFullScreen=function(){document.exitFullscreen()},e.fullScreenEventName="fullscreenchange",e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.msFullscreenElement},e.requestFullScreen=function(i){return i.msRequestFullscreen()},e.exitFullScreen=function(){document.msExitFullscreen()},e.fullScreenEventName="MSFullscreenChange",e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitFullscreenElement},e.requestFullScreen=function(i){return i.webkitRequestFullscreen()},e.exitFullScreen=function(){document.webkitExitFullscreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},e.requestFullScreen=function(i){return i.webkitRequestFullScreen()},e.exitFullScreen=function(){document.webkitCancelFullScreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.mozFullScreenElement},e.requestFullScreen=function(i){return i.mozRequestFullScreen()},e.exitFullScreen=function(){document.mozCancelFullScreen()},e.fullScreenEventName="mozfullscreenchange",e.fullScreenErrorEventName="mozfullscreenerror"),e.isFullScreen=function(){return e.getFullScreenElement()!==null},e.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),e.exitFullScreen()},t.extend(t,e)})(OpenSeadragon);(function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(e,i,n,s){var o=this;s=s||1;var a=0,r=function(d){a++,a===s&&o.removeHandler(e,r),i(d)};this.addHandler(e,r,n)},addHandler:function(e,i,n){var s=this.events[e];s||(this.events[e]=s=[]),i&&t.isFunction(i)&&(s[s.length]={handler:i,userData:n||null})},removeHandler:function(e,i){var n=this.events[e],s=[],o;if(!!n&&t.isArray(n)){for(o=0;o<n.length;o++)n[o].handler!==i&&s.push(n[o]);this.events[e]=s}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(e){var i=this.events[e];return!i||!i.length?null:(i=i.length===1?[i[0]]:Array.apply(null,i),function(n,s){var o,a=i.length;for(o=0;o<a;o++)i[o]&&(s.eventSource=n,s.userData=i[o].userData,i[o].handler(s))})},raiseEvent:function(e,i){var n=this.getHandler(e);n&&(i||(i={}),n(this,i))}}})(OpenSeadragon);(function(t){var e=[],i={};t.MouseTracker=function(g){e.push(this);var u=arguments;t.isPlainObject(g)||(g={element:u[0],clickTimeThreshold:u[1],clickDistThreshold:u[2]}),this.hash=Math.random(),this.element=t.getElement(g.element),this.clickTimeThreshold=g.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=g.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=g.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=g.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=g.userData||null,this.stopDelay=g.stopDelay||50,this.enterHandler=g.enterHandler||null,this.exitHandler=g.exitHandler||null,this.pressHandler=g.pressHandler||null,this.nonPrimaryPressHandler=g.nonPrimaryPressHandler||null,this.releaseHandler=g.releaseHandler||null,this.nonPrimaryReleaseHandler=g.nonPrimaryReleaseHandler||null,this.moveHandler=g.moveHandler||null,this.scrollHandler=g.scrollHandler||null,this.clickHandler=g.clickHandler||null,this.dblClickHandler=g.dblClickHandler||null,this.dragHandler=g.dragHandler||null,this.dragEndHandler=g.dragEndHandler||null,this.pinchHandler=g.pinchHandler||null,this.stopHandler=g.stopHandler||null,this.keyDownHandler=g.keyDownHandler||null,this.keyUpHandler=g.keyUpHandler||null,this.keyHandler=g.keyHandler||null,this.focusHandler=g.focusHandler||null,this.blurHandler=g.blurHandler||null;var m=this;i[this.hash]={click:function(v){b(m,v)},dblclick:function(v){N(m,v)},keydown:function(v){h(m,v)},keyup:function(v){x(m,v)},keypress:function(v){T(m,v)},focus:function(v){S(m,v)},blur:function(v){P(m,v)},wheel:function(v){O(m,v)},mousewheel:function(v){M(m,v)},DOMMouseScroll:function(v){M(m,v)},MozMousePixelScroll:function(v){M(m,v)},mouseenter:function(v){Q(m,v)},mouseleave:function(v){X(m,v)},mouseover:function(v){V(m,v)},mouseout:function(v){oe(m,v)},mousedown:function(v){se(m,v)},mouseup:function(v){G(m,v)},mouseupcaptured:function(v){pe(m,v)},mousemove:function(v){ke(m,v)},mousemovecaptured:function(v){Fe(m,v)},touchstart:function(v){be(m,v)},touchend:function(v){Ue(m,v)},touchendcaptured:function(v){je(m,v)},touchmove:function(v){Ze(m,v)},touchmovecaptured:function(v){qe(m,v)},touchcancel:function(v){Be(m,v)},gesturestart:function(v){Xe(m,v)},gesturechange:function(v){l(m,v)},pointerover:function(v){f(m,v)},MSPointerOver:function(v){f(m,v)},pointerout:function(v){C(m,v)},MSPointerOut:function(v){C(m,v)},pointerdown:function(v){A(m,v)},MSPointerDown:function(v){A(m,v)},pointerup:function(v){H(m,v)},MSPointerUp:function(v){H(m,v)},pointermove:function(v){z(m,v)},MSPointerMove:function(v){z(m,v)},pointercancel:function(v){Z(m,v)},MSPointerCancel:function(v){Z(m,v)},pointerupcaptured:function(v){D(m,v)},pointermovecaptured:function(v){q(m,v)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},g.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var g;for(o(this),this.element=null,g=0;g<e.length;g++)if(e[g]===this){e.splice(g,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(g){return g?s(this):o(this),this},getActivePointersListsExceptType:function(g){for(var u=i[this.hash],m=[],v=0;v<u.activePointersLists.length;++v)u.activePointersLists[v].type!==g&&m.push(u.activePointersLists[v]);return m},getActivePointersListByType:function(g){var u=i[this.hash],m,v=u.activePointersLists.length,B;for(m=0;m<v;m++)if(u.activePointersLists[m].type===g)return u.activePointersLists[m];return B=new t.MouseTracker.GesturePointList(g),u.activePointersLists.push(B),B},getActivePointerCount:function(){var g=i[this.hash],u,m=g.activePointersLists.length,v=0;for(u=0;u<m;u++)v+=g.activePointersLists[u].getLength();return v},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},t.MouseTracker.resetAllMouseTrackers=function(){for(var g=0;g<e.length;g++)e[g].isTracking()&&(e[g].setTracking(!1),e[g].setTracking(!0))},t.MouseTracker.gesturePointVelocityTracker=function(){var g=[],u=0,m=0,v=function(k,J){return k.hash.toString()+J.type+J.id.toString()},B=function(){var k,J=g.length,te,ie,de=t.now(),ee,Qe,Ke;for(ee=de-m,m=de,k=0;k<J;k++)te=g[k],ie=te.gPoint,ie.direction=Math.atan2(ie.currentPos.y-te.lastPos.y,ie.currentPos.x-te.lastPos.x),Qe=te.lastPos.distanceTo(ie.currentPos),te.lastPos=ie.currentPos,Ke=1e3*Qe/(ee+1),ie.speed=.75*Ke+.25*ie.speed},W=function(k,J){var te=v(k,J);g.push({guid:te,gPoint:J,lastPos:J.currentPos}),g.length===1&&(m=t.now(),u=window.setInterval(B,50))},F=function(k,J){var te=v(k,J),ie,de=g.length;for(ie=0;ie<de;ie++)if(g[ie].guid===te){g.splice(ie,1),de--,de===0&&window.clearInterval(u);break}};return{addPoint:W,removePoint:F}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor==t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.supportsMouseCapture=function(){var g=document.createElement("div");return t.isFunction(g.setCapture)&&t.isFunction(g.releaseCapture)}(),t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName=="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||t.Browser.vendor!==t.BROWSERS.IE)?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),t.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):(t.MouseTracker.havePointerEvents=!1,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?(t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),t.MouseTracker.haveMouseEnter=!0):(t.MouseTracker.subscribeEvents.push("mouseover","mouseout"),t.MouseTracker.haveMouseEnter=!1),t.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.maxTouchPoints=10),t.MouseTracker.GesturePointList=function(g){this._gPoints=[],this.type=g,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(g){return this._gPoints.push(g)},removeById:function(g){var u,m=this._gPoints.length;for(u=0;u<m;u++)if(this._gPoints[u].id===g){this._gPoints.splice(u,1);break}return this._gPoints.length},getByIndex:function(g){return g<this._gPoints.length?this._gPoints[g]:null},getById:function(g){var u,m=this._gPoints.length;for(u=0;u<m;u++)if(this._gPoints[u].id===g)return this._gPoints[u];return null},getPrimary:function(g){var u,m=this._gPoints.length;for(u=0;u<m;u++)if(this._gPoints[u].isPrimary)return this._gPoints[u];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function n(g){var u=i[g.hash],m,v=u.activePointersLists.length;for(m=0;m<v;m++)u.activePointersLists[m].captureCount>0&&(t.removeEvent(t.MouseTracker.captureElement,"mousemove",u.mousemovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"mouseup",u.mouseupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",u.pointermovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",u.pointerupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchmove",u.touchmovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchend",u.touchendcaptured,!0),u.activePointersLists[m].captureCount=0);for(m=0;m<v;m++)u.activePointersLists.pop()}function s(g){var u=i[g.hash],m,v;if(!u.tracking){for(v=0;v<t.MouseTracker.subscribeEvents.length;v++)m=t.MouseTracker.subscribeEvents[v],t.addEvent(g.element,m,u[m],!1);n(g),u.tracking=!0}}function o(g){var u=i[g.hash],m,v;if(u.tracking){for(v=0;v<t.MouseTracker.subscribeEvents.length;v++)m=t.MouseTracker.subscribeEvents[v],t.removeEvent(g.element,m,u[m],!1);n(g),u.tracking=!1}}function a(g,u){var m=i[g.hash];if(u==="pointerevent")return{upName:t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:m.pointerupcaptured,moveName:t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:m.pointermovecaptured};if(u==="mouse")return{upName:"mouseup",upHandler:m.mouseupcaptured,moveName:"mousemove",moveHandler:m.mousemovecaptured};if(u==="touch")return{upName:"touchend",upHandler:m.touchendcaptured,moveName:"touchmove",moveHandler:m.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function r(g,u,m){var v=g.getActivePointersListByType(u),B;v.captureCount+=m||1,v.captureCount===1&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?g.element.setCapture(!0):(B=a(g,t.MouseTracker.havePointerEvents?"pointerevent":u),At&&Bt(window.top)&&t.addEvent(window.top,B.upName,B.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,B.upName,B.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,B.moveName,B.moveHandler,!0)))}function d(g,u,m){var v=g.getActivePointersListByType(u),B;v.captureCount-=m||1,v.captureCount===0&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?g.element.releaseCapture():(B=a(g,t.MouseTracker.havePointerEvents?"pointerevent":u),At&&Bt(window.top)&&t.removeEvent(window.top,B.upName,B.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,B.moveName,B.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,B.upName,B.upHandler,!0)))}function c(g){var u;if(t.MouseTracker.unprefixedPointerEvents)u=g.pointerType;else switch(g.pointerType){case 2:u="touch";break;case 3:u="pen";break;case 4:u="mouse";break;default:u=""}return u}function p(g){return t.getMousePosition(g)}function w(g,u){return y(p(g),u)}function y(g,u){var m=t.getElementOffset(u);return g.minus(m)}function R(g,u){return new t.Point((g.x+u.x)/2,(g.y+u.y)/2)}function b(g,u){g.clickHandler&&t.cancelEvent(u)}function N(g,u){g.dblClickHandler&&t.cancelEvent(u)}function h(g,u){var m;g.keyDownHandler&&(u=t.getEvent(u),m=g.keyDownHandler({eventSource:g,keyCode:u.keyCode?u.keyCode:u.charCode,ctrl:u.ctrlKey,shift:u.shiftKey,alt:u.altKey,meta:u.metaKey,originalEvent:u,preventDefaultAction:!1,userData:g.userData}),m||t.cancelEvent(u))}function x(g,u){var m;g.keyUpHandler&&(u=t.getEvent(u),m=g.keyUpHandler({eventSource:g,keyCode:u.keyCode?u.keyCode:u.charCode,ctrl:u.ctrlKey,shift:u.shiftKey,alt:u.altKey,meta:u.metaKey,originalEvent:u,preventDefaultAction:!1,userData:g.userData}),m||t.cancelEvent(u))}function T(g,u){var m;g.keyHandler&&(u=t.getEvent(u),m=g.keyHandler({eventSource:g,keyCode:u.keyCode?u.keyCode:u.charCode,ctrl:u.ctrlKey,shift:u.shiftKey,alt:u.altKey,meta:u.metaKey,originalEvent:u,preventDefaultAction:!1,userData:g.userData}),m||t.cancelEvent(u))}function S(g,u){var m;g.focusHandler&&(u=t.getEvent(u),m=g.focusHandler({eventSource:g,originalEvent:u,preventDefaultAction:!1,userData:g.userData}),m===!1&&t.cancelEvent(u))}function P(g,u){var m;g.blurHandler&&(u=t.getEvent(u),m=g.blurHandler({eventSource:g,originalEvent:u,preventDefaultAction:!1,userData:g.userData}),m===!1&&t.cancelEvent(u))}function O(g,u){L(g,u,u)}function M(g,u){u=t.getEvent(u);var m={target:u.target||u.srcElement,type:"wheel",shiftKey:u.shiftKey||!1,clientX:u.clientX,clientY:u.clientY,pageX:u.pageX?u.pageX:u.clientX,pageY:u.pageY?u.pageY:u.clientY,deltaMode:u.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName=="mousewheel"?m.deltaY=-u.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:m.deltaY=u.detail,L(g,m,u)}function L(g,u,m){var v=0,B;v=u.deltaY<0?1:-1,g.scrollHandler&&(B=g.scrollHandler({eventSource:g,pointerType:"mouse",position:w(u,g.element),scroll:v,shift:u.shiftKey,isTouchEvent:!1,originalEvent:m,preventDefaultAction:!1,userData:g.userData}),B===!1&&t.cancelEvent(m))}function U(g,u){if(g===u)return!1;for(;u&&u!==g;)u=u.parentNode;return u===g}function Q(g,u){u=t.getEvent(u),Y(g,u)}function V(g,u){u=t.getEvent(u),!(u.currentTarget===u.relatedTarget||U(u.currentTarget,u.relatedTarget))&&Y(g,u)}function Y(g,u){var m={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:p(u),currentTime:t.now()};we(g,u,[m])}function X(g,u){u=t.getEvent(u),re(g,u)}function oe(g,u){u=t.getEvent(u),!(u.currentTarget===u.relatedTarget||U(u.currentTarget,u.relatedTarget))&&re(g,u)}function re(g,u){var m={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:p(u),currentTime:t.now()};Ee(g,u,[m])}function le(g){return t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?g===1?0:g===2?2:g===4?1:-1:g}function se(g,u){var m;u=t.getEvent(u),m={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:p(u),currentTime:t.now()},ht(g,u,[m],le(u.button))&&(t.stopEvent(u),r(g,"mouse")),(g.clickHandler||g.dblClickHandler||g.pressHandler||g.dragHandler||g.dragEndHandler)&&t.cancelEvent(u)}function G(g,u){Oe(g,u)}function pe(g,u){Oe(g,u),t.stopEvent(u)}function Oe(g,u){var m;u=t.getEvent(u),m={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:p(u),currentTime:t.now()},Je(g,u,[m],le(u.button))&&d(g,"mouse")}function ke(g,u){Te(g,u)}function Fe(g,u){Te(g,u),t.stopEvent(u)}function Te(g,u){var m;u=t.getEvent(u),m={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:p(u),currentTime:t.now()},ut(g,u,[m])}function Ae(g,u,m){var v,B=m.getLength(),W=[];if(m.type==="touch"||m.contacts>0){for(v=0;v<B;v++)W.push(m.getByIndex(v));W.length>0&&(Je(g,u,W,0),m.captureCount=1,d(g,m.type),Ee(g,u,W))}}function be(g,u){var m,v,B,W=u.changedTouches.length,F=[],k,J=g.getActivePointersListByType("touch");for(m=t.now(),J.getLength()>u.touches.length-W&&(t.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Ae(g,u,J)),v=0;v<W;v++)F.push({id:u.changedTouches[v].identifier,type:"touch",currentPos:p(u.changedTouches[v]),currentTime:m});for(we(g,u,F),v=0;v<e.length;v++)if(e[v]!==g&&e[v].isTracking()&&U(e[v].element,g.element)){for(k=[],B=0;B<W;B++)k.push({id:u.changedTouches[B].identifier,type:"touch",currentPos:p(u.changedTouches[B]),currentTime:m});we(e[v],u,k)}ht(g,u,F,0)&&(t.stopEvent(u),r(g,"touch",W)),t.cancelEvent(u)}function Ue(g,u){Ve(g,u)}function je(g,u){Ve(g,u),t.stopEvent(u)}function Ve(g,u){var m,v,B,W=u.changedTouches.length,F=[],k;for(m=t.now(),v=0;v<W;v++)F.push({id:u.changedTouches[v].identifier,type:"touch",currentPos:p(u.changedTouches[v]),currentTime:m});for(Je(g,u,F,0)&&d(g,"touch",W),Ee(g,u,F),v=0;v<e.length;v++)if(e[v]!==g&&e[v].isTracking()&&U(e[v].element,g.element)){for(k=[],B=0;B<W;B++)k.push({id:u.changedTouches[B].identifier,type:"touch",currentPos:p(u.changedTouches[B]),currentTime:m});Ee(e[v],u,k)}t.cancelEvent(u)}function Ze(g,u){Ge(g,u)}function qe(g,u){Ge(g,u),t.stopEvent(u)}function Ge(g,u){var m,v=u.changedTouches.length,B=[];for(m=0;m<v;m++)B.push({id:u.changedTouches[m].identifier,type:"touch",currentPos:p(u.changedTouches[m]),currentTime:t.now()});ut(g,u,B),t.cancelEvent(u)}function Be(g,u){var m=g.getActivePointersListByType("touch");Ae(g,u,m)}function Xe(g,u){return u.stopPropagation(),u.preventDefault(),!1}function l(g,u){return u.stopPropagation(),u.preventDefault(),!1}function f(g,u){var m;u.currentTarget===u.relatedTarget||U(u.currentTarget,u.relatedTarget)||(m={id:u.pointerId,type:c(u),isPrimary:u.isPrimary,currentPos:p(u),currentTime:t.now()},we(g,u,[m]))}function C(g,u){var m;u.currentTarget===u.relatedTarget||U(u.currentTarget,u.relatedTarget)||(m={id:u.pointerId,type:c(u),isPrimary:u.isPrimary,currentPos:p(u),currentTime:t.now()},Ee(g,u,[m]))}function A(g,u){var m;m={id:u.pointerId,type:c(u),isPrimary:u.isPrimary,currentPos:p(u),currentTime:t.now()},ht(g,u,[m],u.button)&&(t.stopEvent(u),r(g,m.type)),(g.clickHandler||g.dblClickHandler||g.pressHandler||g.dragHandler||g.dragEndHandler||g.pinchHandler)&&t.cancelEvent(u)}function H(g,u){_(g,u)}function D(g,u){var m=g.getActivePointersListByType(c(u));m.getById(u.pointerId)&&_(g,u),t.stopEvent(u)}function _(g,u){var m;m={id:u.pointerId,type:c(u),isPrimary:u.isPrimary,currentPos:p(u),currentTime:t.now()},Je(g,u,[m],u.button)&&d(g,m.type)}function z(g,u){K(g,u)}function q(g,u){var m=g.getActivePointersListByType(c(u));m.getById(u.pointerId)&&K(g,u),t.stopEvent(u)}function K(g,u){var m;m={id:u.pointerId,type:c(u),isPrimary:u.isPrimary,currentPos:p(u),currentTime:t.now()},ut(g,u,[m])}function Z(g,u){var m;m={id:u.pointerId,type:c(u)},li(g,u,[m])}function ce(g,u){return Object.prototype.hasOwnProperty.call(u,"isPrimary")||(g.getLength()===0?u.isPrimary=!0:u.isPrimary=!1),u.speed=0,u.direction=0,u.contactPos=u.currentPos,u.contactTime=u.currentTime,u.lastPos=u.currentPos,u.lastTime=u.currentTime,g.add(u)}function ne(g,u){var m,v;return g.getById(u.id)?(m=g.removeById(u.id),Object.prototype.hasOwnProperty.call(u,"isPrimary")||(v=g.getPrimary(),v||(v=g.getByIndex(0),v&&(v.isPrimary=!0)))):m=g.getLength(),m}function we(g,u,m){var v=g.getActivePointersListByType(m[0].type),B,W=m.length,F,k,J;for(B=0;B<W;B++)F=m[B],k=v.getById(F.id),k?(k.insideElement=!0,k.lastPos=k.currentPos,k.lastTime=k.currentTime,k.currentPos=F.currentPos,k.currentTime=F.currentTime,F=k):(F.captured=!1,F.insideElementPressed=!1,F.insideElement=!0,ce(v,F)),g.enterHandler&&(J=g.enterHandler({eventSource:g,pointerType:F.type,position:y(F.currentPos,g.element),buttons:v.buttons,pointers:g.getActivePointerCount(),insideElementPressed:F.insideElementPressed,buttonDownAny:v.buttons!==0,isTouchEvent:F.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),J===!1&&t.cancelEvent(u))}function Ee(g,u,m){var v=g.getActivePointersListByType(m[0].type),B,W=m.length,F,k,J;for(B=0;B<W;B++)F=m[B],k=v.getById(F.id),k&&(k.captured?(k.insideElement=!1,k.lastPos=k.currentPos,k.lastTime=k.currentTime,k.currentPos=F.currentPos,k.currentTime=F.currentTime):ne(v,k),F=k),g.exitHandler&&(J=g.exitHandler({eventSource:g,pointerType:F.type,position:F.currentPos&&y(F.currentPos,g.element),buttons:v.buttons,pointers:g.getActivePointerCount(),insideElementPressed:k?k.insideElementPressed:!1,buttonDownAny:v.buttons!==0,isTouchEvent:F.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),J===!1&&t.cancelEvent(u))}function ht(g,u,m,v){var B=i[g.hash],W,F=g.getActivePointersListByType(m[0].type),k,J=m.length,te,ie;typeof u.buttons!="undefined"?F.buttons=u.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?v===0?F.buttons+=1:v===1?F.buttons+=4:v===2?F.buttons+=2:v===3?F.buttons+=8:v===4?F.buttons+=16:v===5&&(F.buttons+=32):v===0?F.buttons|=1:v===1?F.buttons|=4:v===2?F.buttons|=2:v===3?F.buttons|=8:v===4?F.buttons|=16:v===5&&(F.buttons|=32);var de=g.getActivePointersListsExceptType(m[0].type);for(k=0;k<de.length;k++)Ae(g,u,de[k]);if(v!==0)return g.nonPrimaryPressHandler&&(W=g.nonPrimaryPressHandler({eventSource:g,pointerType:m[0].type,position:y(m[0].currentPos,g.element),button:v,buttons:F.buttons,isTouchEvent:m[0].type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),W===!1&&t.cancelEvent(u)),!1;for(k=0;k<J;k++)te=m[k],ie=F.getById(te.id),ie?(ie.captured=!0,ie.insideElementPressed=!0,ie.insideElement=!0,ie.contactPos=te.currentPos,ie.contactTime=te.currentTime,ie.lastPos=ie.currentPos,ie.lastTime=ie.currentTime,ie.currentPos=te.currentPos,ie.currentTime=te.currentTime,te=ie):(te.captured=!0,te.insideElementPressed=!0,te.insideElement=!0,ce(F,te)),F.addContact(),(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(g,te),F.contacts===1?g.pressHandler&&(W=g.pressHandler({eventSource:g,pointerType:te.type,position:y(te.contactPos,g.element),buttons:F.buttons,isTouchEvent:te.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),W===!1&&t.cancelEvent(u)):F.contacts===2&&g.pinchHandler&&te.type==="touch"&&(B.pinchGPoints=F.asArray(),B.lastPinchDist=B.currentPinchDist=B.pinchGPoints[0].currentPos.distanceTo(B.pinchGPoints[1].currentPos),B.lastPinchCenter=B.currentPinchCenter=R(B.pinchGPoints[0].currentPos,B.pinchGPoints[1].currentPos));return!0}function Je(g,u,m,v){var B=i[g.hash],W=g.getActivePointersListByType(m[0].type),F,k,J,te,ie=m.length,de,ee,Qe=!1,Ke=!1,ct;if(typeof u.buttons!="undefined"?W.buttons=u.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?v===0?W.buttons-=1:v===1?W.buttons-=4:v===2?W.buttons-=2:v===3?W.buttons-=8:v===4?W.buttons-=16:v===5&&(W.buttons-=32):v===0?W.buttons^=~1:v===1?W.buttons^=~4:v===2?W.buttons^=~2:v===3?W.buttons^=~8:v===4?W.buttons^=~16:v===5&&(W.buttons^=~32),v!==0){g.nonPrimaryReleaseHandler&&(F=g.nonPrimaryReleaseHandler({eventSource:g,pointerType:m[0].type,position:y(m[0].currentPos,g.element),button:v,buttons:W.buttons,isTouchEvent:m[0].type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),F===!1&&t.cancelEvent(u));var ui=g.getActivePointersListByType("mouse");return Ae(g,u,ui),!1}if(typeof m[0].currentPos=="undefined")return Ae(g,u,W),!1;for(te=0;te<ie;te++)de=m[te],ee=W.getById(de.id),ee&&(ee.captured&&(ee.captured=!1,Qe=!0,Ke=!0),ee.lastPos=ee.currentPos,ee.lastTime=ee.currentTime,ee.currentPos=de.currentPos,ee.currentTime=de.currentTime,ee.insideElement||ne(W,ee),k=ee.currentPos,J=ee.currentTime,Ke?(W.removeContact(),(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(g,ee),W.contacts===0?(g.releaseHandler&&(F=g.releaseHandler({eventSource:g,pointerType:ee.type,position:y(k,g.element),buttons:W.buttons,insideElementPressed:ee.insideElementPressed,insideElementReleased:ee.insideElement,isTouchEvent:ee.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),F===!1&&t.cancelEvent(u)),g.dragEndHandler&&!ee.currentPos.equals(ee.contactPos)&&(F=g.dragEndHandler({eventSource:g,pointerType:ee.type,position:y(ee.currentPos,g.element),speed:ee.speed,direction:ee.direction,shift:u.shiftKey,isTouchEvent:ee.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),F===!1&&t.cancelEvent(u)),(g.clickHandler||g.dblClickHandler)&&ee.insideElement&&(ct=J-ee.contactTime<=g.clickTimeThreshold&&ee.contactPos.distanceTo(k)<=g.clickDistThreshold,g.clickHandler&&(F=g.clickHandler({eventSource:g,pointerType:ee.type,position:y(ee.currentPos,g.element),quick:ct,shift:u.shiftKey,isTouchEvent:ee.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),F===!1&&t.cancelEvent(u)),g.dblClickHandler&&ct&&(W.clicks++,W.clicks===1?(B.lastClickPos=k,B.dblClickTimeOut=setTimeout(function(){W.clicks=0},g.dblClickTimeThreshold)):W.clicks===2&&(clearTimeout(B.dblClickTimeOut),W.clicks=0,B.lastClickPos.distanceTo(k)<=g.dblClickDistThreshold&&(F=g.dblClickHandler({eventSource:g,pointerType:ee.type,position:y(ee.currentPos,g.element),shift:u.shiftKey,isTouchEvent:ee.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),F===!1&&t.cancelEvent(u)),B.lastClickPos=null)))):W.contacts===2&&g.pinchHandler&&ee.type==="touch"&&(B.pinchGPoints=W.asArray(),B.lastPinchDist=B.currentPinchDist=B.pinchGPoints[0].currentPos.distanceTo(B.pinchGPoints[1].currentPos),B.lastPinchCenter=B.currentPinchCenter=R(B.pinchGPoints[0].currentPos,B.pinchGPoints[1].currentPos))):g.releaseHandler&&(F=g.releaseHandler({eventSource:g,pointerType:ee.type,position:y(k,g.element),buttons:W.buttons,insideElementPressed:ee.insideElementPressed,insideElementReleased:ee.insideElement,isTouchEvent:ee.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),F===!1&&t.cancelEvent(u)));return Qe}function ut(g,u,m){var v=i[g.hash],B=g.getActivePointersListByType(m[0].type),W,F=m.length,k,J,te,ie,de;for(typeof u.buttons!="undefined"&&(B.buttons=u.buttons),W=0;W<F;W++)k=m[W],J=B.getById(k.id),J?(Object.prototype.hasOwnProperty.call(k,"isPrimary")&&(J.isPrimary=k.isPrimary),J.lastPos=J.currentPos,J.lastTime=J.currentTime,J.currentPos=k.currentPos,J.currentTime=k.currentTime):(k.captured=!1,k.insideElementPressed=!1,k.insideElement=!0,ce(B,k));g.stopHandler&&m[0].type==="mouse"&&(clearTimeout(g.stopTimeOut),g.stopTimeOut=setTimeout(function(){hi(g,u,m[0].type)},g.stopDelay)),B.contacts===0?g.moveHandler&&(de=g.moveHandler({eventSource:g,pointerType:m[0].type,position:y(m[0].currentPos,g.element),buttons:B.buttons,isTouchEvent:m[0].type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),de===!1&&t.cancelEvent(u)):B.contacts===1?(g.moveHandler&&(J=B.asArray()[0],de=g.moveHandler({eventSource:g,pointerType:J.type,position:y(J.currentPos,g.element),buttons:B.buttons,isTouchEvent:J.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),de===!1&&t.cancelEvent(u)),g.dragHandler&&(J=B.asArray()[0],ie=J.currentPos.minus(J.lastPos),de=g.dragHandler({eventSource:g,pointerType:J.type,position:y(J.currentPos,g.element),buttons:B.buttons,delta:ie,speed:J.speed,direction:J.direction,shift:u.shiftKey,isTouchEvent:J.type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),de===!1&&t.cancelEvent(u))):B.contacts===2&&(g.moveHandler&&(te=B.asArray(),de=g.moveHandler({eventSource:g,pointerType:te[0].type,position:y(R(te[0].currentPos,te[1].currentPos),g.element),buttons:B.buttons,isTouchEvent:te[0].type==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData}),de===!1&&t.cancelEvent(u)),g.pinchHandler&&m[0].type==="touch"&&(ie=v.pinchGPoints[0].currentPos.distanceTo(v.pinchGPoints[1].currentPos),ie!=v.currentPinchDist&&(v.lastPinchDist=v.currentPinchDist,v.currentPinchDist=ie,v.lastPinchCenter=v.currentPinchCenter,v.currentPinchCenter=R(v.pinchGPoints[0].currentPos,v.pinchGPoints[1].currentPos),de=g.pinchHandler({eventSource:g,pointerType:"touch",gesturePoints:v.pinchGPoints,lastCenter:y(v.lastPinchCenter,g.element),center:y(v.currentPinchCenter,g.element),lastDistance:v.lastPinchDist,distance:v.currentPinchDist,shift:u.shiftKey,originalEvent:u,preventDefaultAction:!1,userData:g.userData}),de===!1&&t.cancelEvent(u))))}function li(g,u,m){Je(g,u,m,0),Ee(g,u,m)}function hi(g,u,m){g.stopHandler&&g.stopHandler({eventSource:g,pointerType:m,position:w(u,g.element),buttons:g.getActivePointersListByType(m).buttons,isTouchEvent:m==="touch",originalEvent:u,preventDefaultAction:!1,userData:g.userData})}var At=function(){try{return window.self!==window.top}catch{return!0}}();function Bt(g){try{return g.addEventListener&&g.removeEventListener}catch{return!1}}})(OpenSeadragon);(function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(e,i,n){var s=e.parentNode;typeof i=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=typeof i.attachToViewer=="undefined"?!0:i.attachToViewer,this.autoFade=typeof i.autoFade=="undefined"?!0:i.autoFade,this.element=e,this.anchor=i.anchor,this.container=n,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof i.top=="number"?i.top+"px":i.top,this.wrapper.style.left=typeof i.left=="number"?i.left+"px":i.left,this.wrapper.style.height=typeof i.height=="number"?i.height+"px":i.height,this.wrapper.style.width=typeof i.width=="number"?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):s.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(e){this.wrapper.style.display=e?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?t.setElementOpacity(this.element,e,!0):t.setElementOpacity(this.wrapper,e,!0)}}})(OpenSeadragon);(function(t){t.ControlDock=function(i){var n=["topleft","topright","bottomright","bottomleft"],s,o;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<n.length;o++)s=n[o],this.controls[s]=t.makeNeutralElement("div"),this.controls[s].style.position="absolute",s.match("left")&&(this.controls[s].style.left="0px"),s.match("right")&&(this.controls[s].style.right="0px"),s.match("top")&&(this.controls[s].style.top="0px"),s.match("bottom")&&(this.controls[s].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(i,n){i=t.getElement(i);var s=null;if(!(e(this,i)>=0)){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:s=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:s=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:s=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:s=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:s=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case t.ControlAnchor.NONE:s=this.container,i.style.margin="0px",i.style.padding="0px";break}this.controls.push(new t.Control(i,n,s)),i.style.display="inline-block"}},removeControl:function(i){i=t.getElement(i);var n=e(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;i>=0;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var n;for(n=this.controls.length-1;n>=0;n--)this.controls[n].setVisible(i);return this}};function e(i,n){var s=i.controls,o;for(o=s.length-1;o>=0;o--)if(s[o].element==n)return o;return-1}})(OpenSeadragon);(function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})})(OpenSeadragon);(function(t){var e={},i=1;t.Viewer=function(l){var f=arguments,C=this,A;if(t.isPlainObject(l)||(l={id:f[0],xmlPath:f.length>1?f[1]:void 0,prefixUrl:f.length>2?f[2]:void 0,controls:f.length>3?f[3]:void 0,overlays:f.length>4?f[4]:void 0}),l.config&&(t.extend(!0,l,l.config),delete l.config),t.extend(!0,this,{id:l.id,hash:l.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},t.DEFAULT_SETTINGS,l),typeof this.hash=="undefined")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof e[this.hash]!="undefined"&&t.console.warn("Hash "+this.hash+" has already been used."),e[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(H){var D=t.getString("Errors.OpenFailed",H.eventSource,H.message);C._showMessage(D)}),t.ControlDock.call(this,l),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(H){H.width="100%",H.height="100%",H.overflow="hidden",H.position="absolute",H.top="0px",H.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),l.tabIndex!==""&&(this.canvas.tabIndex=l.tabIndex===void 0?0:l.tabIndex),this.container.className="openseadragon-container",function(H){H.width="100%",H.height="100%",H.position="relative",H.overflow="hidden",H.left="0px",H.top="0px",H.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:t.delegate(this,b),keyHandler:t.delegate(this,N),clickHandler:t.delegate(this,h),dblClickHandler:t.delegate(this,x),dragHandler:t.delegate(this,T),dragEndHandler:t.delegate(this,S),enterHandler:t.delegate(this,P),exitHandler:t.delegate(this,O),pressHandler:t.delegate(this,M),releaseHandler:t.delegate(this,L),nonPrimaryPressHandler:t.delegate(this,U),nonPrimaryReleaseHandler:t.delegate(this,Q),scrollHandler:t.delegate(this,Y),pinchHandler:t.delegate(this,V)}),this.outerTracker=new t.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,X),exitHandler:t.delegate(this,oe)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),e[this.hash].prevContainerSize=n(this.container),this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(H){C.source=C.world.getItemAt(0).source,e[C.hash].forceRedraw=!0,C._updateRequestId||(C._updateRequestId=r(C,re))}),this.world.addHandler("remove-item",function(H){C.world.getItemCount()?C.source=C.world.getItemAt(0).source:C.source=null,e[C.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(H){C.viewport&&C.viewport._setContentBounds(C.world.getHomeBounds(),C.world.getContentFactor())}),this.world.addHandler("item-index-change",function(H){C.source=C.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:e[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:l.timeout}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(A=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(A,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(A=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(A,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new t.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),A=0;A<this.customControls.length;A++)this.addControl(this.customControls[A].id,{anchor:this.customControls[A].anchor});t.requestAnimationFrame(function(){c(C)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(l){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(l)},openTileSource:function(l){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(l)},open:function(l,f){var C=this;if(this.close(),!!l){if(this.sequenceMode&&t.isArray(l)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof f!="undefined"&&!isNaN(f)&&(this.initialPage=f),this.tileSources=l,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(t.isArray(l)||(l=[l]),!!l.length){this._opening=!0;for(var A=l.length,H=0,D=0,_,z=function(){if(H+D===A)if(H){(C._firstOpen||!C.preserveViewport)&&(C.viewport.goHome(!0),C.viewport.update()),C._firstOpen=!1;var Z=l[0];if(Z.tileSource&&(Z=Z.tileSource),C.overlays&&!C.preserveOverlays)for(var ce=0;ce<C.overlays.length;ce++)C.currentOverlays[ce]=o(C,C.overlays[ce]);C._drawOverlays(),C._opening=!1,C.raiseEvent("open",{source:Z})}else C._opening=!1,C.raiseEvent("open-failed",_)},q=function(Z){(!t.isPlainObject(Z)||!Z.tileSource)&&(Z={tileSource:Z}),Z.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Z.index),Z.collectionImmediately===void 0&&(Z.collectionImmediately=!0);var ce=Z.success;Z.success=function(we){if(H++,Z.tileSource.overlays)for(var Ee=0;Ee<Z.tileSource.overlays.length;Ee++)C.addOverlay(Z.tileSource.overlays[Ee]);ce&&ce(we),z()};var ne=Z.error;Z.error=function(we){D++,_||(_=we),ne&&ne(we),z()},C.addTiledImage(Z)},K=0;K<l.length;K++)q(l[K]);return this}}},close:function(){return e[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),e[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(!!e[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),e[this.hash]=null,delete e[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(l){return this.innerTracker.setTracking(l),this.outerTracker.setTracking(l),this.raiseEvent("mouse-enabled",{enabled:l}),this},areControlsEnabled:function(){var l=this.controls.length,f;for(f=0;f<this.controls.length;f++)l=l&&this.controls[f].isVisible();return l},setControlsEnabled:function(l){return l?w(this):c(this),this.raiseEvent("controls-enabled",{enabled:l}),this},setDebugMode:function(l){for(var f=0;f<this.world.getItemCount();f++)this.world.getItemAt(f).debugMode=l;this.debugMode=l,this.forceRedraw()},isFullPage:function(){return e[this.hash].fullPage},setFullPage:function(l){var f=document.body,C=f.style,A=document.documentElement.style,H=this,D,_;if(l==this.isFullPage())return this;var z={fullPage:l,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",z),z.preventDefaultAction)return this;if(l){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=C.margin,this.docMargin=A.margin,C.margin="0",A.margin="0",this.bodyPadding=C.padding,this.docPadding=A.padding,C.padding="0",A.padding="0",this.bodyWidth=C.width,this.docWidth=A.width,C.width="100%",A.width="100%",this.bodyHeight=C.height,this.docHeight=A.height,C.height="100%",A.height="100%",this.previousBody=[],e[this.hash].prevElementParent=this.element.parentNode,e[this.hash].prevNextSibling=this.element.nextSibling,e[this.hash].prevElementWidth=this.element.style.width,e[this.hash].prevElementHeight=this.element.style.height,D=f.childNodes.length,_=0;_<D;_++)this.previousBody.push(f.childNodes[0]),f.removeChild(f.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,f.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),f.appendChild(this.element),this.element.style.height=t.getWindowSize().y+"px",this.element.style.width=t.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),e[this.hash].fullPage=!0,t.delegate(this,X)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,C.margin=this.bodyMargin,A.margin=this.docMargin,C.padding=this.bodyPadding,A.padding=this.docPadding,C.width=this.bodyWidth,A.width=this.docWidth,C.height=this.bodyHeight,A.height=this.docHeight,f.removeChild(this.element),D=this.previousBody.length,_=0;_<D;_++)f.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),e[this.hash].prevElementParent.insertBefore(this.element,e[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(f.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=e[this.hash].prevElementWidth,this.element.style.height=e[this.hash].prevElementHeight;var q=0,K=function(){t.setPageScroll(H.pageScroll);var Z=t.getPageScroll();q++,q<10&&(Z.x!==H.pageScroll.x||Z.y!==H.pageScroll.y)&&t.requestAnimationFrame(K)};t.requestAnimationFrame(K),e[this.hash].fullPage=!1,t.delegate(this,oe)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:l}),this},setFullScreen:function(l){var f=this;if(!t.supportsFullScreen)return this.setFullPage(l);if(t.isFullScreen()===l)return this;var C={fullScreen:l,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",C),C.preventDefaultAction)return this;if(l){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var A=function(){var H=t.isFullScreen();H||(t.removeEvent(document,t.fullScreenEventName,A),t.removeEvent(document,t.fullScreenErrorEventName,A),f.setFullPage(!1),f.isFullPage()&&(f.element.style.width=f.fullPageStyleWidth,f.element.style.height=f.fullPageStyleHeight)),f.navigator&&f.viewport&&setTimeout(function(){f.navigator.update(f.viewport)}),f.raiseEvent("full-screen",{fullScreen:H})};t.addEvent(document,t.fullScreenEventName,A),t.addEvent(document,t.fullScreenErrorEventName,A),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(l){return this.container.style.visibility=l?"":"hidden",this.raiseEvent("visible",{visible:l}),this},addTiledImage:function(l){t.console.assert(l,"[Viewer.addTiledImage] options is required"),t.console.assert(l.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!l.replace||l.index>-1&&l.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var f=this;l.replace&&(l.replaceItem=f.world.getItemAt(l.index)),this._hideMessage(),l.placeholderFillStyle===void 0&&(l.placeholderFillStyle=this.placeholderFillStyle),l.opacity===void 0&&(l.opacity=this.opacity),l.preload===void 0&&(l.preload=this.preload),l.compositeOperation===void 0&&(l.compositeOperation=this.compositeOperation),l.crossOriginPolicy===void 0&&(l.crossOriginPolicy=l.tileSource.crossOriginPolicy!==void 0?l.tileSource.crossOriginPolicy:this.crossOriginPolicy),l.ajaxWithCredentials===void 0&&(l.ajaxWithCredentials=this.ajaxWithCredentials),l.loadTilesWithAjax===void 0&&(l.loadTilesWithAjax=this.loadTilesWithAjax),l.ajaxHeaders===void 0||l.ajaxHeaders===null?l.ajaxHeaders=this.ajaxHeaders:t.isPlainObject(l.ajaxHeaders)&&t.isPlainObject(this.ajaxHeaders)&&(l.ajaxHeaders=t.extend({},this.ajaxHeaders,l.ajaxHeaders));var C={options:l};function A(_){for(var z=0;z<f._loadQueue.length;z++)if(f._loadQueue[z]===C){f._loadQueue.splice(z,1);break}f._loadQueue.length===0&&H(C),f.raiseEvent("add-item-failed",_),l.error&&l.error(_)}function H(_){f.collectionMode&&(f.world.arrange({immediately:_.options.collectionImmediately,rows:f.collectionRows,columns:f.collectionColumns,layout:f.collectionLayout,tileSize:f.collectionTileSize,tileMargin:f.collectionTileMargin}),f.world.setAutoRefigureSizes(!0))}if(t.isArray(l.tileSource)){setTimeout(function(){A({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:l.tileSource,options:l})});return}this._loadQueue.push(C);function D(){for(var _,z,q;f._loadQueue.length&&(_=f._loadQueue[0],!!_.tileSource);){if(f._loadQueue.splice(0,1),_.options.replace){var K=f.world.getIndexOfItem(_.options.replaceItem);K!=-1&&(_.options.index=K),f.world.removeItem(_.options.replaceItem)}z=new t.TiledImage({viewer:f,source:_.tileSource,viewport:f.viewport,drawer:f.drawer,tileCache:f.tileCache,imageLoader:f.imageLoader,x:_.options.x,y:_.options.y,width:_.options.width,height:_.options.height,fitBounds:_.options.fitBounds,fitBoundsPlacement:_.options.fitBoundsPlacement,clip:_.options.clip,placeholderFillStyle:_.options.placeholderFillStyle,opacity:_.options.opacity,preload:_.options.preload,degrees:_.options.degrees,compositeOperation:_.options.compositeOperation,springStiffness:f.springStiffness,animationTime:f.animationTime,minZoomImageRatio:f.minZoomImageRatio,wrapHorizontal:f.wrapHorizontal,wrapVertical:f.wrapVertical,immediateRender:f.immediateRender,blendTime:f.blendTime,alwaysBlend:f.alwaysBlend,minPixelRatio:f.minPixelRatio,smoothTileEdgesMinZoom:f.smoothTileEdgesMinZoom,iOSDevice:f.iOSDevice,crossOriginPolicy:_.options.crossOriginPolicy,ajaxWithCredentials:_.options.ajaxWithCredentials,loadTilesWithAjax:_.options.loadTilesWithAjax,ajaxHeaders:_.options.ajaxHeaders,debugMode:f.debugMode}),f.collectionMode&&f.world.setAutoRefigureSizes(!1),f.world.addItem(z,{index:_.options.index}),f._loadQueue.length===0&&H(_),f.world.getItemCount()===1&&!f.preserveViewport&&f.viewport.goHome(!0),f.navigator&&(q=t.extend({},_.options,{replace:!1,originalTiledImage:z,tileSource:_.tileSource}),f.navigator.addTiledImage(q)),_.options.success&&_.options.success({item:z})}}s(this,l.tileSource,l,function(_){C.tileSource=_,D()},function(_){_.options=l,A(_),D()})},addSimpleImage:function(l){t.console.assert(l,"[Viewer.addSimpleImage] options is required"),t.console.assert(l.url,"[Viewer.addSimpleImage] options.url is required");var f=t.extend({},l,{tileSource:{type:"image",url:l.url}});delete f.url,this.addTiledImage(f)},addLayer:function(l){var f=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var C=t.extend({},l,{success:function(A){f.raiseEvent("add-layer",{options:l,drawer:A.item})},error:function(A){f.raiseEvent("add-layer-failed",A)}});return this.addTiledImage(C),this},getLayerAtLevel:function(l){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(l)},getLevelOfLayer:function(l){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(l)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(l,f){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(l,f)},removeLayer:function(l){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(l)},forceRedraw:function(){return e[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var l=t.delegate(this,y),f=t.delegate(this,R),C=t.delegate(this,Xe),A=t.delegate(this,Be),H=this.navImages,D=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(D=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:G(this.prefixUrl,H.previous.REST),srcGroup:G(this.prefixUrl,H.previous.GROUP),srcHover:G(this.prefixUrl,H.previous.HOVER),srcDown:G(this.prefixUrl,H.previous.DOWN),onRelease:A,onFocus:l,onBlur:f}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:G(this.prefixUrl,H.next.REST),srcGroup:G(this.prefixUrl,H.next.GROUP),srcHover:G(this.prefixUrl,H.next.HOVER),srcDown:G(this.prefixUrl,H.next.DOWN),onRelease:C,onFocus:l,onBlur:f}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),D&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var l=t.delegate(this,pe),f=t.delegate(this,ke),C=t.delegate(this,Ae),A=t.delegate(this,Oe),H=t.delegate(this,be),D=t.delegate(this,je),_=t.delegate(this,Ve),z=t.delegate(this,Ze),q=t.delegate(this,qe),K=t.delegate(this,Ge),Z=t.delegate(this,y),ce=t.delegate(this,R),ne=this.navImages,we=[],Ee=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Ee=!1),this.showZoomControl&&(we.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:G(this.prefixUrl,ne.zoomIn.REST),srcGroup:G(this.prefixUrl,ne.zoomIn.GROUP),srcHover:G(this.prefixUrl,ne.zoomIn.HOVER),srcDown:G(this.prefixUrl,ne.zoomIn.DOWN),onPress:l,onRelease:f,onClick:C,onEnter:l,onExit:f,onFocus:Z,onBlur:ce})),we.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:G(this.prefixUrl,ne.zoomOut.REST),srcGroup:G(this.prefixUrl,ne.zoomOut.GROUP),srcHover:G(this.prefixUrl,ne.zoomOut.HOVER),srcDown:G(this.prefixUrl,ne.zoomOut.DOWN),onPress:A,onRelease:f,onClick:H,onEnter:A,onExit:f,onFocus:Z,onBlur:ce}))),this.showHomeControl&&we.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:G(this.prefixUrl,ne.home.REST),srcGroup:G(this.prefixUrl,ne.home.GROUP),srcHover:G(this.prefixUrl,ne.home.HOVER),srcDown:G(this.prefixUrl,ne.home.DOWN),onRelease:D,onFocus:Z,onBlur:ce})),this.showFullPageControl&&we.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:G(this.prefixUrl,ne.fullpage.REST),srcGroup:G(this.prefixUrl,ne.fullpage.GROUP),srcHover:G(this.prefixUrl,ne.fullpage.HOVER),srcDown:G(this.prefixUrl,ne.fullpage.DOWN),onRelease:_,onFocus:Z,onBlur:ce})),this.showRotationControl&&(we.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:G(this.prefixUrl,ne.rotateleft.REST),srcGroup:G(this.prefixUrl,ne.rotateleft.GROUP),srcHover:G(this.prefixUrl,ne.rotateleft.HOVER),srcDown:G(this.prefixUrl,ne.rotateleft.DOWN),onRelease:z,onFocus:Z,onBlur:ce})),we.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:G(this.prefixUrl,ne.rotateright.REST),srcGroup:G(this.prefixUrl,ne.rotateright.GROUP),srcHover:G(this.prefixUrl,ne.rotateright.HOVER),srcDown:G(this.prefixUrl,ne.rotateright.DOWN),onRelease:q,onFocus:Z,onBlur:ce}))),this.showFlipControl&&we.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:G(this.prefixUrl,ne.flip.REST),srcGroup:G(this.prefixUrl,ne.flip.GROUP),srcHover:G(this.prefixUrl,ne.flip.HOVER),srcDown:G(this.prefixUrl,ne.flip.DOWN),onRelease:K,onFocus:Z,onBlur:ce})),Ee&&(this.buttons=new t.ButtonGroup({buttons:we,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",t.delegate(this,Ue)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(l){return this.tileSources&&l>=0&&l<this.tileSources.length&&(this._sequenceIndex=l,this._updateSequenceButtons(l),this.open(this.tileSources[l]),this.referenceStrip&&this.referenceStrip.setFocus(l),this.raiseEvent("page",{page:l})),this},addOverlay:function(l,f,C,A){var H;if(t.isPlainObject(l)?H=l:H={element:l,location:f,placement:C,onDraw:A},l=t.getElement(H.element),a(this.currentOverlays,l)>=0)return this;var D=o(this,H);return this.currentOverlays.push(D),D.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:l,location:H.location,placement:H.placement}),this},updateOverlay:function(l,f,C){var A;return l=t.getElement(l),A=a(this.currentOverlays,l),A>=0&&(this.currentOverlays[A].update(f,C),e[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:l,location:f,placement:C})),this},removeOverlay:function(l){var f;return l=t.getElement(l),f=a(this.currentOverlays,l),f>=0&&(this.currentOverlays[f].destroy(),this.currentOverlays.splice(f,1),e[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:l})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return e[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(l){var f;return l=t.getElement(l),f=a(this.currentOverlays,l),f>=0?this.currentOverlays[f]:null},_updateSequenceButtons:function(l){this.nextButton&&(!this.tileSources||this.tileSources.length-1===l?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(l>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(l){this._hideMessage();var f=t.makeNeutralElement("div");f.appendChild(document.createTextNode(l)),this.messageDiv=t.makeCenteredNode(f),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var l=this.messageDiv;l&&(l.parentNode.removeChild(l),delete this.messageDiv)},gestureSettingsByDeviceType:function(l){switch(l){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var l,f=this.currentOverlays.length;for(l=0;l<f;l++)this.currentOverlays[l].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function n(l){return l=t.getElement(l),new t.Point(l.clientWidth===0?1:l.clientWidth,l.clientHeight===0?1:l.clientHeight)}function s(l,f,C,A,H){var D=l;if(t.type(f)=="string"){if(f.match(/^\s*<.*>\s*$/))f=t.parseXml(f);else if(f.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var _=t.parseJSON(f);f=_}catch{}}function z(q,K){q.ready?A(q):(q.addHandler("ready",function(){A(q)}),q.addHandler("open-failed",function(Z){H({message:Z.message,source:K})}))}setTimeout(function(){if(t.type(f)=="string")f=new t.TileSource({url:f,crossOriginPolicy:C.crossOriginPolicy!==void 0?C.crossOriginPolicy:l.crossOriginPolicy,ajaxWithCredentials:l.ajaxWithCredentials,ajaxHeaders:l.ajaxHeaders,useCanvas:l.useCanvas,success:function(ce){A(ce.tileSource)}}),f.addHandler("open-failed",function(ce){H(ce)});else if(t.isPlainObject(f)||f.nodeType)if(f.crossOriginPolicy===void 0&&(C.crossOriginPolicy!==void 0||l.crossOriginPolicy!==void 0)&&(f.crossOriginPolicy=C.crossOriginPolicy!==void 0?C.crossOriginPolicy:l.crossOriginPolicy),f.ajaxWithCredentials===void 0&&(f.ajaxWithCredentials=l.ajaxWithCredentials),f.useCanvas===void 0&&(f.useCanvas=l.useCanvas),t.isFunction(f.getTileUrl)){var q=new t.TileSource(f);q.getTileUrl=f.getTileUrl,A(q)}else{var K=t.TileSource.determineType(D,f);if(!K){H({message:"Unable to load TileSource",source:f});return}var Z=K.prototype.configure.apply(D,[f]);z(new K(Z),f)}else z(f,f)})}function o(l,f){if(f instanceof t.Overlay)return f;var C=null;if(f.element)C=t.getElement(f.element);else{var A=f.id?f.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);C=t.getElement(f.id),C||(C=document.createElement("a"),C.href="#/overlay/"+A),C.id=A,t.addClass(C,f.className?f.className:"openseadragon-overlay")}var H=f.location,D=f.width,_=f.height;if(!H){var z=f.x,q=f.y;if(f.px!==void 0){var K=l.viewport.imageToViewportRectangle(new t.Rect(f.px,f.py,D||0,_||0));z=K.x,q=K.y,D=D!==void 0?K.width:void 0,_=_!==void 0?K.height:void 0}H=new t.Point(z,q)}var Z=f.placement;return Z&&t.type(Z)==="string"&&(Z=t.Placement[f.placement.toUpperCase()]),new t.Overlay({element:C,location:H,placement:Z,onDraw:f.onDraw,checkResize:f.checkResize,width:D,height:_,rotationMode:f.rotationMode})}function a(l,f){var C;for(C=l.length-1;C>=0;C--)if(l[C].element===f)return C;return-1}function r(l,f){return t.requestAnimationFrame(function(){f(l)})}function d(l){t.requestAnimationFrame(function(){p(l)})}function c(l){!l.autoHideControls||(l.controlsShouldFade=!0,l.controlsFadeBeginTime=t.now()+l.controlsFadeDelay,window.setTimeout(function(){d(l)},l.controlsFadeDelay))}function p(l){var f,C,A,H;if(l.controlsShouldFade){for(f=t.now(),C=f-l.controlsFadeBeginTime,A=1-C/l.controlsFadeLength,A=Math.min(1,A),A=Math.max(0,A),H=l.controls.length-1;H>=0;H--)l.controls[H].autoFade&&l.controls[H].setOpacity(A);A>0&&d(l)}}function w(l){var f;for(l.controlsShouldFade=!1,f=l.controls.length-1;f>=0;f--)l.controls[f].setOpacity(1)}function y(){w(this)}function R(){c(this)}function b(l){var f={originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction,preventVerticalPan:l.preventVerticalPan,preventHorizontalPan:l.preventHorizontalPan};if(this.raiseEvent("canvas-key",f),!f.preventDefaultAction&&!l.ctrl&&!l.alt&&!l.meta)switch(l.keyCode){case 38:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function N(l){var f={originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction,preventVerticalPan:l.preventVerticalPan,preventHorizontalPan:l.preventHorizontalPan};if(this.raiseEvent("canvas-key",f),!f.preventDefaultAction&&!l.ctrl&&!l.alt&&!l.meta)switch(l.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(t.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(t.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(t.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(t.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function h(l){var f,C=document.activeElement==this.canvas;C||this.canvas.focus(),this.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x);var A={tracker:l.eventSource,position:l.position,quick:l.quick,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction};this.raiseEvent("canvas-click",A),!A.preventDefaultAction&&this.viewport&&l.quick&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.clickToZoom&&(this.viewport.zoomBy(l.shift?1/this.zoomPerClick:this.zoomPerClick,f.zoomToRefPoint?this.viewport.pointFromPixel(l.position,!0):null),this.viewport.applyConstraints()))}function x(l){var f,C={tracker:l.eventSource,position:l.position,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction};this.raiseEvent("canvas-double-click",C),!C.preventDefaultAction&&this.viewport&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.dblClickToZoom&&(this.viewport.zoomBy(l.shift?1/this.zoomPerClick:this.zoomPerClick,f.zoomToRefPoint?this.viewport.pointFromPixel(l.position,!0):null),this.viewport.applyConstraints()))}function T(l){var f,C={tracker:l.eventSource,position:l.position,delta:l.delta,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction};if(this.raiseEvent("canvas-drag",C),!C.preventDefaultAction&&this.viewport){if(f=this.gestureSettingsByDeviceType(l.pointerType),this.panHorizontal||(l.delta.x=0),this.panVertical||(l.delta.y=0),this.viewport.flipped&&(l.delta.x=-l.delta.x),this.constrainDuringPan){var A=this.viewport.deltaPointsFromPixels(l.delta.negate());this.viewport.centerSpringX.target.value+=A.x,this.viewport.centerSpringY.target.value+=A.y;var H=this.viewport.getBounds(),D=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=A.x,this.viewport.centerSpringY.target.value-=A.y,H.x!=D.x&&(l.delta.x=0),H.y!=D.y&&(l.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(l.delta.negate()),f.flickEnabled&&!this.constrainDuringPan)}}function S(l){if(!l.preventDefaultAction&&this.viewport){var f=this.gestureSettingsByDeviceType(l.pointerType);if(f.flickEnabled&&l.speed>=f.flickMinSpeed){var C=0;this.panHorizontal&&(C=f.flickMomentum*l.speed*Math.cos(l.direction));var A=0;this.panVertical&&(A=f.flickMomentum*l.speed*Math.sin(l.direction));var H=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),D=this.viewport.pointFromPixel(new t.Point(H.x-C,H.y-A));this.viewport.panTo(D,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:l.eventSource,position:l.position,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent})}function P(l){this.raiseEvent("canvas-enter",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function O(l){window.location!=window.parent.location&&t.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function M(l){this.raiseEvent("canvas-press",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElementReleased,originalEvent:l.originalEvent})}function L(l){this.raiseEvent("canvas-release",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElementReleased,originalEvent:l.originalEvent})}function U(l){this.raiseEvent("canvas-nonprimary-press",{tracker:l.eventSource,position:l.position,pointerType:l.pointerType,button:l.button,buttons:l.buttons,originalEvent:l.originalEvent})}function Q(l){this.raiseEvent("canvas-nonprimary-release",{tracker:l.eventSource,position:l.position,pointerType:l.pointerType,button:l.button,buttons:l.buttons,originalEvent:l.originalEvent})}function V(l){var f,C,A,H;if(!l.preventDefaultAction&&this.viewport&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.pinchToZoom&&(C=this.viewport.pointFromPixel(l.center,!0),A=this.viewport.pointFromPixel(l.lastCenter,!0),H=A.minus(C),this.panHorizontal||(H.x=0),this.panVertical||(H.y=0),this.viewport.zoomBy(l.distance/l.lastDistance,C,!0),f.zoomToRefPoint&&this.viewport.panBy(H,!0),this.viewport.applyConstraints()),f.pinchRotate)){var D=Math.atan2(l.gesturePoints[0].currentPos.y-l.gesturePoints[1].currentPos.y,l.gesturePoints[0].currentPos.x-l.gesturePoints[1].currentPos.x),_=Math.atan2(l.gesturePoints[0].lastPos.y-l.gesturePoints[1].lastPos.y,l.gesturePoints[0].lastPos.x-l.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(D-_)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:l.eventSource,gesturePoints:l.gesturePoints,lastCenter:l.lastCenter,center:l.center,lastDistance:l.lastDistance,distance:l.distance,shift:l.shift,originalEvent:l.originalEvent}),!1}function Y(l){var f,C,A,H;if(A=t.now(),H=A-this._lastScrollTime,H>this.minScrollDeltaTime){if(this._lastScrollTime=A,this.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x),!l.preventDefaultAction&&this.viewport&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.scrollToZoom&&(C=Math.pow(this.zoomPerScroll,l.scroll),this.viewport.zoomBy(C,f.zoomToRefPoint?this.viewport.pointFromPixel(l.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:l.eventSource,position:l.position,scroll:l.scroll,shift:l.shift,originalEvent:l.originalEvent}),f&&f.scrollToZoom)return!1}else if(f=this.gestureSettingsByDeviceType(l.pointerType),f&&f.scrollToZoom)return!1}function X(l){e[this.hash].mouseInside=!0,w(this),this.raiseEvent("container-enter",{tracker:l.eventSource,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function oe(l){l.pointers<1&&(e[this.hash].mouseInside=!1,e[this.hash].animating||c(this)),this.raiseEvent("container-exit",{tracker:l.eventSource,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function re(l){le(l),l.isOpen()?l._updateRequestId=r(l,re):l._updateRequestId=!1}function le(l){if(!l._opening){if(l.autoResize){var f=n(l.container),C=e[l.hash].prevContainerSize;if(!f.equals(C)){var A=l.viewport;if(l.preserveImageSizeOnResize){var H=C.x/f.x,D=A.getZoom()*H,_=A.getCenter();A.resize(f,!1),A.zoomTo(D,null,!0),A.panTo(_,!0)}else{var z=A.getBounds();A.resize(f,!0),A.fitBoundsWithConstraints(z,!0)}e[l.hash].prevContainerSize=f,e[l.hash].forceRedraw=!0}}var q=l.viewport.update(),K=l.world.update()||q;q&&l.raiseEvent("viewport-change"),l.referenceStrip&&(K=l.referenceStrip.update(l.viewport)||K),!e[l.hash].animating&&K&&(l.raiseEvent("animation-start"),w(l)),(K||e[l.hash].forceRedraw||l.world.needsDraw())&&(se(l),l._drawOverlays(),l.navigator&&l.navigator.update(l.viewport),e[l.hash].forceRedraw=!1,K&&l.raiseEvent("animation")),e[l.hash].animating&&!K&&(l.raiseEvent("animation-finish"),e[l.hash].mouseInside||c(l)),e[l.hash].animating=K}}function se(l){l.imageLoader.clear(),l.drawer.clear(),l.world.draw(),l.raiseEvent("update-viewport",{})}function G(l,f){return l?l+f:f}function pe(){e[this.hash].lastZoomTime=t.now(),e[this.hash].zoomFactor=this.zoomPerSecond,e[this.hash].zooming=!0,Fe(this)}function Oe(){e[this.hash].lastZoomTime=t.now(),e[this.hash].zoomFactor=1/this.zoomPerSecond,e[this.hash].zooming=!0,Fe(this)}function ke(){e[this.hash].zooming=!1}function Fe(l){t.requestAnimationFrame(t.delegate(l,Te))}function Te(){var l,f,C;e[this.hash].zooming&&this.viewport&&(l=t.now(),f=l-e[this.hash].lastZoomTime,C=Math.pow(e[this.hash].zoomFactor,f/1e3),this.viewport.zoomBy(C),this.viewport.applyConstraints(),e[this.hash].lastZoomTime=l,Fe(this))}function Ae(){this.viewport&&(e[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function be(){this.viewport&&(e[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Ue(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function je(){this.viewport&&this.viewport.goHome()}function Ve(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Ze(){if(this.viewport){var l=this.viewport.getRotation();this.viewport.flipped?l=t.positiveModulo(l+this.rotationIncrement,360):l=t.positiveModulo(l-this.rotationIncrement,360),this.viewport.setRotation(l)}}function qe(){if(this.viewport){var l=this.viewport.getRotation();this.viewport.flipped?l=t.positiveModulo(l-this.rotationIncrement,360):l=t.positiveModulo(l+this.rotationIncrement,360),this.viewport.setRotation(l)}}function Ge(){this.viewport.toggleFlip()}function Be(){var l=this._sequenceIndex-1;this.navPrevNextWrap&&l<0&&(l+=this.tileSources.length),this.goToPage(l)}function Xe(){var l=this._sequenceIndex+1;this.navPrevNextWrap&&l>=this.tileSources.length&&(l=0),this.goToPage(l)}})(OpenSeadragon);(function(t){t.Navigator=function(r){var d=r.viewer,c=this,p,w;r.id?(this.element=document.getElementById(r.id),r.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(r.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),r.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:r.autoFade},r.position&&(r.position=="BOTTOM_RIGHT"?r.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:r.position=="BOTTOM_LEFT"?r.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:r.position=="TOP_RIGHT"?r.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:r.position=="TOP_LEFT"?r.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:r.position=="ABSOLUTE"&&(r.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,r.controlOptions.top=r.top,r.controlOptions.left=r.left,r.controlOptions.height=r.height,r.controlOptions.width=r.width))),this.element.id=r.id,this.element.className+=" navigator",r=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},r,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:r.autoResize,minZoomImageRatio:1,background:r.background,opacity:r.opacity,borderColor:r.borderColor,displayRegionColor:r.displayRegionColor}),r.minPixelRatio=this.minPixelRatio=d.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),r.controlOptions.anchor!=t.ControlAnchor.NONE&&function(b,N){b.margin="0px",b.border=N+"px solid "+r.borderColor,b.padding="0px",b.background=r.background,b.opacity=r.opacity,b.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(b,N){b.position="relative",b.top="0px",b.left="0px",b.fontSize="0px",b.overflow="hidden",b.border=N+"px solid "+r.displayRegionColor,b.margin="0px",b.padding="0px",b.background="transparent",b.float="left",b.cssFloat="left",b.styleFloat="left",b.zIndex=999999999,b.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",d.addControl(this.element,r.controlOptions),this._resizeWithViewer=r.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&r.controlOptions.anchor!=t.ControlAnchor.NONE,r.width&&r.height?(this.setWidth(r.width),this.setHeight(r.height)):this._resizeWithViewer&&(p=t.getElementSize(d.element),this.element.style.height=Math.round(p.y*r.sizeRatio)+"px",this.element.style.width=Math.round(p.x*r.sizeRatio)+"px",this.oldViewerSize=p,w=t.getElementSize(this.element),this.elementArea=w.x*w.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[r]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function y(b){o(c.displayRegionContainer,b),o(c.displayRegion,-b),c.viewport.setRotation(b)}if(r.navigatorRotate){var R=r.viewer.viewport?r.viewer.viewport.getRotation():r.viewer.degrees||0;y(R),r.viewer.addHandler("rotate",function(b){y(b.degrees)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,i),clickHandler:t.delegate(this,e),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,s)}),this.addHandler("reset-size",function(){c.viewport&&c.viewport.goHome(!0)}),d.world.addHandler("item-index-change",function(b){window.setTimeout(function(){var N=c.world.getItemAt(b.previousIndex);c.world.setItemIndex(N,b.newIndex)},1)}),d.world.addHandler("remove-item",function(b){var N=b.item,h=c._getMatchingItem(N);h&&c.world.removeItem(h)}),this.update(d.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var r=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);r.equals(this.oldContainerSize)||(this.viewport.resize(r,!0),this.viewport.goHome(!0),this.oldContainerSize=r,this.drawer.clear(),this.world.draw())}},setWidth:function(r){this.width=r,this.element.style.width=typeof r=="number"?r+"px":r,this._resizeWithViewer=!1},setHeight:function(r){this.height=r,this.element.style.height=typeof r=="number"?r+"px":r,this._resizeWithViewer=!1},setFlip:function(r){return this.viewport.setFlip(r),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(r){a(this.displayRegion,r),a(this.canvas,r),a(this.element,r)},update:function(r){var d,c,p,w,y,R;if(d=t.getElementSize(this.viewer.element),this._resizeWithViewer&&d.x&&d.y&&!d.equals(this.oldViewerSize)&&(this.oldViewerSize=d,this.maintainSizeRatio||!this.elementArea?(c=d.x*this.sizeRatio,p=d.y*this.sizeRatio):(c=Math.sqrt(this.elementArea*(d.x/d.y)),p=this.elementArea/c),this.element.style.width=Math.round(c)+"px",this.element.style.height=Math.round(p)+"px",this.elementArea||(this.elementArea=c*p),this.updateSize()),r&&this.viewport){w=r.getBoundsNoRotate(!0),y=this.viewport.pixelFromPointNoRotate(w.getTopLeft(),!1),R=this.viewport.pixelFromPointNoRotate(w.getBottomRight(),!1).minus(this.totalBorderWidths);var b=this.displayRegion.style;b.display=this.world.getItemCount()?"block":"none",b.top=Math.round(y.y)+"px",b.left=Math.round(y.x)+"px";var N=Math.abs(y.x-R.x),h=Math.abs(y.y-R.y);b.width=Math.round(Math.max(N,0))+"px",b.height=Math.round(Math.max(h,0))+"px"}},addTiledImage:function(r){var d=this,c=r.originalTiledImage;delete r.original;var p=t.extend({},r,{success:function(w){var y=w.item;y._originalForNavigator=c,d._matchBounds(y,c,!0);function R(){d._matchBounds(y,c)}function b(){d._matchOpacity(y,c)}function N(){d._matchCompositeOperation(y,c)}c.addHandler("bounds-change",R),c.addHandler("clip-change",R),c.addHandler("opacity-change",b),c.addHandler("composite-operation-change",N)}});return t.Viewer.prototype.addTiledImage.apply(this,[p])},_getMatchingItem:function(r){for(var d=this.world.getItemCount(),c,p=0;p<d;p++)if(c=this.world.getItemAt(p),c._originalForNavigator===r)return c;return null},_matchBounds:function(r,d,c){var p=d.getBoundsNoRotate();r.setPosition(p.getTopLeft(),c),r.setWidth(p.width,c),r.setRotation(d.getRotation(),c),r.setClip(d.getClip())},_matchOpacity:function(r,d){r.setOpacity(d.opacity)},_matchCompositeOperation:function(r,d){r.setCompositeOperation(d.compositeOperation)}});function e(r){var d={tracker:r.eventSource,position:r.position,quick:r.quick,shift:r.shift,originalEvent:r.originalEvent,preventDefaultAction:r.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",d),!d.preventDefaultAction&&r.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(r.position.x=this.viewport.getContainerSize().x-r.position.x);var c=this.viewport.pointFromPixel(r.position);this.panVertical?this.panHorizontal||(c.x=this.viewer.viewport.getCenter(!0).x):c.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(c),this.viewer.viewport.applyConstraints()}}function i(r){var d={tracker:r.eventSource,position:r.position,delta:r.delta,speed:r.speed,direction:r.direction,shift:r.shift,originalEvent:r.originalEvent,preventDefaultAction:r.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",d),!d.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(r.delta.x=0),this.panVertical||(r.delta.y=0),this.viewer.viewport.flipped&&(r.delta.x=-r.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(r.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(r){r.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function s(r){return this.viewer.raiseEvent("navigator-scroll",{tracker:r.eventSource,position:r.position,scroll:r.scroll,shift:r.shift,originalEvent:r.originalEvent}),!1}function o(r,d){a(r,"rotate("+d+"deg)")}function a(r,d){r.style.webkitTransform=d,r.style.mozTransform=d,r.style.msTransform=d,r.style.oTransform=d,r.style.transform=d}})(OpenSeadragon);(function(t){var e={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(i){var n=i.split("."),s=null,o=arguments,a=e,r;for(r=0;r<n.length-1;r++)a=a[n[r]]||{};return s=a[n[r]],typeof s!="string"&&(t.console.log("Untranslated source string:",i),s=""),s.replace(/\{\d+\}/g,function(d){var c=parseInt(d.match(/\d+/),10)+1;return c<o.length?o[c]:""})},setString:function(i,n){var s=i.split("."),o=e,a;for(a=0;a<s.length-1;a++)o[s[a]]||(o[s[a]]={}),o=o[s[a]];o[s[a]]=n}})})(OpenSeadragon);(function(t){t.Point=function(e,i){this.x=typeof e=="number"?e:0,this.y=typeof i=="number"?i:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},times:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new t.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,i){i=i||new t.Point(0,0);var n,s;if(e%90==0){var o=t.positiveModulo(e,360);switch(o){case 0:n=1,s=0;break;case 90:n=0,s=1;break;case 180:n=-1,s=0;break;case 270:n=0,s=-1;break}}else{var a=e*Math.PI/180;n=Math.cos(a),s=Math.sin(a)}var r=n*(this.x-i.x)-s*(this.y-i.y)+i.x,d=s*(this.x-i.x)+n*(this.y-i.y)+i.y;return new t.Point(r,d)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}})(OpenSeadragon);(function(t){t.TileSource=function(i,n,s,o,a,r){var d=this,c=arguments,p,w;if(t.isPlainObject(i)?p=i:p={width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},t.EventSource.call(this),t.extend(!0,this,p),!this.success){for(w=0;w<arguments.length;w++)if(t.isFunction(arguments[w])){this.success=arguments[w];break}}this.success&&this.addHandler("ready",function(y){d.success(y)}),t.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=p.width&&p.height?p.width/p.height:1,this.dimensions=new t.Point(p.width,p.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=p.tileOverlap?p.tileOverlap:0,this.minLevel=p.minLevel?p.minLevel:0,this.maxLevel=p.maxLevel!==void 0&&p.maxLevel!==null?p.maxLevel:p.width&&p.height?Math.ceil(Math.log(Math.max(p.width,p.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(i){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(i){return this._tileWidth?this._tileWidth:this.getTileSize(i)},getTileHeight:function(i){return this._tileHeight?this._tileHeight:this.getTileSize(i)},getLevelScale:function(i){var n={},s;for(s=0;s<=this.maxLevel;s++)n[s]=1/Math.pow(2,this.maxLevel-s);return this.getLevelScale=function(o){return n[o]},this.getLevelScale(i)},getNumTiles:function(i){var n=this.getLevelScale(i),s=Math.ceil(n*this.dimensions.x/this.getTileWidth(i)),o=Math.ceil(n*this.dimensions.y/this.getTileHeight(i));return new t.Point(s,o)},getPixelRatio:function(i){var n=this.dimensions.times(this.getLevelScale(i)),s=1/n.x,o=1/n.y;return new t.Point(s,o)},getClosestLevel:function(){var i,n;for(i=this.minLevel+1;i<=this.maxLevel&&(n=this.getNumTiles(i),!(n.x>1||n.y>1));i++);return i-1},getTileAtPoint:function(i,n){var s=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;t.console.assert(s,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(i),a=n.x*o,r=n.y*o,d=Math.floor(a/this.getTileWidth(i)),c=Math.floor(r/this.getTileHeight(i));n.x>=1&&(d=this.getNumTiles(i).x-1);var p=1e-15;return n.y>=1/this.aspectRatio-p&&(c=this.getNumTiles(i).y-1),new t.Point(d,c)},getTileBounds:function(i,n,s,o){var a=this.dimensions.times(this.getLevelScale(i)),r=this.getTileWidth(i),d=this.getTileHeight(i),c=n===0?0:r*n-this.tileOverlap,p=s===0?0:d*s-this.tileOverlap,w=r+(n===0?1:2)*this.tileOverlap,y=d+(s===0?1:2)*this.tileOverlap,R=1/a.x;return w=Math.min(w,a.x-c),y=Math.min(y,a.y-p),o?new t.Rect(0,0,w,y):new t.Rect(c*R,p*R,w*R,y*R)},getImageInfo:function(i){var n=this,s,o,a,r,d,c,p;i&&(d=i.split("/"),c=d[d.length-1],p=c.lastIndexOf("."),p>-1&&(d[d.length-1]=c.slice(0,p))),o=function(w){typeof w=="string"&&(w=t.parseXml(w));var y=t.TileSource.determineType(n,w,i);if(!y){n.raiseEvent("open-failed",{message:"Unable to load TileSource",source:i});return}r=y.prototype.configure.apply(n,[w,i]),r.ajaxWithCredentials===void 0&&(r.ajaxWithCredentials=n.ajaxWithCredentials),a=new y(r),n.ready=!0,n.raiseEvent("ready",{tileSource:a})},i.match(/\.js$/)?(s=i.split("/").pop().replace(".js",""),t.jsonp({url:i,async:!1,callbackName:s,callback:o})):t.makeAjaxRequest({url:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(w){var y=e(w);o(y)},error:function(w,y){var R;try{R="HTTP "+w.status+" attempting to load TileSource"}catch{var b;typeof y=="undefined"||!y.toString?b="Unknown error":b=y.toString(),R=b+" attempting to load TileSource"}n.raiseEvent("open-failed",{message:R,source:i})}})},supports:function(i,n){return!1},configure:function(i,n){throw new Error("Method not implemented.")},getTileUrl:function(i,n,s){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(i,n,s){return{}},tileExists:function(i,n,s){var o=this.getNumTiles(i);return i>=this.minLevel&&i<=this.maxLevel&&n>=0&&s>=0&&n<o.x&&s<o.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function e(i){var n=i.responseText,s=i.status,o,a;if(i){if(i.status!==200&&i.status!==0)throw s=i.status,o=s==404?"Not Found":i.statusText,new Error(t.getString("Errors.Status",s,o))}else throw new Error(t.getString("Errors.Security"));if(n.match(/\s*<.*/))try{a=i.responseXML&&i.responseXML.documentElement?i.responseXML:t.parseXml(n)}catch{a=i.responseText}else if(n.match(/\s*[\{\[].*/))try{a=t.parseJSON(n)}catch{a=n}else a=n;return a}t.TileSource.determineType=function(i,n,s){var o;for(o in OpenSeadragon)if(o.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[o])&&t.isFunction(OpenSeadragon[o].prototype.supports)&&OpenSeadragon[o].prototype.supports.call(i,n,s))return OpenSeadragon[o];t.console.error("No TileSource was able to open %s %s",s,n)}})(OpenSeadragon);(function(t){t.DziTileSource=function(n,s,o,a,r,d,c,p,w){var y,R,b,N;if(t.isPlainObject(n)?N=n:N={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=N.tilesUrl,this.fileFormat=N.fileFormat,this.displayRects=N.displayRects,this.displayRects)for(y=this.displayRects.length-1;y>=0;y--)for(R=this.displayRects[y],b=R.minLevel;b<=R.maxLevel;b++)this._levelRects[b]||(this._levelRects[b]=[]),this._levelRects[b].push(R);t.TileSource.apply(this,[N])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(n,s){var o;return n.Image?o=n.Image.xmlns:n.documentElement&&(n.documentElement.localName=="Image"||n.documentElement.tagName=="Image")&&(o=n.documentElement.namespaceURI),o=(o||"").toLowerCase(),o.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||o.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(n,s){var o;return t.isPlainObject(n)?o=i(this,n):o=e(this,n),s&&!o.tilesUrl&&(o.tilesUrl=s.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),s.search(/\.(dzi|xml|js)\?/)!=-1?o.queryParams=s.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(n,s,o){return[this.tilesUrl,n,"/",s,"_",o,".",this.fileFormat,this.queryParams].join("")},tileExists:function(n,s,o){var a=this._levelRects[n],r,d,c,p,w,y,R;if(this.minLevel&&n<this.minLevel||this.maxLevel&&n>this.maxLevel)return!1;if(!a||!a.length)return!0;for(R=a.length-1;R>=0;R--)if(r=a[R],!(n<r.minLevel||n>r.maxLevel)&&(d=this.getLevelScale(n),c=r.x*d,p=r.y*d,w=c+r.width*d,y=p+r.height*d,c=Math.floor(c/this._tileWidth),p=Math.floor(p/this._tileWidth),w=Math.ceil(w/this._tileWidth),y=Math.ceil(y/this._tileWidth),c<=s&&s<w&&p<=o&&o<y))return!0;return!1}});function e(n,s){if(!s||!s.documentElement)throw new Error(t.getString("Errors.Xml"));var o=s.documentElement,a=o.localName||o.tagName,r=s.documentElement.namespaceURI,d=null,c=[],p,w,y,R,b;if(a=="Image")try{if(R=o.getElementsByTagName("Size")[0],R===void 0&&(R=o.getElementsByTagNameNS(r,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(R.getAttribute("Height"),10),Width:parseInt(R.getAttribute("Width"),10)}}},!t.imageFormatSupported(d.Image.Format))throw new Error(t.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(p=o.getElementsByTagName("DisplayRect"),p===void 0&&(p=o.getElementsByTagNameNS(r,"DisplayRect")[0]),b=0;b<p.length;b++)w=p[b],y=w.getElementsByTagName("Rect")[0],y===void 0&&(y=w.getElementsByTagNameNS(r,"Rect")[0]),c.push({Rect:{X:parseInt(y.getAttribute("X"),10),Y:parseInt(y.getAttribute("Y"),10),Width:parseInt(y.getAttribute("Width"),10),Height:parseInt(y.getAttribute("Height"),10),MinLevel:parseInt(w.getAttribute("MinLevel"),10),MaxLevel:parseInt(w.getAttribute("MaxLevel"),10)}});return c.length&&(d.Image.DisplayRect=c),i(n,d)}catch(x){throw x instanceof Error?x:new Error(t.getString("Errors.Dzi"))}else{if(a=="Collection")throw new Error(t.getString("Errors.Dzc"));if(a=="Error"){var N=o.getElementsByTagName("Message")[0],h=N.firstChild.nodeValue;throw new Error(h)}}throw new Error(t.getString("Errors.Dzi"))}function i(n,s){var o=s.Image,a=o.Url,r=o.Format,d=o.Size,c=o.DisplayRect||[],p=parseInt(d.Width,10),w=parseInt(d.Height,10),y=parseInt(o.TileSize,10),R=parseInt(o.Overlap,10),b=[],N,h;for(h=0;h<c.length;h++)N=c[h].Rect,b.push(new t.DisplayRect(parseInt(N.X,10),parseInt(N.Y,10),parseInt(N.Width,10),parseInt(N.Height,10),parseInt(N.MinLevel,10),parseInt(N.MaxLevel,10)));return t.extend(!0,{width:p,height:w,tileSize:y,tileOverlap:R,minLevel:null,maxLevel:null,tilesUrl:a,fileFormat:r,displayRects:b},s)}})(OpenSeadragon);(function(t){t.IIIFTileSource=function(o){if(t.extend(!0,this,o),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var a=0;a<this.tiles.length;a++)for(var r=0;r<this.tiles[a].scaleFactors.length;r++){var d=this.tiles[a].scaleFactors[r];this.scale_factors.push(d),o.tileSizePerScaleFactor[d]={width:this.tiles[a].width,height:this.tiles[a].height||this.tiles[a].width}}}else if(e(o)){for(var c=Math.min(this.height,this.width),p=[256,512,1024],w=[],y=0;y<p.length;y++)p[y]<=c&&w.push(p[y]);w.length>0?o.tileSize=Math.max.apply(null,w):o.tileSize=c}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=i(this),t.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)o.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var R=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(R)*Math.LOG2E)}t.TileSource.apply(this,[o])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(o,a){return o.protocol&&o.protocol=="http://iiif.io/api/image"||o["@context"]&&(o["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||o["@context"]=="http://iiif.io/api/image/1/context.json")||o.profile&&o.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||o.identifier&&o.width&&o.height?!0:!!(o.documentElement&&o.documentElement.tagName=="info"&&o.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(o,a){if(t.isPlainObject(o)){if(!o["@context"])o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=a.replace("/info.json",""),o.version=1;else{var d=o["@context"];if(Array.isArray(d)){for(var c=0;c<d.length;c++)if(typeof d[c]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(d[c])||d[c]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){d=d[c];break}}switch(d){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!o["@id"]&&o.id&&(o["@id"]=o.id),o.preferredFormats){for(var p=0;p<o.preferredFormats.length;p++)if(OpenSeadragon.imageFormatSupported(o.preferredFormats[p])){o.tileFormat=o.preferredFormats[p];break}}return o}else{var r=n(o);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=a.replace("/info.xml",""),r.version=1,r}},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a}return t.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){if(this.emulateLegacyImagePyramid){var a=this.getLevelScale(o);return a?new t.Point(1,1):new t.Point(0,0)}return t.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,a){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,o,a)},getTileUrl:function(o,a,r){if(this.emulateLegacyImagePyramid){var d=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(d=this.levels[o].url),d}var c="0",p=Math.pow(.5,this.maxLevel-o),w=Math.ceil(this.width*p),y=Math.ceil(this.height*p),R,b,N,h,x,T,S,P,O,M,L,U,Q,V;return R=this.getTileWidth(o),b=this.getTileHeight(o),N=Math.ceil(R/p),h=Math.ceil(b/p),this.version===1?Q="native."+this.tileFormat:Q="default."+this.tileFormat,w<R&&y<b?(this.version===2&&w===this.width||this.version===3&&w===this.width&&y===this.height?M="max":this.version===3?M=w+","+y:M=w+",",x="full"):(T=a*N,S=r*h,P=Math.min(N,this.width-T),O=Math.min(h,this.height-S),a===0&&r===0&&P===this.width&&O===this.height?x="full":x=[T,S,P,O].join(","),L=Math.ceil(P*p),U=Math.ceil(O*p),this.version===2&&L===this.width||this.version===3&&L===this.width&&U===this.height?M="max":this.version===3?M=L+","+U:M=L+","),V=[this["@id"],x,M,c,Q].join("/"),V},__testonly__:{canBeTiled:e,constructLevels:i}});function e(o){var a=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],r=Array.isArray(o.profile)?o.profile[0]:o.profile,d=a.indexOf(r)!==-1,c=!1;return o.version===2&&o.profile.length>1&&o.profile[1].supports&&(c=o.profile[1].supports.indexOf("sizeByW")!==-1),o.version===3&&o.extraFeatures&&(c=o.extraFeatures.indexOf("sizeByWh")!==-1),!d||c}function i(o){for(var a=[],r=0;r<o.sizes.length;r++)a.push({url:o["@id"]+"/full/"+o.sizes[r].width+","+(o.version===3?o.sizes[r].height:"")+"/0/default."+o.tileFormat,width:o.sizes[r].width,height:o.sizes[r].height});return a.sort(function(d,c){return d.width-c.width})}function n(o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var a=o.documentElement,r=a.tagName,d=null;if(r=="info")try{return d={},s(a,d),d}catch(c){throw c instanceof Error?c:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function s(o,a,r){var d,c;if(o.nodeType==3&&r)c=o.nodeValue.trim(),c.match(/^\d*$/)&&(c=Number(c)),a[r]?(t.isArray(a[r])||(a[r]=[a[r]]),a[r].push(c)):a[r]=c;else if(o.nodeType==1)for(d=0;d<o.childNodes.length;d++)s(o.childNodes[d],a,o.nodeName)}})(OpenSeadragon);(function(t){t.OsmTileSource=function(e,i,n,s,o){var a;t.isPlainObject(e)?a=e:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!a.width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,t.TileSource.apply(this,[a])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&e.type=="openstreetmaps"},configure:function(e,i){return e},getTileUrl:function(e,i,n){return this.tilesUrl+(e-8)+"/"+i+"/"+n+".png"}})})(OpenSeadragon);(function(t){t.TmsTileSource=function(e,i,n,s,o){var a;t.isPlainObject(e)?a=e:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var r=Math.ceil(a.width/256)*256,d=Math.ceil(a.height/256)*256,c;r>d?c=r/256:c=d/256,a.maxLevel=Math.ceil(Math.log(c)/Math.log(2))-1,a.tileSize=256,a.width=r,a.height=d,t.TileSource.apply(this,[a])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&e.type=="tiledmapservice"},configure:function(e,i){return e},getTileUrl:function(e,i,n){var s=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+i+"/"+(s-n)+".png"}})})(OpenSeadragon);(function(t){t.ZoomifyTileSource=function(e){e.tileSize=256;var i={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(i.x,10)>e.tileSize||parseInt(i.y,10)>e.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),e.imageSizes.push({x:i.x,y:i.y}),e.gridSize.push(this._getGridSize(i.x,i.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(e,i,n){return{x:Math.ceil(e/n),y:Math.ceil(i/n)}},_calculateAbsoluteTileNumber:function(e,i,n){for(var s=0,o={},a=0;a<e;a++)o=this.gridSize[a],s+=o.x*o.y;return o=this.gridSize[e],s+=o.x*n+i,s},supports:function(e,i){return e.type&&e.type=="zoomifytileservice"},configure:function(e,i){return e},getTileUrl:function(e,i,n){var s=0,o=this._calculateAbsoluteTileNumber(e,i,n);return s=Math.floor(o/256),this.tilesUrl+"TileGroup"+s+"/"+e+"-"+i+"-"+n+".jpg"}})})(OpenSeadragon);(function(t){t.LegacyTileSource=function(s){var o,a,r;t.isArray(s)&&(o={type:"legacy-image-pyramid",levels:s}),o.levels=e(o.levels),o.levels.length>0?(a=o.levels[o.levels.length-1].width,r=o.levels[o.levels.length-1].height):(a=0,r=0,t.console.error("No supported image formats found")),t.extend(!0,o,{width:a,height:r,tileSize:Math.max(r,a),tileOverlap:0,minLevel:0,maxLevel:o.levels.length>0?o.levels.length-1:0}),t.TileSource.apply(this,[o]),this.levels=o.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(s,o){return s.type&&s.type=="legacy-image-pyramid"||s.documentElement&&s.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(s,o){var a;return t.isPlainObject(s)?a=n(this,s):a=i(this,s),a},getLevelScale:function(s){var o=NaN;return this.levels.length>0&&s>=this.minLevel&&s<=this.maxLevel&&(o=this.levels[s].width/this.levels[this.maxLevel].width),o},getNumTiles:function(s){var o=this.getLevelScale(s);return o?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(s,o,a){var r=null;return this.levels.length>0&&s>=this.minLevel&&s<=this.maxLevel&&(r=this.levels[s].url),r}});function e(s){var o=[],a,r;for(r=0;r<s.length;r++)a=s[r],a.height&&a.width&&a.url?o.push({url:a.url,width:Number(a.width),height:Number(a.height)}):t.console.error("Unsupported image format: %s",a.url?a.url:"<no URL>");return o.sort(function(d,c){return d.height-c.height})}function i(s,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var a=o.documentElement,r=a.tagName,d=null,c=[],p,w;if(r=="image")try{for(d={type:a.getAttribute("type"),levels:[]},c=a.getElementsByTagName("level"),w=0;w<c.length;w++)p=c[w],d.levels.push({url:p.getAttribute("url"),width:parseInt(p.getAttribute("width"),10),height:parseInt(p.getAttribute("height"),10)});return n(s,d)}catch(y){throw y instanceof Error?y:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(r=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(r=="error")throw new Error("Error: "+o)}throw new Error("Unknown element "+r)}function n(s,o){return o.levels}})(OpenSeadragon);(function(t){t.ImageTileSource=function(e){e=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),t.TileSource.apply(this,[e])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&e.type==="image"},configure:function(e,i){return e},getImageInfo:function(e){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),t.addEvent(i,"load",function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),i.src=e},getLevelScale:function(e){var i=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].width/this.levels[this.maxLevel].width),i},getNumTiles:function(e){var i=this.getLevelScale(e);return i?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(e,i,n){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].url),s},getContext2D:function(e,i,n){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].context2D),s},_buildLevels:function(){var e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,e;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,s=document.createElement("canvas"),o=s.getContext("2d");if(s.width=i,s.height=n,o.drawImage(this._image,0,0,i,n),e[0].context2D=o,delete this._image,t.isCanvasTainted(s))return e;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var a=document.createElement("canvas"),r=a.getContext("2d");a.width=i,a.height=n,r.drawImage(s,0,0,i,n),e.splice(0,0,{context2D:r,width:i,height:n}),s=a,o=r}return e}})})(OpenSeadragon);(function(t){t.TileSourceCollection=function(e,i,n,s){t.console.error("TileSourceCollection is deprecated; use World instead")}})(OpenSeadragon);(function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(r){var d=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},r),this.element=r.element||t.makeNeutralElement("div"),r.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(c){c.insideElementPressed?(o(d,t.ButtonState.DOWN),d.raiseEvent("enter",{originalEvent:c.originalEvent})):c.buttonDownAny||o(d,t.ButtonState.HOVER)},focusHandler:function(c){this.enterHandler(c),d.raiseEvent("focus",{originalEvent:c.originalEvent})},exitHandler:function(c){a(d,t.ButtonState.GROUP),c.insideElementPressed&&d.raiseEvent("exit",{originalEvent:c.originalEvent})},blurHandler:function(c){this.exitHandler(c),d.raiseEvent("blur",{originalEvent:c.originalEvent})},pressHandler:function(c){o(d,t.ButtonState.DOWN),d.raiseEvent("press",{originalEvent:c.originalEvent})},releaseHandler:function(c){c.insideElementPressed&&c.insideElementReleased?(a(d,t.ButtonState.HOVER),d.raiseEvent("release",{originalEvent:c.originalEvent})):c.insideElementPressed?a(d,t.ButtonState.GROUP):o(d,t.ButtonState.HOVER)},clickHandler:function(c){c.quick&&d.raiseEvent("click",{originalEvent:c.originalEvent})},keyHandler:function(c){return c.keyCode===13?(d.raiseEvent("click",{originalEvent:c.originalEvent}),d.raiseEvent("release",{originalEvent:c.originalEvent}),!1):!0}}),a(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){o(this,t.ButtonState.GROUP)},notifyGroupExit:function(){a(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function e(r){t.requestAnimationFrame(function(){i(r)})}function i(r){var d,c,p;r.shouldFade&&(d=t.now(),c=d-r.fadeBeginTime,p=1-c/r.fadeLength,p=Math.min(1,p),p=Math.max(0,p),r.imgGroup&&t.setElementOpacity(r.imgGroup,p,!0),p>0&&e(r))}function n(r){r.shouldFade=!0,r.fadeBeginTime=t.now()+r.fadeDelay,window.setTimeout(function(){e(r)},r.fadeDelay)}function s(r){r.shouldFade=!1,r.imgGroup&&t.setElementOpacity(r.imgGroup,1,!0)}function o(r,d){r.element.disabled||(d>=t.ButtonState.GROUP&&r.currentState==t.ButtonState.REST&&(s(r),r.currentState=t.ButtonState.GROUP),d>=t.ButtonState.HOVER&&r.currentState==t.ButtonState.GROUP&&(r.imgHover&&(r.imgHover.style.visibility=""),r.currentState=t.ButtonState.HOVER),d>=t.ButtonState.DOWN&&r.currentState==t.ButtonState.HOVER&&(r.imgDown&&(r.imgDown.style.visibility=""),r.currentState=t.ButtonState.DOWN))}function a(r,d){r.element.disabled||(d<=t.ButtonState.HOVER&&r.currentState==t.ButtonState.DOWN&&(r.imgDown&&(r.imgDown.style.visibility="hidden"),r.currentState=t.ButtonState.HOVER),d<=t.ButtonState.GROUP&&r.currentState==t.ButtonState.HOVER&&(r.imgHover&&(r.imgHover.style.visibility="hidden"),r.currentState=t.ButtonState.GROUP),d<=t.ButtonState.REST&&r.currentState==t.ButtonState.GROUP&&(n(r),r.currentState=t.ButtonState.REST))}})(OpenSeadragon);(function(t){t.ButtonGroup=function(e){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var i=this.buttons.concat([]),n=this,s;if(this.element=e.element||t.makeNeutralElement("div"),!e.group)for(this.element.style.display="inline-block",s=0;s<i.length;s++)this.element.appendChild(i[s].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var a;for(a=0;a<n.buttons.length;a++)n.buttons[a].notifyGroupEnter()},exitHandler:function(o){var a;if(!o.insideElementPressed)for(a=0;a<n.buttons.length;a++)n.buttons[a].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}})(OpenSeadragon);(function(t){t.Rect=function(e,i,n,s,o){this.x=typeof e=="number"?e:0,this.y=typeof i=="number"?i:0,this.width=typeof n=="number"?n:0,this.height=typeof s=="number"?s:0,this.degrees=typeof o=="number"?o:0,this.degrees=t.positiveModulo(this.degrees,360);var a,r;this.degrees>=270?(a=this.getTopRight(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=270):this.degrees>=180?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):this.degrees>=90&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=90)},t.Rect.fromSummits=function(e,i,n){var s=e.distanceTo(i),o=e.distanceTo(n),a=i.minus(e),r=Math.atan(a.y/a.x);return a.x<0?r+=Math.PI:a.y<0&&(r+=2*Math.PI),new t.Rect(e.x,e.y,s,o,r/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(e){return e instanceof t.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new t.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new t.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var i=this.getBoundingBox(),n=e.getBoundingBox(),s=Math.min(i.x,n.x),o=Math.min(i.y,n.y),a=Math.max(i.x+i.width,n.x+n.width),r=Math.max(i.y+i.height,n.y+n.height);return new t.Rect(s,o,a-s,r-o)},intersection:function(e){var i=1e-10,n=[],s=this.getTopLeft();e.containsPoint(s,i)&&n.push(s);var o=this.getTopRight();e.containsPoint(o,i)&&n.push(o);var a=this.getBottomLeft();e.containsPoint(a,i)&&n.push(a);var r=this.getBottomRight();e.containsPoint(r,i)&&n.push(r);var d=e.getTopLeft();this.containsPoint(d,i)&&n.push(d);var c=e.getTopRight();this.containsPoint(c,i)&&n.push(c);var p=e.getBottomLeft();this.containsPoint(p,i)&&n.push(p);var w=e.getBottomRight();this.containsPoint(w,i)&&n.push(w);for(var y=this._getSegments(),R=e._getSegments(),b=0;b<y.length;b++)for(var N=y[b],h=0;h<R.length;h++){var x=R[h],T=S(N[0],N[1],x[0],x[1]);T&&n.push(T)}function S(V,Y,X,oe){var re=Y.minus(V),le=oe.minus(X),se=-le.x*re.y+re.x*le.y;if(se===0)return null;var G=(re.x*(V.y-X.y)-re.y*(V.x-X.x))/se,pe=(le.x*(V.y-X.y)-le.y*(V.x-X.x))/se;return-i<=G&&G<=1-i&&-i<=pe&&pe<=1-i?new t.Point(V.x+pe*re.x,V.y+pe*re.y):null}if(n.length===0)return null;for(var P=n[0].x,O=n[0].x,M=n[0].y,L=n[0].y,U=1;U<n.length;U++){var Q=n[U];Q.x<P&&(P=Q.x),Q.x>O&&(O=Q.x),Q.y<M&&(M=Q.y),Q.y>L&&(L=Q.y)}return new t.Rect(P,M,O-P,L-M)},_getSegments:function(){var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight();return[[e,i],[i,s],[s,n],[n,e]]},rotate:function(e,i){if(e=t.positiveModulo(e,360),e===0)return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(e,i),s=this.getTopRight().rotate(e,i),o=s.minus(n);o=o.apply(function(r){var d=1e-15;return Math.abs(r)<d?0:r});var a=Math.atan(o.y/o.x);return o.x<0?a+=Math.PI:o.y<0&&(a+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,a/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight(),o=Math.min(e.x,i.x,n.x,s.x),a=Math.max(e.x,i.x,n.x,s.x),r=Math.min(e.y,i.y,n.y,s.y),d=Math.max(e.y,i.y,n.y,s.y);return new t.Rect(o,r,a-o,d-r)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),i=Math.floor(e.x),n=Math.floor(e.y),s=Math.ceil(e.width+e.x-i),o=Math.ceil(e.height+e.y-n);return new t.Rect(i,n,s,o)},containsPoint:function(e,i){i=i||0;var n=this.getTopLeft(),s=this.getTopRight(),o=this.getBottomLeft(),a=s.minus(n),r=o.minus(n);return(e.x-n.x)*a.x+(e.y-n.y)*a.y>=-i&&(e.x-s.x)*a.x+(e.y-s.y)*a.y<=i&&(e.x-n.x)*r.x+(e.y-n.y)*r.y>=-i&&(e.x-o.x)*r.x+(e.y-o.y)*r.y<=i},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}})(OpenSeadragon);(function(t){var e={};t.ReferenceStrip=function(c){var p=this,w=c.viewer,y=t.getElementSize(w.element),R,b,N;for(c.id||(c.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=c.id,this.element.className="referencestrip"),c=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},c,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,c),e[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,b=this.element.style,b.marginTop="0px",b.marginRight="0px",b.marginBottom="0px",b.marginLeft="0px",b.left="0px",b.bottom="0px",b.border="0px",b.background="#000",b.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=w,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,i),scrollHandler:t.delegate(this,n),enterHandler:t.delegate(this,o),exitHandler:t.delegate(this,a),keyDownHandler:t.delegate(this,r),keyHandler:t.delegate(this,d)}),c.width&&c.height?(this.element.style.width=c.width+"px",this.element.style.height=c.height+"px",w.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):c.scroll=="horizontal"?(this.element.style.width=y.x*c.sizeRatio*w.tileSources.length+12*w.tileSources.length+"px",this.element.style.height=y.y*c.sizeRatio+"px",w.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=y.y*c.sizeRatio*w.tileSources.length+12*w.tileSources.length+"px",this.element.style.width=y.x*c.sizeRatio+"px",w.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=y.x*this.sizeRatio+8,this.panelHeight=y.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},N=0;N<w.tileSources.length;N++)R=t.makeNeutralElement("div"),R.id=this.element.id+"-"+N,R.style.width=p.panelWidth+"px",R.style.height=p.panelHeight+"px",R.style.display="inline",R.style.float="left",R.style.cssFloat="left",R.style.styleFloat="left",R.style.padding="2px",t.setElementTouchActionNone(R),R.innerTracker=new t.MouseTracker({element:R,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(h){h.eventSource.dragging=t.now()},releaseHandler:function(h){var x=h.eventSource,T=x.element.id,S=Number(T.split("-")[2]),P=t.now();h.insideElementPressed&&h.insideElementReleased&&x.dragging&&P-x.dragging<x.clickTimeThreshold&&(x.dragging=null,w.goToPage(S))}}),this.element.appendChild(R),R.activePanel=!1,this.panels.push(R);s(this,this.scroll=="vertical"?y.y:y.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(c){var p=this.element.querySelector("#"+this.element.id+"-"+c),w=t.getElementSize(this.viewer.canvas),y=Number(this.element.style.width.replace("px","")),R=Number(this.element.style.height.replace("px","")),b=-Number(this.element.style.marginLeft.replace("px","")),N=-Number(this.element.style.marginTop.replace("px","")),h;this.currentSelected!==p&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=p,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(h=Number(c)*(this.panelWidth+3),h>b+w.x-this.panelWidth?(h=Math.min(h,y-w.x),this.element.style.marginLeft=-h+"px",s(this,w.x,-h)):h<b&&(h=Math.max(0,h-w.x/2),this.element.style.marginLeft=-h+"px",s(this,w.x,-h))):(h=Number(c)*(this.panelHeight+3),h>N+w.y-this.panelHeight?(h=Math.min(h,R-w.y),this.element.style.marginTop=-h+"px",s(this,w.y,-h)):h<N&&(h=Math.max(0,h-w.y/2),this.element.style.marginTop=-h+"px",s(this,w.y,-h))),this.currentPage=c,o.call(this,{eventSource:this.innerTracker}))},update:function(){return e[this.id].animating?(t.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var c in this.miniViewers)this.miniViewers[c].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function i(c){var p=Number(this.element.style.marginLeft.replace("px","")),w=Number(this.element.style.marginTop.replace("px","")),y=Number(this.element.style.width.replace("px","")),R=Number(this.element.style.height.replace("px","")),b=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-c.delta.x>0?p>-(y-b.x)&&(this.element.style.marginLeft=p+c.delta.x*2+"px",s(this,b.x,p+c.delta.x*2)):-c.delta.x<0&&p<0&&(this.element.style.marginLeft=p+c.delta.x*2+"px",s(this,b.x,p+c.delta.x*2)):-c.delta.y>0?w>-(R-b.y)&&(this.element.style.marginTop=w+c.delta.y*2+"px",s(this,b.y,w+c.delta.y*2)):-c.delta.y<0&&w<0&&(this.element.style.marginTop=w+c.delta.y*2+"px",s(this,b.y,w+c.delta.y*2))),!1}function n(c){var p=Number(this.element.style.marginLeft.replace("px","")),w=Number(this.element.style.marginTop.replace("px","")),y=Number(this.element.style.width.replace("px","")),R=Number(this.element.style.height.replace("px","")),b=t.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?c.scroll>0?p>-(y-b.x)&&(this.element.style.marginLeft=p-c.scroll*60+"px",s(this,b.x,p-c.scroll*60)):c.scroll<0&&p<0&&(this.element.style.marginLeft=p-c.scroll*60+"px",s(this,b.x,p-c.scroll*60)):c.scroll<0?w>b.y-R&&(this.element.style.marginTop=w+c.scroll*60+"px",s(this,b.y,w+c.scroll*60)):c.scroll>0&&w<0&&(this.element.style.marginTop=w+c.scroll*60+"px",s(this,b.y,w+c.scroll*60))),!1}function s(c,p,w){var y,R,b,N,h,x,T;for(c.scroll=="horizontal"?y=c.panelWidth:y=c.panelHeight,R=Math.ceil(p/y)+5,b=Math.ceil((Math.abs(w)+p)/y)+1,R=b-R,R=R<0?0:R,x=R;x<b&&x<c.panels.length;x++)if(T=c.panels[x],!T.activePanel){var S,P=c.viewer.tileSources[x];P.referenceStripThumbnailUrl?S={type:"image",url:P.referenceStripThumbnailUrl}:S=P,N=new t.Viewer({id:T.id,tileSources:[S],element:T,navigatorSizeRatio:c.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:c.viewer.loadTilesWithAjax,ajaxHeaders:c.viewer.ajaxHeaders,useCanvas:c.useCanvas}),N.displayRegion=t.makeNeutralElement("div"),N.displayRegion.id=T.id+"-displayregion",N.displayRegion.className="displayregion",h=N.displayRegion.style,h.position="relative",h.top="0px",h.left="0px",h.fontSize="0px",h.overflow="hidden",h.float="left",h.cssFloat="left",h.styleFloat="left",h.zIndex=999999999,h.cursor="default",h.width=c.panelWidth-4+"px",h.height=c.panelHeight-4+"px",N.displayRegion.innerTracker=new t.MouseTracker({element:N.displayRegion,startDisabled:!0}),T.getElementsByTagName("div")[0].appendChild(N.displayRegion),c.miniViewers[T.id]=N,T.activePanel=!0}}function o(c){var p=c.eventSource.element;return this.scroll=="horizontal"?p.style.marginBottom="0px":p.style.marginLeft="0px",!1}function a(c){var p=c.eventSource.element;return this.scroll=="horizontal"?p.style.marginBottom="-"+t.getElementSize(p).y/2+"px":p.style.marginLeft="-"+t.getElementSize(p).x/2+"px",!1}function r(c){if(!c.preventDefaultAction&&!c.ctrl&&!c.alt&&!c.meta)switch(c.keyCode){case 38:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function d(c){if(!c.preventDefaultAction&&!c.ctrl&&!c.alt&&!c.meta)switch(c.keyCode){case 61:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}})(OpenSeadragon);(function(t){t.DisplayRect=function(e,i,n,s,o,a){t.Rect.apply(this,[e,i,n,s]),this.minLevel=o,this.maxLevel=a},t.extend(t.DisplayRect.prototype,t.Rect.prototype)})(OpenSeadragon);(function(t){t.Spring=function(i){var n=arguments;typeof i!="object"&&(i={initial:n.length&&typeof n[0]=="number"?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),t.console.assert(typeof i.springStiffness=="number"&&i.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof i.animationTime=="number"&&i.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),i.exponential&&(this._exponential=!0,delete i.exponential),t.extend(!0,this,i),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(i){t.console.assert(!this._exponential||i!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=i,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(i){t.console.assert(!this._exponential||i!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=i,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(i){this.start.value+=i,this.target.value+=i,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(i){this._exponential=i,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var i,n;this._exponential?(i=this.start._logValue,n=this.target._logValue):(i=this.start.value,n=this.target.value);var s=this.current.time>=this.target.time?n:i+(n-i)*e(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(s):this.current.value=s,o!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function e(i,n){return(1-Math.exp(i*-n))/(1-Math.exp(-i))}})(OpenSeadragon);(function(t){function e(n){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},n),this.image=null}e.prototype={errorMsg:null,start:function(){var n=this,s=this.abort;this.image=new Image,this.image.onload=function(){n.finish(!0)},this.image.onabort=this.image.onerror=function(){n.errorMsg="Image load aborted",n.finish(!1)},this.jobId=window.setTimeout(function(){n.errorMsg="Image load exceeded timeout ("+n.timeout+" ms)",n.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(o){var a;try{a=new window.Blob([o.response])}catch(p){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(p.name==="TypeError"&&r){var d=new r;d.append(o.response),a=d.getBlob()}}a.size===0&&(n.errorMsg="Empty image response.",n.finish(!1));var c=(window.URL||window.webkitURL).createObjectURL(a);n.image.src=c},error:function(o){n.errorMsg="Image load aborted - XHR error",n.finish(!1)}}),this.abort=function(){n.request.abort(),typeof s=="function"&&s()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(n){this.image.onload=this.image.onerror=this.image.onabort=null,n||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(n){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},n)},t.ImageLoader.prototype={addJob:function(n){var s=this,o=function(d){i(s,d,n.callback)},a={src:n.src,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:o,abort:n.abort,timeout:this.timeout},r=new e(a);!this.jobLimit||this.jobsInProgress<this.jobLimit?(r.start(),this.jobsInProgress++):this.jobQueue.push(r)},clear:function(){for(var n=0;n<this.jobQueue.length;n++){var s=this.jobQueue[n];typeof s.abort=="function"&&s.abort()}this.jobQueue=[]}};function i(n,s,o){var a;n.jobsInProgress--,(!n.jobLimit||n.jobsInProgress<n.jobLimit)&&n.jobQueue.length>0&&(a=n.jobQueue.shift(),a.start(),n.jobsInProgress++),o(s.image,s.errorMsg,s.request)}})(OpenSeadragon);(function(t){t.Tile=function(e,i,n,s,o,a,r,d,c,p){this.level=e,this.x=i,this.y=n,this.bounds=s,this.sourceBounds=p,this.exists=o,this.url=a,this.context2D=r,this.loadWithAjax=d,this.ajaxHeaders=c,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){if(!this.cacheImageRecord){t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",t.setElementOpacity(this.element,this.opacity)},drawCanvas:function(e,i,n,s){var o=this.position.times(t.pixelDensityRatio),a=this.size.times(t.pixelDensityRatio),r;if(!this.context2D&&!this.cacheImageRecord){t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(r=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!r){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}e.save(),e.globalAlpha=this.opacity,typeof n=="number"&&n!==1&&(o=o.times(n),a=a.times(n)),s instanceof t.Point&&(o=o.plus(s)),e.globalAlpha===1&&this._hasTransparencyChannel()&&e.clearRect(o.x,o.y,a.x,a.y),i({context:e,tile:this,rendered:r});var d,c;this.sourceBounds?(d=Math.min(this.sourceBounds.width,r.canvas.width),c=Math.min(this.sourceBounds.height,r.canvas.height)):(d=r.canvas.width,c=r.canvas.height),e.drawImage(r.canvas,0,0,d,c,o.x,o.y,a.x,a.y),e.restore()},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else if(this.context2D)e=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return e.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,i,n){var s=Math.max(1,Math.ceil((n.x-i.x)/2)),o=Math.max(1,Math.ceil((n.y-i.y)/2));return new t.Point(s,o).minus(this.position.times(t.pixelDensityRatio).times(e||1).apply(function(a){return a%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}})(OpenSeadragon);(function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(e,i,n){var s;t.isPlainObject(e)?s=e:s={element:e,location:i,placement:n},this.element=s.element,this.style=s.element.style,this._init(s)},t.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=e.placement===void 0?t.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=e.checkResize===void 0?!0:e.checkResize,this.width=e.width===void 0?null:e.width,this.height=e.height===void 0?null:e.height,this.rotationMode=e.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,i){var n=t.Placement.properties[this.placement];!n||(n.isHorizontallyCentered?e.x-=i.x/2:n.isRight&&(e.x-=i.x),n.isVerticallyCentered?e.y-=i.y/2:n.isBottom&&(e.y-=i.y))},destroy:function(){var e=this.element,i=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(i.display="none",document.body.appendChild(e))),this.onDraw=null,i.top="",i.left="",i.position="",this.width!==null&&(i.width=""),this.height!==null&&(i.height="");var n=t.getCssPropertyWithVendorPrefix("transformOrigin"),s=t.getCssPropertyWithVendorPrefix("transform");n&&s&&(i[n]="",i[s]="")},drawHTML:function(e,i){var n=this.element;n.parentNode!==e&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,e.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(n));var s=this._getOverlayPositionAndSize(i),o=s.position,a=this.size=s.size,r=s.rotate;if(this.onDraw)this.onDraw(o,a,this.element);else{var d=this.style;d.left=o.x+"px",d.top=o.y+"px",this.width!==null&&(d.width=a.x+"px"),this.height!==null&&(d.height=a.y+"px");var c=t.getCssPropertyWithVendorPrefix("transformOrigin"),p=t.getCssPropertyWithVendorPrefix("transform");c&&p&&(r?(d[c]=this._getTransformOrigin(),d[p]="rotate("+r+"deg)"):(d[c]="",d[p]="")),d.display!=="none"&&(d.display="block")}},_getOverlayPositionAndSize:function(e){var i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e);this.adjust(i,n);var s=0;if(e.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var o=new t.Rect(i.x,i.y,n.x,n.y),a=this._getBoundingBox(o,e.degrees);i=a.getTopLeft(),n=a.getSize()}else s=e.degrees;return{position:i,size:n,rotate:s}},_getSizeInPixels:function(e){var i=this.size.x,n=this.size.y;if(this.width!==null||this.height!==null){var s=e.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(i=s.x),this.height!==null&&(n=s.y)}if(this.checkResize&&(this.width===null||this.height===null)){var o=this.size=t.getElementSize(this.element);this.width===null&&(i=o.x),this.height===null&&(n=o.y)}return new t.Point(i,n)},_getBoundingBox:function(e,i){var n=this._getPlacementPoint(e);return e.rotate(i,n).getBoundingBox()},_getPlacementPoint:function(e){var i=new t.Point(e.x,e.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=e.width/2:n.isRight&&(i.x+=e.width),n.isVerticallyCentered?i.y+=e.height/2:n.isBottom&&(i.y+=e.height)),i},_getTransformOrigin:function(){var e="",i=t.Placement.properties[this.placement];return i&&(i.isLeft?e="left":i.isRight&&(e="right"),i.isTop?e+=" top":i.isBottom&&(e+=" bottom")),e},update:function(e,i){var n=t.isPlainObject(e)?e:{location:e,placement:i};this._init({location:n.location||this.location,placement:n.placement!==void 0?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==void 0?n.width:this.width,height:n.height!==void 0?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(e){t.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(i===null||n===null){var s=e.deltaPointsFromPixelsNoRotate(this.size,!0);i===null&&(i=s.x),n===null&&(n=s.y)}var o=this.location.clone();return this.adjust(o,new t.Point(i,n)),this._adjustBoundsForRotation(e,new t.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(e,i){if(!e||e.degrees===0||this.rotationMode===t.OverlayRotationMode.EXACT)return i;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return i;var n=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-e.degrees,this._getPlacementPoint(i))}}})(OpenSeadragon);(function(t){t.Drawer=function(e){t.console.assert(e.viewer,"[Drawer] options.viewer is required");var i=arguments;if(t.isPlainObject(e)||(e={source:i[0],viewport:i[1],element:i[2]}),t.console.assert(e.viewport,"[Drawer] options.viewport is required"),t.console.assert(e.element,"[Drawer] options.element is required"),e.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor=typeof e.debugGridColor=="string"?[e.debugGridColor]:e.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,e.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=t.getElement(e.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(e,i,n,s){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,i,n,s),this},updateOverlay:function(e,i,n){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,i,n),this},removeOverlay:function(e){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(e){var i=this.viewport.pixelFromPointNoRotate(e,!0);return new t.Point(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio)},clipWithPolygons:function(e,i){if(!!this.useCanvas){var n=this._getContext(i);n.beginPath(),e.forEach(function(s){s.forEach(function(o,a){n[a===0?"moveTo":"lineTo"](o.x,o.y)})}),n.clip()}},setOpacity:function(e){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(e);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,i=0,n=0;n<e.getItemCount();n++){var s=e.getItemAt(n).getOpacity();s>i&&(i=s)}return i},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var i=this._calculateSketchCanvasSize();this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,i){if(!!this.useCanvas){var n=this._getContext(e);if(i)n.clearRect(i.x,i.y,i.width,i.height);else{var s=n.canvas;n.clearRect(0,0,s.width,s.height)}}},viewportToDrawerRectangle:function(e){var i=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new t.Rect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio)},drawTile:function(e,i,n,s,o){if(t.console.assert(e,"[Drawer.drawTile] tile is required"),t.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var a=this._getContext(n);s=s||1,e.drawCanvas(a,i,s,o)}else e.drawHTML(this.canvas)},_getContext:function(e){var i=this.context;if(e){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var s=this;this.viewer.addHandler("rotate",function o(){if(s.viewport.getRotation()!==0){s.viewer.removeHandler("rotate",o);var a=s._calculateSketchCanvasSize();s.sketchCanvas.width=a.x,s.sketchCanvas.height=a.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(e){!this.useCanvas||this._getContext(e).save()},restoreContext:function(e){!this.useCanvas||this._getContext(e).restore()},setClip:function(e,i){if(!!this.useCanvas){var n=this._getContext(i);n.beginPath(),n.rect(e.x,e.y,e.width,e.height),n.clip()}},drawRectangle:function(e,i,n){if(!!this.useCanvas){var s=this._getContext(n);s.save(),s.fillStyle=i,s.fillRect(e.x,e.y,e.width,e.height),s.restore()}},blendSketch:function(e,i,n,s){var o=e;if(t.isPlainObject(o)||(o={opacity:e,scale:i,translate:n,compositeOperation:s}),!(!this.useCanvas||!this.sketchCanvas)){e=o.opacity,s=o.compositeOperation;var a=o.bounds;if(this.context.save(),this.context.globalAlpha=e,s&&(this.context.globalCompositeOperation=s),a)a.x<0&&(a.width+=a.x,a.x=0),a.x+a.width>this.canvas.width&&(a.width=this.canvas.width-a.x),a.y<0&&(a.height+=a.y,a.y=0),a.y+a.height>this.canvas.height&&(a.height=this.canvas.height-a.y),this.context.drawImage(this.sketchCanvas,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height);else{i=o.scale||1,n=o.translate;var r=n instanceof t.Point?n:new t.Point(0,0),d=0,c=0;if(n){var p=this.sketchCanvas.width-this.canvas.width,w=this.sketchCanvas.height-this.canvas.height;d=Math.round(p/2),c=Math.round(w/2)}this.context.drawImage(this.sketchCanvas,r.x-d*i,r.y-c*i,(this.canvas.width+2*d)*i,(this.canvas.height+2*c)*i,-d,-c,this.canvas.width+2*d,this.canvas.height+2*c)}this.context.restore()}},drawDebugInfo:function(e,i,n,s){if(!!this.useCanvas){var o=this.viewer.world.getIndexOfItem(s)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*t.pixelDensityRatio,a.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[o],a.fillStyle=this.debugGridColor[o],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),s.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:s.getRotation(!0),point:s.viewport.pixelFromPointNoRotate(s._getRotationPoint(!0),!0)}),s.viewport.degrees===0&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),a.strokeRect(e.position.x*t.pixelDensityRatio,e.position.y*t.pixelDensityRatio,e.size.x*t.pixelDensityRatio,e.size.y*t.pixelDensityRatio);var r=(e.position.x+e.size.x/2)*t.pixelDensityRatio,d=(e.position.y+e.size.y/2)*t.pixelDensityRatio;a.translate(r,d),a.rotate(Math.PI/180*-this.viewport.degrees),a.translate(-r,-d),e.x===0&&e.y===0&&(a.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*t.pixelDensityRatio,(e.position.y-30)*t.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*t.pixelDensityRatio,(e.position.y-20)*t.pixelDensityRatio)),a.fillText("Level: "+e.level,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+20)*t.pixelDensityRatio),a.fillText("Column: "+e.x,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+30)*t.pixelDensityRatio),a.fillText("Row: "+e.y,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+40)*t.pixelDensityRatio),a.fillText("Order: "+n+" of "+i,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+50)*t.pixelDensityRatio),a.fillText("Size: "+e.size.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+60)*t.pixelDensityRatio),a.fillText("Position: "+e.position.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+70)*t.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),s.getRotation(!0)%360!=0&&this._restoreRotationChanges(),s.viewport.degrees===0&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),a.restore()}},debugRect:function(e){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*t.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio,e.width*t.pixelDensityRatio,e.height*t.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(e){var i=this._getContext(e).canvas;return new t.Point(i.width,i.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var i=e.point?e.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(e.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-e.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*e.degrees),n.translate(-i.x,-i.y)},_flip:function(e){e=e||{};var i=e.point?e.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(e.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(e){var i=this._getContext(e);i.restore()},_calculateCanvasSize:function(){var e=t.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*e),y:Math.round(i.y*e)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return e;var i=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:i,y:i}}}})(OpenSeadragon);(function(t){t.Viewport=function(e){var i=arguments;i.length&&i[0]instanceof t.Point&&(e={containerSize:i[0],contentSize:i[1],config:i[2]}),e.config&&(t.extend(!0,e,e.config),delete e.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(e){return t.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(e instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(e.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(e.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,i){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,i)},_setContentBounds:function(e,i){t.console.assert(e,"[Viewport._setContentBounds] bounds is required"),t.console.assert(e instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(e.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(e.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio(),i;return this.homeFillsViewer?i=e>=1?e:1:i=e>=1?1:e,i/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new t.Rect(e.x-i/2,e.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),i=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return i},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(e){t.console.assert(t.type(e)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var i=this.getCenter(e),n=1/this.getZoom(e),s=n/this.getAspectRatio();return new t.Rect(i.x-n/2,i.y-s/2,n,s)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var i=this.getBoundsNoRotate(e),n=this._containerInnerSize.x*this.getZoom(e);return i.x-=this._margins.left/n,i.y-=this._margins.top/n,i.width+=(this._margins.left+this._margins.right)/n,i.height+=(this._margins.top+this._margins.bottom)/n,i},getCenter:function(e){var i=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),s,o,a,r,d,c,p,w;return e?i:this.zoomPoint?(s=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),a=1/o,r=a/this.getAspectRatio(),d=new t.Rect(i.x-a/2,i.y-r/2,a,r),c=this._pixelFromPoint(this.zoomPoint,d),p=c.minus(s),w=p.divide(this._containerInnerSize.x*o),n.plus(w)):n},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var i=new t.Rect(e.x,e.y,e.width,e.height);if(!this.wrapHorizontal){var n=this.visibilityRatio*i.width,s=i.x+i.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,a=this._contentBoundsNoRotate.x-s+n,r=o-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(a+r)/2:r<0?i.x+=r:a>0&&(i.x+=a)}if(!this.wrapVertical){var d=this.visibilityRatio*i.height,c=i.y+i.height,p=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,w=this._contentBoundsNoRotate.y-c+d,y=p-i.y-d;d>this._contentBoundsNoRotate.height?i.y+=(w+y)/2:y<0?i.y+=y:w>0&&(i.y+=w)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var i=this.getZoom(),n=this._applyZoomConstraints(i);i!==n&&this.zoomTo(n,this.zoomPoint,e);var s=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(s);return this._raiseConstraintsEvent(e),(s.x!==o.x||s.y!==o.y||e)&&this.fitBounds(o.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,i){i=i||{};var n=i.immediately||!1,s=i.constraints||!1,o=this.getAspectRatio(),a=e.getCenter(),r=new t.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();r.getAspectRatio()>=o?r.height=r.width/o:r.width=r.height*o,r.x=a.x-r.width/2,r.y=a.y-r.height/2;var d=1/r.width;if(s){var c=r.getAspectRatio(),p=this._applyZoomConstraints(d);d!==p&&(d=p,r.width=1/d,r.x=a.x-r.width/2,r.height=r.width/c,r.y=a.y-r.height/2),r=this._applyBoundaryConstraints(r),a=r.getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(a,!0),this.zoomTo(d,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var w=this.getBounds(),y=this.getZoom();if(y===0||Math.abs(d/y-1)<1e-8)return this.zoomTo(d,!0),this.panTo(a,n);r=r.rotate(-this.getRotation());var R=r.getTopLeft().times(d).minus(w.getTopLeft().times(y)).divide(d-y);return this.zoomTo(d,R,n)},fitBounds:function(e,i){return this._fitBounds(e,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(e,i){return this._fitBounds(e,{immediately:i,constraints:!0})},fitVertically:function(e){var i=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,e)},fitHorizontally:function(e){var i=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,e)},getConstrainedBounds:function(e){var i,n;return i=this.getBounds(e),n=this._applyBoundaryConstraints(i),n},panBy:function(e,i){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(e),i)},panTo:function(e,i){return i?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:i}),this},zoomBy:function(e,i,n){return this.zoomTo(this.zoomSpring.target.value*e,i,n)},zoomTo:function(e,i,n){var s=this;return this.zoomPoint=i instanceof t.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){s.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:i,immediately:n}),this},setRotation:function(e){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=t.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e}),this)},getRotation:function(){return this.degrees},resize:function(e,i){var n=this.getBoundsNoRotate(),s=n,o;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),i&&(o=e.x/this.containerSize.x,s.width=n.width*o,s.height=s.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:i}),this.fitBounds(s,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,i},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);e();var n=this.pixelFromPoint(this.zoomPoint,!0),s=n.minus(i),o=this.deltaPointsFromPixels(s,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,i){return e.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(e,i){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),i)},deltaPointsFromPixelsNoRotate:function(e,i){return e.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(e,i){return this.deltaPointsFromPixelsNoRotate(e,i).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,i){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(i))},pixelFromPoint:function(e,i){return this._pixelFromPoint(e,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(e,i){return e.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,i){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(e,i){var n=this.getBoundsNoRotate(i);return e.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,i){return this.pointFromPixelNoRotate(e,i).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(e,i){if(e instanceof t.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageCoordinates(e,i,!0)}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(e,i){if(e instanceof t.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportCoordinates(e,i,!0)}}var o=this._imageToViewportDelta(e,i);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(e,i,n,s){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,s)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(a===1){var r=this.viewer.world.getItemAt(0);return r.imageToViewportRectangle(e,i,n,s,!0)}}var d=this.imageToViewportCoordinates(o.x,o.y),c=this._imageToViewportDelta(o.width,o.height);return new t.Rect(d.x,d.y,c.x,c.y,o.degrees)},viewportToImageRectangle:function(e,i,n,s){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,s)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(a===1){var r=this.viewer.world.getItemAt(0);return r.viewportToImageRectangle(e,i,n,s,!0)}}var d=this.viewportToImageCoordinates(o.x,o.y),c=this._viewportToImageDelta(o.width,o.height);return new t.Rect(d.x,d.y,c.x,c.y,o.degrees)},viewerElementToImageCoordinates:function(e){var i=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(i)},imageToViewerElementCoordinates:function(e){var i=this.imageToViewportCoordinates(e);return this.pixelFromPoint(i,!0)},windowToImageCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var i=this.imageToViewerElementCoordinates(e);return i.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return t.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return t.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var i=this.viewportToViewerElementCoordinates(e);return i.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(i===1){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(e)}}var s=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=o/s*a;return e*r},imageToViewportZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(i===1){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(e)}}var s=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=s/o/a;return e*r},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e?this:(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e}),this)}}})(OpenSeadragon);(function(t){t.TiledImage=function(h){var x=this;t.console.assert(h.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(h.drawer,"[TiledImage] options.drawer is required"),t.console.assert(h.viewer,"[TiledImage] options.viewer is required"),t.console.assert(h.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(h.source,"[TiledImage] options.source is required"),t.console.assert(!h.clip||h.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=h.tileCache,delete h.tileCache,this._drawer=h.drawer,delete h.drawer,this._imageLoader=h.imageLoader,delete h.imageLoader,h.clip instanceof t.Rect&&(this._clip=h.clip.clone()),delete h.clip;var T=h.x||0;delete h.x;var S=h.y||0;delete h.y,this.normHeight=h.source.dimensions.y/h.source.dimensions.x,this.contentAspectX=h.source.dimensions.x/h.source.dimensions.y;var P=1;h.width?(P=h.width,delete h.width,h.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete h.height)):h.height&&(P=h.height/this.normHeight,delete h.height);var O=h.fitBounds;delete h.fitBounds;var M=h.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete h.fitBoundsPlacement;var L=h.degrees||0;delete h.degrees,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},h),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:T,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:S,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:P,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:L,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),O&&this.fitBounds(O,M,!0),this._drawingHandler=function(U){x.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:x},U))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(h){h!==this._fullyLoaded&&(this._fullyLoaded=h,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var h=this._xSpring.update(),x=this._ySpring.update(),T=this._scaleSpring.update(),S=this._degreesSpring.update();return h||x||T||S?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(h){return this.getBoundsNoRotate(h).rotate(this.getRotation(h),this._getRotationPoint(h))},getBoundsNoRotate:function(h){return h?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(h){var x=this.getBoundsNoRotate(h);if(this._clip){var T=h?this._worldWidthCurrent:this._worldWidthTarget,S=T/this.source.dimensions.x,P=this._clip.times(S);x=new t.Rect(x.x+P.x,x.y+P.y,P.width,P.height)}return x.rotate(this.getRotation(h),this._getRotationPoint(h))},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(h,x,T){var S=T?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(h*(this.source.dimensions.x/S),x*(this.source.dimensions.y*this.contentAspectX/S))},viewportToImageCoordinates:function(h,x,T){var S;return h instanceof t.Point?(T=x,S=h):S=new t.Point(h,x),S=S.rotate(-this.getRotation(T),this._getRotationPoint(T)),T?this._viewportToImageDelta(S.x-this._xSpring.current.value,S.y-this._ySpring.current.value):this._viewportToImageDelta(S.x-this._xSpring.target.value,S.y-this._ySpring.target.value)},_imageToViewportDelta:function(h,x,T){var S=T?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(h/this.source.dimensions.x*S,x/this.source.dimensions.y/this.contentAspectX*S)},imageToViewportCoordinates:function(h,x,T){h instanceof t.Point&&(T=x,x=h.y,h=h.x);var S=this._imageToViewportDelta(h,x);return T?(S.x+=this._xSpring.current.value,S.y+=this._ySpring.current.value):(S.x+=this._xSpring.target.value,S.y+=this._ySpring.target.value),S.rotate(this.getRotation(T),this._getRotationPoint(T))},imageToViewportRectangle:function(h,x,T,S,P){var O=h;O instanceof t.Rect?P=x:O=new t.Rect(h,x,T,S);var M=this.imageToViewportCoordinates(O.getTopLeft(),P),L=this._imageToViewportDelta(O.width,O.height,P);return new t.Rect(M.x,M.y,L.x,L.y,O.degrees+this.getRotation(P))},viewportToImageRectangle:function(h,x,T,S,P){var O=h;h instanceof t.Rect?P=x:O=new t.Rect(h,x,T,S);var M=this.viewportToImageCoordinates(O.getTopLeft(),P),L=this._viewportToImageDelta(O.width,O.height,P);return new t.Rect(M.x,M.y,L.x,L.y,O.degrees-this.getRotation(P))},viewerElementToImageCoordinates:function(h){var x=this.viewport.pointFromPixel(h,!0);return this.viewportToImageCoordinates(x)},imageToViewerElementCoordinates:function(h){var x=this.imageToViewportCoordinates(h);return this.viewport.pixelFromPoint(x,!0)},windowToImageCoordinates:function(h){var x=h.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(x)},imageToWindowCoordinates:function(h){var x=this.imageToViewerElementCoordinates(h);return x.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(h){var x=this._scaleSpring.current.value;return h=h.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((h.x-this._xSpring.current.value)/x,(h.y-this._ySpring.current.value)/x,h.width/x,h.height/x,h.degrees)},viewportToImageZoom:function(h){var x=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return x*h},imageToViewportZoom:function(h){var x=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return h/x},setPosition:function(h,x){var T=this._xSpring.target.value===h.x&&this._ySpring.target.value===h.y;if(x){if(T&&this._xSpring.current.value===h.x&&this._ySpring.current.value===h.y)return;this._xSpring.resetTo(h.x),this._ySpring.resetTo(h.y),this._needsDraw=!0}else{if(T)return;this._xSpring.springTo(h.x),this._ySpring.springTo(h.y),this._needsDraw=!0}T||this._raiseBoundsChange()},setWidth:function(h,x){this._setScale(h,x)},setHeight:function(h,x){this._setScale(h/this.normHeight,x)},setCroppingPolygons:function(h){var x=function(S){return S instanceof t.Point||typeof S.x=="number"&&typeof S.y=="number"},T=function(S){return S.map(function(P){try{if(x(P))return{x:P.x,y:P.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(h))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=h.map(function(S){return T(S)})}catch(S){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(S),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(h,x,T){x=x||t.Placement.CENTER;var S=t.Placement.properties[x],P=this.contentAspectX,O=0,M=0,L=1,U=1;if(this._clip&&(P=this._clip.getAspectRatio(),L=this._clip.width/this.source.dimensions.x,U=this._clip.height/this.source.dimensions.y,h.getAspectRatio()>P?(O=this._clip.x/this._clip.height*h.height,M=this._clip.y/this._clip.height*h.height):(O=this._clip.x/this._clip.width*h.width,M=this._clip.y/this._clip.width*h.width)),h.getAspectRatio()>P){var Q=h.height/U,V=0;S.isHorizontallyCentered?V=(h.width-h.height*P)/2:S.isRight&&(V=h.width-h.height*P),this.setPosition(new t.Point(h.x-O+V,h.y-M),T),this.setHeight(Q,T)}else{var Y=h.width/L,X=0;S.isVerticallyCentered?X=(h.height-h.width/P)/2:S.isBottom&&(X=h.height-h.width/P),this.setPosition(new t.Point(h.x-O,h.y-M+X),T),this.setWidth(Y,T)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(h){t.console.assert(!h||h instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),h instanceof t.Rect?this._clip=h.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(h){h!==this.opacity&&(this.opacity=h,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(h){this._preload=!!h,this._needsDraw=!0},getRotation:function(h){return h?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(h,x){this._degreesSpring.target.value===h&&this._degreesSpring.isAtTargetValue()||(x?this._degreesSpring.resetTo(h):this._degreesSpring.springTo(h),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(h){return this.getBoundsNoRotate(h).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(h){h!==this.compositeOperation&&(this.compositeOperation=h,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(h,x){var T=this._scaleSpring.target.value===h;if(x){if(T&&this._scaleSpring.current.value===h)return;this._scaleSpring.resetTo(h),this._updateForScale(),this._needsDraw=!0}else{if(T)return;this._scaleSpring.springTo(h),this._updateForScale(),this._needsDraw=!0}T||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var h=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),x=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,T=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(x/this.minPixelRatio)/Math.log(2))));return T=Math.max(T,this.source.minLevel||0),h=Math.min(h,T),{lowestLevel:h,highestLevel:T}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var h=this.lastDrawn.pop();h.beingDrawn=!1}var x=this.viewport,T=this._viewportToTiledImageRectangle(x.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var S=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(T=T.intersection(S),T===null)return}for(var P=this._getLevelsInterval(),O=P.lowestLevel,M=P.highestLevel,L=null,U=!1,Q=t.now(),V=M;V>=O;V--){var Y=!1,X=x.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(V),!0).x*this._scaleSpring.current.value;if(V===O||!U&&X>=this.minPixelRatio)Y=!0,U=!0;else if(!U)continue;var oe=x.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(V),!1).x*this._scaleSpring.current.value,re=x.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,le=this.immediateRender?1:re,se=Math.min(1,(X-.5)/.5),G=le/Math.abs(le-oe);if(L=e(this,U,Y,V,se,G,T,Q,L),c(this.coverage,V))break}b(this,this.lastDrawn),L&&!L.context2D?(s(this,L,Q),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(h,x,T){var S,P;this.wrapHorizontal?(S=t.positiveModulo(x.x,1),P=t.positiveModulo(T.x,1)):(S=Math.max(0,x.x),P=Math.min(1,T.x));var O,M,L=1/this.source.aspectRatio;this.wrapVertical?(O=t.positiveModulo(x.y,L),M=t.positiveModulo(T.y,L)):(O=Math.max(0,x.y),M=Math.min(L,T.y));var U=this.source.getTileAtPoint(h,new t.Point(S,O)),Q=this.source.getTileAtPoint(h,new t.Point(P,M)),V=this.source.getNumTiles(h);return this.wrapHorizontal&&(U.x+=V.x*Math.floor(x.x),Q.x+=V.x*Math.floor(T.x)),this.wrapVertical&&(U.y+=V.y*Math.floor(x.y/L),Q.y+=V.y*Math.floor(T.y/L)),{topLeft:U,bottomRight:Q}}});function e(h,x,T,S,P,O,M,L,U){var Q=M.getBoundingBox().getTopLeft(),V=M.getBoundingBox().getBottomRight();h.viewer&&h.viewer.raiseEvent("update-level",{tiledImage:h,havedrawn:x,level:S,opacity:P,visibility:O,drawArea:M,topleft:Q,bottomright:V,currenttime:L,best:U}),y(h.coverage,S),y(h.loadingCoverage,S);for(var Y=h._getCornerTiles(S,Q,V),X=Y.topLeft,oe=Y.bottomRight,re=h.source.getNumTiles(S),le=h.viewport.pixelFromPoint(h.viewport.getCenter()),se=X.x;se<=oe.x;se++)for(var G=X.y;G<=oe.y;G++){if(!h.wrapHorizontal&&!h.wrapVertical){var pe=h.source.getTileBounds(S,se,G);if(M.intersection(pe)===null)continue}U=i(h,T,x,se,G,S,P,O,le,re,L,U)}return U}function i(h,x,T,S,P,O,M,L,U,Q,V,Y){var X=n(S,P,O,h,h.source,h.tilesMatrix,V,Q,h._worldWidthCurrent,h._worldHeightCurrent),oe=T;h.viewer&&h.viewer.raiseEvent("update-tile",{tiledImage:h,tile:X}),w(h.coverage,O,S,P,!1);var re=X.loaded||X.loading||p(h.loadingCoverage,O,S,P);if(w(h.loadingCoverage,O,S,P,re),!X.exists||(x&&!oe&&(p(h.coverage,O,S,P)?w(h.coverage,O,S,P,!0):oe=!0),!oe))return Y;if(r(X,h.source.tileOverlap,h.viewport,U,L,h),!X.loaded)if(X.context2D)a(h,X);else{var le=h._tileCache.getImageRecord(X.cacheKey);if(le){var se=le.getImage();a(h,X,se)}}if(X.loaded){var G=d(h,X,S,P,O,M,V);G&&(h._needsDraw=!0)}else X.loading?h._tilesLoading++:re||(Y=R(Y,X));return Y}function n(h,x,T,S,P,O,M,L,U,Q){var V,Y,X,oe,re,le,se,G,pe;return O[T]||(O[T]={}),O[T][h]||(O[T][h]={}),O[T][h][x]||(V=(L.x+h%L.x)%L.x,Y=(L.y+x%L.y)%L.y,X=P.getTileBounds(T,V,Y),oe=P.getTileBounds(T,V,Y,!0),re=P.tileExists(T,V,Y),le=P.getTileUrl(T,V,Y),S.loadTilesWithAjax?(se=P.getTileAjaxHeaders(T,V,Y),t.isPlainObject(S.ajaxHeaders)&&(se=t.extend({},S.ajaxHeaders,se))):se=null,G=P.getContext2D?P.getContext2D(T,V,Y):void 0,X.x+=(h-V)/L.x,X.y+=Q/U*((x-Y)/L.y),pe=new t.Tile(T,h,x,X,re,le,G,S.loadTilesWithAjax,se,oe),V===L.x-1&&(pe.isRightMost=!0),Y===L.y-1&&(pe.isBottomMost=!0),O[T][h][x]=pe),pe=O[T][h][x],pe.lastTouchTime=M,pe}function s(h,x,T){x.loading=!0,h._imageLoader.addJob({src:x.url,loadWithAjax:x.loadWithAjax,ajaxHeaders:x.ajaxHeaders,crossOriginPolicy:h.crossOriginPolicy,ajaxWithCredentials:h.ajaxWithCredentials,callback:function(S,P,O){o(h,x,T,S,P,O)},abort:function(){x.loading=!1}})}function o(h,x,T,S,P,O){if(!S){t.console.log("Tile %s failed to load: %s - error: %s",x,x.url,P),h.viewer.raiseEvent("tile-load-failed",{tile:x,tiledImage:h,time:T,message:P,tileRequest:O}),x.loading=!1,x.exists=!1;return}if(T<h.lastResetTime){t.console.log("Ignoring tile %s loaded before reset: %s",x,x.url),x.loading=!1;return}var M=function(){var L=h.source.getClosestLevel();a(h,x,S,L,O)};h._midDraw?window.setTimeout(M,1):M()}function a(h,x,T,S,P){var O=0;function M(){return O++,L}function L(){O--,O===0&&(x.loading=!1,x.loaded=!0,x.context2D||h._tileCache.cacheTile({image:T,tile:x,cutoff:S,tiledImage:h}),h._needsDraw=!0)}h.viewer.raiseEvent("tile-loaded",{tile:x,tiledImage:h,tileRequest:P,image:T,getCompletionCallback:M}),M()()}function r(h,x,T,S,P,O){var M=h.bounds.getTopLeft();M.x*=O._scaleSpring.current.value,M.y*=O._scaleSpring.current.value,M.x+=O._xSpring.current.value,M.y+=O._ySpring.current.value;var L=h.bounds.getSize();L.x*=O._scaleSpring.current.value,L.y*=O._scaleSpring.current.value;var U=T.pixelFromPointNoRotate(M,!0),Q=T.pixelFromPointNoRotate(M,!1),V=T.deltaPixelsFromPointsNoRotate(L,!0),Y=T.deltaPixelsFromPointsNoRotate(L,!1),X=Q.plus(Y.divide(2)),oe=S.squaredDistanceTo(X);x||(V=V.plus(new t.Point(1,1))),h.isRightMost&&O.wrapHorizontal&&(V.x+=.75),h.isBottomMost&&O.wrapVertical&&(V.y+=.75),h.position=U,h.size=V,h.squaredDistance=oe,h.visibility=P}function d(h,x,T,S,P,O,M){var L=1e3*h.blendTime,U,Q;if(x.blendStart||(x.blendStart=M),U=M-x.blendStart,Q=L?Math.min(1,U/L):1,h.alwaysBlend&&(Q*=O),x.opacity=Q,h.lastDrawn.push(x),Q===1)w(h.coverage,P,T,S,!0),h._hasOpaqueTile=!0;else if(U<L)return!0;return!1}function c(h,x,T,S){var P,O,M,L;if(!h[x])return!1;if(T===void 0||S===void 0){P=h[x];for(M in P)if(Object.prototype.hasOwnProperty.call(P,M)){O=P[M];for(L in O)if(Object.prototype.hasOwnProperty.call(O,L)&&!O[L])return!1}return!0}return h[x][T]===void 0||h[x][T][S]===void 0||h[x][T][S]===!0}function p(h,x,T,S){return T===void 0||S===void 0?c(h,x+1):c(h,x+1,2*T,2*S)&&c(h,x+1,2*T,2*S+1)&&c(h,x+1,2*T+1,2*S)&&c(h,x+1,2*T+1,2*S+1)}function w(h,x,T,S,P){if(!h[x]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",x);return}h[x][T]||(h[x][T]={}),h[x][T][S]=P}function y(h,x){h[x]={}}function R(h,x){return!h||x.visibility>h.visibility||x.visibility==h.visibility&&x.squaredDistance<h.squaredDistance?x:h}function b(h,x){if(!(h.opacity===0||x.length===0&&!h.placeholderFillStyle)){var T=x[0],S;T&&(S=h.opacity<1||h.compositeOperation&&h.compositeOperation!=="source-over"||!h._isBottomItem()&&T._hasTransparencyChannel());var P,O,M=h.viewport.getZoom(!0),L=h.viewportToImageZoom(M);x.length>1&&L>h.smoothTileEdgesMinZoom&&!h.iOSDevice&&h.getRotation(!0)%360==0&&t.supportsCanvas&&(S=!0,P=T.getScaleForEdgeSmoothing(),O=T.getTranslationForEdgeSmoothing(P,h._drawer.getCanvasSize(!1),h._drawer.getCanvasSize(!0)));var U;S&&(P||(U=h.viewport.viewportToViewerElementRectangle(h.getClippedBounds(!0)).getIntegerBoundingBox(),h._drawer.viewer.viewport.getFlip()&&(h.viewport.degrees!==0||h.getRotation(!0)%360!=0)&&(U.x=h._drawer.viewer.container.clientWidth-(U.x+U.width)),U=U.times(t.pixelDensityRatio)),h._drawer._clear(!0,U)),P||(h.viewport.degrees!==0&&h._drawer._offsetForRotation({degrees:h.viewport.degrees,useSketch:S}),h.getRotation(!0)%360!=0&&h._drawer._offsetForRotation({degrees:h.getRotation(!0),point:h.viewport.pixelFromPointNoRotate(h._getRotationPoint(!0),!0),useSketch:S}),h.viewport.degrees===0&&h.getRotation(!0)%360==0&&h._drawer.viewer.viewport.getFlip()&&h._drawer._flip());var Q=!1;if(h._clip){h._drawer.saveContext(S);var V=h.imageToViewportRectangle(h._clip,!0);V=V.rotate(-h.getRotation(!0),h._getRotationPoint(!0));var Y=h._drawer.viewportToDrawerRectangle(V);P&&(Y=Y.times(P)),O&&(Y=Y.translate(O)),h._drawer.setClip(Y,S),Q=!0}if(h._croppingPolygons){h._drawer.saveContext(S);try{var X=h._croppingPolygons.map(function(se){return se.map(function(G){var pe=h.imageToViewportCoordinates(G.x,G.y,!0).rotate(-h.getRotation(!0),h._getRotationPoint(!0)),Oe=h._drawer.viewportCoordToDrawerCoord(pe);return P&&(Oe=Oe.times(P)),Oe})});h._drawer.clipWithPolygons(X,S)}catch(se){t.console.error(se)}Q=!0}if(h.placeholderFillStyle&&h._hasOpaqueTile===!1){var oe=h._drawer.viewportToDrawerRectangle(h.getBounds(!0));P&&(oe=oe.times(P)),O&&(oe=oe.translate(O));var re=null;typeof h.placeholderFillStyle=="function"?re=h.placeholderFillStyle(h,h._drawer.context):re=h.placeholderFillStyle,h._drawer.drawRectangle(oe,re,S)}for(var le=x.length-1;le>=0;le--)T=x[le],h._drawer.drawTile(T,h._drawingHandler,S,P,O),T.beingDrawn=!0,h.viewer&&h.viewer.raiseEvent("tile-drawn",{tiledImage:h,tile:T});Q&&h._drawer.restoreContext(S),P||(h.getRotation(!0)%360!=0&&h._drawer._restoreRotationChanges(S),h.viewport.degrees!==0&&h._drawer._restoreRotationChanges(S)),S&&(P&&(h.viewport.degrees!==0&&h._drawer._offsetForRotation({degrees:h.viewport.degrees,useSketch:!1}),h.getRotation(!0)%360!=0&&h._drawer._offsetForRotation({degrees:h.getRotation(!0),point:h.viewport.pixelFromPointNoRotate(h._getRotationPoint(!0),!0),useSketch:!1})),h._drawer.blendSketch({opacity:h.opacity,scale:P,translate:O,compositeOperation:h.compositeOperation,bounds:U}),P&&(h.getRotation(!0)%360!=0&&h._drawer._restoreRotationChanges(!1),h.viewport.degrees!==0&&h._drawer._restoreRotationChanges(!1))),P||h.viewport.degrees===0&&h.getRotation(!0)%360==0&&h._drawer.viewer.viewport.getFlip()&&h._drawer._flip(),N(h,x)}}function N(h,x){if(h.debugMode)for(var T=x.length-1;T>=0;T--){var S=x[T];try{h._drawer.drawDebugInfo(S,x.length,T,h)}catch(P){t.console.error(P)}}}})(OpenSeadragon);(function(t){var e=function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage},i=function(n){t.console.assert(n,"[ImageRecord] options is required"),t.console.assert(n.image,"[ImageRecord] options.image is required"),this._image=n.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var n=document.createElement("canvas");n.width=this._image.width,n.height=this._image.height,this._renderedContext=n.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(n){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=n},addTile:function(n){t.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var s=0;s<this._tiles.length;s++)if(this._tiles[s]===n){this._tiles.splice(s,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(n){n=n||{},this._maxImageCacheCount=n.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var s=n.cutoff||0,o=this._tilesLoaded.length,a=this._imagesLoaded[n.tile.cacheKey];if(a||(t.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),a=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),a.addTile(n.tile),n.tile.cacheImageRecord=a,this._imagesLoadedCount>this._maxImageCacheCount){for(var r=null,d=-1,c=null,p,w,y,R,b,N,h=this._tilesLoaded.length-1;h>=0;h--)if(N=this._tilesLoaded[h],p=N.tile,!(p.level<=s||p.beingDrawn)){if(!r){r=p,d=h,c=N;continue}R=p.lastTouchTime,w=r.lastTouchTime,b=p.level,y=r.level,(R<w||R==w&&b>y)&&(r=p,d=h,c=N)}r&&d>=0&&(this._unloadTile(c),o=d)}this._tilesLoaded[o]=new e({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){t.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var s,o=0;o<this._tilesLoaded.length;++o)s=this._tilesLoaded[o],s.tiledImage===n&&(this._unloadTile(s),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(n){return t.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){t.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var s=n.tile,o=n.tiledImage;s.unload(),s.cacheImageRecord=null;var a=this._imagesLoaded[s.cacheKey];a.removeTile(s),a.getTileCount()||(a.destroy(),delete this._imagesLoaded[s.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:s,tiledImage:o})}}})(OpenSeadragon);(function(t){t.World=function(e){var i=this;t.console.assert(e.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(e,i){if(t.console.assert(e,"[World.addItem] item is required"),t.console.assert(e instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),i=i||{},i.index!==void 0){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,e)}else this._items.push(e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return t.console.assert(e!==void 0,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return t.console.assert(e,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,i){t.console.assert(e,"[World.setItemIndex] item is required"),t.console.assert(i!==void 0,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(e);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i===n||n===-1||(this._items.splice(n,1),this._items.splice(i,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:n,newIndex:i}))},removeItem:function(e){t.console.assert(e,"[World.removeItem] item is required");var i=t.indexOf(this._items,e);i!==-1&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){this.viewer._cancelPendingImages();var e,i;for(i=0;i<this._items.length;i++)e=this._items[i],e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<n.length;i++)e=n[i],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,i=0;i<this._items.length;i++)e=this._items[i].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){e=e||{};var i=e.immediately||!1,n=e.layout||t.DEFAULT_SETTINGS.collectionLayout,s=e.rows||t.DEFAULT_SETTINGS.collectionRows,o=e.columns||t.DEFAULT_SETTINGS.collectionColumns,a=e.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,r=e.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,d=a+r,c;!e.rows&&o?c=o:c=Math.ceil(this._items.length/s);var p=0,w=0,y,R,b,N,h;this.setAutoRefigureSizes(!1);for(var x=0;x<this._items.length;x++)x&&x%c==0&&(n==="horizontal"?(w+=d,p=0):(p+=d,w=0)),y=this._items[x],R=y.getBounds(),R.width>R.height?b=a:b=a*(R.width/R.height),N=b*(R.height/R.width),h=new t.Point(p+(a-b)/2,w+(a-N)/2),y.setPosition(h,i),y.setWidth(b,i),n==="horizontal"?p+=d:w+=d;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var s=this._items[0],o=s.getBounds();this._contentFactor=s.getContentSize().x/o.width;for(var a=s.getClippedBounds().getBoundingBox(),r=a.x,d=a.y,c=a.x+a.width,p=a.y+a.height,w=1;w<this._items.length;w++)s=this._items[w],o=s.getBounds(),this._contentFactor=Math.max(this._contentFactor,s.getContentSize().x/o.width),a=s.getClippedBounds().getBoundingBox(),r=Math.min(r,a.x),d=Math.min(d,a.y),c=Math.max(c,a.x+a.width),p=Math.max(p,a.y+a.height);this._homeBounds=new t.Rect(r,d,c-r,p-d),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==n||!this._homeBounds.equals(e)||!this._contentSize.equals(i))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})})(OpenSeadragon)});var ei=Ht((lt,Ct)=>{(function(t,e){typeof lt=="object"&&typeof Ct=="object"?Ct.exports=e(at()):typeof define=="function"&&define.amd?define(["openseadragon"],e):typeof lt=="object"?lt["openseadragon-viewerinputhook"]=e(at()):t["openseadragon-viewerinputhook"]=e(t.openseadragon)})(window,function(t){return function(e){function i(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}var n={};return i.m=e,i.c=n,i.d=function(s,o,a){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:a})},i.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(1&o&&(s=i(s)),8&o||4&o&&typeof s=="object"&&s&&s.__esModule)return s;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:s}),2&o&&typeof s!="string")for(var r in s)i.d(a,r,function(d){return s[d]}.bind(null,r));return a},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=1)}([function(e){e.exports=t},function(e,i,n){"use strict";n.r(i);var s=n(0),o=n.n(s);i.default=function(a,r){if(!a.version||1>a.version.major)throw new Error("OpenSeadragonViewerInputHook requires OpenSeadragon version 1.0.0+");return a.Viewer.prototype.addViewerInputHook=function(d){return(d=d||{}).viewer=this,new r.ViewerInputHook(d)},r.ViewerInputHook=function(d){var c,p;for((d=d||{}).hooks=d.hooks||[],this.viewer=d.viewer||null,this.viewerTrackers={},this.hooks=[],this.viewer&&(this.viewerTrackers.viewer=this.viewer.innerTracker,this.viewerTrackers.viewer_outer=this.viewer.outerTracker),c=0;c<d.hooks.length;c++){if(typeof d.hooks[c].tracker=="string"){if(!this.viewer)throw new Error("A viewer must be specified.");if((p=this.viewerTrackers[d.hooks[c].tracker])===void 0)throw new Error("Unknown tracker specified: "+d.hooks[c].tracker)}else p=d.hooks[c].tracker;this.hooks.push({tracker:p,handlerName:d.hooks[c].handler,origHandler:p[d.hooks[c].handler],hookHandler:d.hooks[c].hookHandler}),function(w,y,R,b){var N=y[R];y[R]=function(h){return w._callHandlers(b,N,h)}}(this,p,d.hooks[c].handler,d.hooks[c].hookHandler)}},r.ViewerInputHook.version={versionStr:"2.2.1",major:2,minor:2,revision:1},r.ViewerInputHook.prototype._callHandlers=function(d,c,p){var w=d(p);return c&&!p.stopHandlers&&(w=c(p)),!p.stopBubbling&&w},r.ViewerInputHook.prototype.destroy=function(){for(;0<this.hooks.length;){var d=this.hooks.pop();d.tracker[d.handlerName]=d.origHandler}this.viewer&&(delete this.viewerTrackers.viewer,delete this.viewerTrackers.viewer_outer,this.viewer=null)},r.ViewerInputHook}(o.a||window.OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{})}]).default})});var Ie=class{constructor(e,i,n,s){this.x=e,this.y=i,this.w=n,this.h=s}toString(){return`${this.x},${this.y},${this.w},${this.h}`}static fromString(e){e=e.replace("xywh=","");let i=e.split(",");return new Ie(Number(i[0]),Number(i[1]),Number(i[2]),Number(i[3]))}};var et=class{constructor(e,i){this.x=e,this.y=i}};var vt=class{constructor(){this.region=new pt(0,0);this.regionPos=new et(0,0);this.size=new pt(0,0)}};var j=Se(Vt()),tt=Se(di());var ze=Se(st());var gi=({canvases:t,confinedImageSize:e,content:i,downloadCurrentViewEnabled:n,downloadWholeImageHighResEnabled:s,downloadWholeImageLowResEnabled:o,getConfinedImageDimensions:a,getConfinedImageUri:r,getCroppedImageDimensions:d,locale:c,manifest:p,maxImageWidth:w,mediaDownloadEnabled:y,onClose:R,onDownloadCurrentView:b,onDownloadSelection:N,onShowTermsOfUse:h,open:x,paged:T,parent:S,resources:P,requiredStatement:O,rotation:M,selectionEnabled:L,sequence:U,termsOfUseEnabled:Q,triggerButton:V})=>{let Y=(0,j.useRef)(null),[X,oe]=(0,j.useState)({top:"0px",left:"0px"}),[re,le]=(0,j.useState)("0px 0px"),[se,G]=(0,j.useState)("left"),pe=M%180==0;if((0,j.useEffect)(()=>{if(x){let D=S.clientHeight-Y.current.clientHeight-V.clientHeight,_=V.getBoundingClientRect().left-S.getBoundingClientRect().left,z=Ye.normalise(_,0,S.clientWidth);_=S.clientWidth*z-Y.current.clientWidth*z;let q=Y.current.clientWidth*z;oe({top:`${D}px`,left:`${_}px`}),le(`${q}px 0px`)}},[x]),!x)return null;function Oe(D){if(D.externalResource.data){let _=D.externalResource.data.width,z=D.externalResource.data.height;if(_&&z)return new ze.Size(_,z)}return null}function ke(D){let _=Oe(D),z=D.getMaxDimensions();if(!_)return null;if(!z||_.width<=z.width&&_.height<=z.height)return _;let q=z.width/_.width,K=z.height/_.height,Z=Math.min(q,K);return new ze.Size(Math.floor(_.width*Z),Math.floor(_.height*Z))}function Fe(D){return!D||!D.length?!1:ze.Utils.isLevel0ImageProfile(D[0])}function Te(){return t[se==="left"?0:1]}function Ae(){return P&&P.length?P.length>1?P[se==="left"?0:1]:P[0]:null}function be(D){let _=Ae();if(!_)return!1;let z=Te();if(!z.externalResource.hasServiceDescriptor()||Fe(z.externalResource.data.profile))return D===ve.WHOLE_IMAGE_HIGH_RES&&!(T||T&&_);switch(D){case ve.CURRENT_VIEW:return n?!T:!1;case ve.CANVAS_RENDERINGS:case ve.IMAGE_RENDERINGS:case ve.WHOLE_IMAGE_HIGH_RES:if(!s)return!1;let q=z.getMaxDimensions();return q?q.width<=w:!0;case ve.WHOLE_IMAGE_LOW_RES:if(!o)return!1;let K=ke(z);return K?Math.max(K.width,K.height)>e:!1;case ve.SELECTION:return L;case ve.RANGE_RENDERINGS:return z.ranges&&z.ranges.length?z.ranges[0].getRenderings().length>0:!1;case ve.ENTIRE_FILE_AS_ORIGINAL:return y;default:return!0}}function Ue(D){let _=D.getImages();return _[0]?_[0].getResource():null}function je(D){let _=Ue(D);if(_){let z=_.getFormat();if(z)return z.toString()}return null}function Ve(D){let _=ke(D);if(_){let z=_.width,q=D.getCanonicalImageUri(z);if(D.externalResource&&D.externalResource.hasServiceDescriptor()){let K=q.split("/");K[K.length-2]=String(M),q=K.join("/")}return q}else if(D.externalResource&&!D.externalResource.hasServiceDescriptor())return D.externalResource.dataUri;return""}function Ze(){let D="",_=Te(),z=je(_);z?z=gt.simplifyMimeType(z):z="?";let q=ke(_);return q?D=pe?ge.format(i.wholeImageHighRes,q.width.toString(),q.height.toString(),z):ge.format(i.wholeImageHighRes,q.height.toString(),q.width.toString(),z):_.externalResource&&!_.externalResource.hasServiceDescriptor()&&(D=ge.format(i.wholeImageHighRes,"?","?",z)),D}function qe(){let D=Te(),_=a(D),z="";return _&&(z=pe?ge.format(i.wholeImageLowResAsJpg,_.width.toString(),_.height.toString()):ge.format(i.wholeImageLowResAsJpg,_.height.toString(),_.width.toString())),z}function Ge(){let D=i.currentViewAsJpg,_=d(Te());return _&&(D=pe?ge.format(D,_.size.width.toString(),_.size.height.toString()):ge.format(D,_.size.height.toString(),_.size.width.toString())),D}function Be({resource:D,defaultLabel:_}){let z=D.getRenderings();return j.default.createElement(j.default.Fragment,null,z.map((q,K)=>{let Z=ze.LanguageMap.getValue(q.getLabel(),c);Z?Z+=" ({0})":Z=_;let ce=gt.simplifyMimeType(q.getFormat().toString());return Z=ge.format(Z,ce),j.default.createElement("li",{key:K},j.default.createElement("button",{onClick:()=>{window.open(q.id,"_blank")}},Z))}))}function Xe(){let D=Te();return j.default.createElement(j.default.Fragment,null,D.ranges?.map(_=>{i.entireFileAsOriginal}))}function l(){let _=Te().getImages();return j.default.createElement(j.default.Fragment,null,_.map(z=>{z.getResource(),i.entireFileAsOriginal}))}function f(){let D=Te();return j.default.createElement(Be,{resource:D,defaultLabel:i.entireFileAsOriginal})}function C(){return U.getRenderings().length>0||p.getRenderings.length>0}function A(){return j.default.createElement(j.default.Fragment,null,j.default.createElement(Be,{resource:U,defaultLabel:i.entireFileAsOriginal}),j.default.createElement(Be,{resource:p,defaultLabel:i.entireFileAsOriginal}))}function H(){return Q&&O?j.default.createElement("button",{onClick:()=>{h()}},i.termsOfUse):null}return j.default.createElement("div",{ref:Y,className:(0,tt.default)("overlay download"),style:X},j.default.createElement("div",{className:"top"}),j.default.createElement("div",{className:"middle"},j.default.createElement("div",{className:"content"},j.default.createElement("div",{role:"heading",className:"heading"},i.download),j.default.createElement("h2",null,i.individualPages),t.length===2&&j.default.createElement("div",{className:"pages"},j.default.createElement("div",{onClick:()=>{G("left")},className:(0,tt.default)("page left",{selected:se==="left"})},j.default.createElement("span",{className:"label"},t[0].getLabel().getValue())),j.default.createElement("div",{onClick:()=>{G("right")},className:(0,tt.default)("page right",{selected:se==="right"})},j.default.createElement("span",{className:"label"},t[1].getLabel().getValue()))),j.default.createElement("ol",{className:"options"},be(ve.CURRENT_VIEW)&&j.default.createElement("li",{className:"option single"},j.default.createElement("button",{onClick:()=>{b(Te())}},Ge())),be(ve.WHOLE_IMAGE_HIGH_RES)&&j.default.createElement("li",{className:"option single"},j.default.createElement("button",{onClick:()=>{window.open(Ve(Te()))}},Ze())),be(ve.WHOLE_IMAGE_LOW_RES)&&j.default.createElement("li",{className:"option single"},j.default.createElement("button",{onClick:()=>{let D=r(Te());D&&window.open(D)}},qe())),be(ve.RANGE_RENDERINGS)&&j.default.createElement(Xe,null),be(ve.IMAGE_RENDERINGS)&&j.default.createElement(l,null),be(ve.CANVAS_RENDERINGS)&&j.default.createElement(f,null)),(C()||be(ve.SELECTION))&&j.default.createElement("h2",null,i.allPages),j.default.createElement("ol",{className:"options"},be(ve.MANIFEST_RENDERINGS)&&j.default.createElement(A,null),be(ve.SELECTION)&&j.default.createElement("li",{className:"option single"},j.default.createElement("button",{onClick:()=>{N()}},i.selection))),j.default.createElement("div",{className:"footer"},j.default.createElement(H,null))),j.default.createElement("div",{className:"buttons"},j.default.createElement("button",{type:"button",className:"btn btn-default close",tabIndex:0,onClick:()=>{R()}},i.close))),j.default.createElement("div",{className:(0,tt.default)("bottom"),style:{backgroundPosition:re}}))},Yt=gi;var ue=class{},I=ue;I.namespace="openseadragonExtension.",I.CURRENT_VIEW_URI=ue.namespace+"currentViewUri",I.DOUBLECLICK=ue.namespace+"doubleClick",I.IMAGE_SEARCH=ue.namespace+"imageSearch",I.MODE_CHANGE=ue.namespace+"modeChange",I.NEXT_SEARCH_RESULT=ue.namespace+"nextSearchResult",I.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=ue.namespace+"nextImagesSearchResultUnavailable",I.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=ue.namespace+"prevImagesSearchResultUnavailable",I.PAGE_SEARCH=ue.namespace+"pageSearch",I.PAGING_TOGGLED=ue.namespace+"pagingToggled",I.PREV_SEARCH_RESULT=ue.namespace+"prevSearchResult",I.PRINT=ue.namespace+"print",I.ROTATE=ue.namespace+"rotate",I.OPENSEADRAGON_ANIMATION_FINISH=ue.namespace+"animationFinish",I.OPENSEADRAGON_ANIMATION_START=ue.namespace+"animationStart",I.OPENSEADRAGON_ANIMATION=ue.namespace+"animation",I.OPENSEADRAGON_OPEN=ue.namespace+"open",I.OPENSEADRAGON_RESIZE=ue.namespace+"resize",I.OPENSEADRAGON_ROTATION=ue.namespace+"rotationChange",I.SEARCH_PREVIEW_FINISH=ue.namespace+"searchPreviewFinish",I.SEARCH_PREVIEW_START=ue.namespace+"searchPreviewStart",I.SEARCH=ue.namespace+"search",I.XYWH_CHANGE=ue.namespace+"xywhChange",I.ZOOM_IN=ue.namespace+"zoomIn",I.ZOOM_OUT=ue.namespace+"zoomOut";var pi=Ne(),wt=class extends ot{constructor(e){super(e)}create(){this.setConfig("externalContentDialogue"),super.create(),this.openCommand=E.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=E.HIDE_EXTERNALCONTENT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.open(),this.$iframe.prop("src",e.uri)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$iframe=pi("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()}resize(){super.resize(),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())}};var xt=Ne(),yt=class extends rt{constructor(e){super(e)}create(){this.setConfig("mobileFooterPanel"),super.create(),this.$rotateButton=xt(`
            <button class="btn imageBtn rotate" title="${this.content.rotateRight}">
                <i class="uv-icon-rotate" aria-hidden="true"></i>${this.content.rotateRight}
            </button>
        `),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=xt(`
            <button class="btn imageBtn zoomOut" title="${this.content.zoomOut}">
                <i class="uv-icon-zoom-out" aria-hidden="true"></i>${this.content.zoomOut}
            </button>
        `),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=xt(`
            <button class="btn imageBtn zoomIn" title="${this.content.zoomIn}">
                <i class="uv-icon-zoom-in" aria-hidden="true"></i>${this.content.zoomIn}
            </button>
        `),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed(()=>{this.extensionHost.publish(I.ZOOM_IN)}),this.$zoomOutButton.onPressed(()=>{this.extensionHost.publish(I.ZOOM_OUT)}),this.$rotateButton.onPressed(()=>{this.extensionHost.publish(I.ROTATE)})}resize(){super.resize(),setTimeout(()=>{this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},1)}};var He=Ne(),it=class{constructor(e,i,n,s,o=300,a=2,r=!1,d=!1){this._$element=e,this._autoCompleteFunc=i,this._delay=o,this._minChars=a,this._onSelect=s,this._parseResultsFunc=n,this._positionAbove=r,this._allowWords=d,this._$searchResultsList=He('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=He('<li class="result"><a href="#" tabindex="-1"></a></li>');let c=function(){let w=0;return function(y,R){clearTimeout(w),w=setTimeout(y,R)}}(),p=this;this._$element.on("keydown",function(w){let y=w.originalEvent,R=Dt.getCharCode(y),b=!1;(R===_e.LeftArrow||R===_e.RightArrow)&&(b=!0),b&&(y.cancelBubble=!0,y.stopPropagation&&y.stopPropagation())}),this._$element.on("keyup",function(w){if(!p._getSelectedListItem().length&&w.keyCode===_e.Enter){p._onSelect(p._getTerms());return}if(w.keyCode!==_e.Tab){if(kt(p._$searchResultsList)&&p._results.length){if(w.keyCode===_e.Enter)p._searchForItem(p._getSelectedListItem());else if(w.keyCode===_e.DownArrow){p._setSelectedResultIndex(1);return}else if(w.keyCode===_e.UpArrow){p._setSelectedResultIndex(-1);return}}w.keyCode!==_e.Enter&&c(()=>{let y=p._getTerms();y&&y.length>p._minChars&&p._searchForWords(y)?p._search(y):(p._clearResults(),p._hideResults())},p._delay)}}),He(document).on("mouseup",w=>{this._$searchResultsList.parent().has(He(w.target)[0]).length===0&&(this._clearResults(),this._hideResults())}),He(document).on("focusin",w=>{this._$searchResultsList.has(He(w.target)[0]).length===0&&!this._$element.is(He(w.target)[0])&&(this._clearResults(),this._hideResults())}),this._hideResults()}_searchForWords(e){return!!(this._allowWords||!e.includes(" "))}_getTerms(){return this._$element.val().trim()}_setSelectedResultIndex(e){let i;e===1?i=this._selectedResultIndex+1:i=this._selectedResultIndex-1;let n=this._$searchResultsList.find("li");i<0?i=n.length-1:i>n.length-1&&(i=0),this._selectedResultIndex=i,n.removeClass("selected");let s=n.eq(this._selectedResultIndex);s.addClass("selected");let o=s.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(o)}_search(e){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();let i=this;this._autoCompleteFunc(e,n=>{i._listResults(n)})}_clearResults(){this._$searchResultsList.empty()}_hideResults(){this._$searchResultsList.hide()}_showResults(){this._selectedResultIndex=-1,this._$searchResultsList.show()}_updateListPosition(){this._positionAbove?this._$searchResultsList.css({top:this._$searchResultsList.outerHeight(!0)*-1}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})}_listResults(e){if(this._results=this._parseResultsFunc(e),this._clearResults(),!this._results.length){this._hideResults();return}for(let s=0;s<this._results.length;s++){let o=this._results[s],a=this._$searchResultTemplate.clone();a.find("a").text(o),this._$searchResultsList.append(a)}this._updateListPosition();let i=this;this._$searchResultsList.find("li").each((s,o)=>{He(o).on("click",function(a){a.preventDefault(),i._searchForItem(He(this))})})}_searchForItem(e){let i=e.find("a").text();this._$element.val(i),this._hideResults(),this._onSelect(i),this._clearResults(),this._hideResults()}_getSelectedListItem(){return this._$searchResultsList.find("li.selected")}};var Tt=Se(st()),ae=Ne(),bt=class extends rt{constructor(e){super(e);this.placemarkerTouched=!1}create(){this.setConfig("footerPanel"),super.create(),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE,()=>{this.canvasIndexChanged(),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton()}),this.extensionHost.subscribe(E.CLEAR_ANNOTATIONS,()=>{this.clearSearchResults()}),this.extensionHost.subscribe(I.MODE_CHANGE,()=>{this.settingsChanged()}),this.extensionHost.subscribe(I.SEARCH,s=>{this.terms=s}),this.extensionHost.subscribe(E.ANNOTATIONS,s=>{s.annotations.length&&(this.displaySearchResults(s.annotations,s.terms),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton())}),this.extensionHost.subscribe(E.ANNOTATIONS_EMPTY,()=>{this.hideSearchSpinner()}),this.extensionHost.subscribe(E.ANNOTATION_CHANGE,()=>{this.updatePrevButton(),this.updateNextButton()}),this.$printButton=ae(`
          <button class="print btn imageBtn" title="${this.content.print}" tabindex="0">
            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>${this.content.print}
          </button>
        `),this.$options.prepend(this.$printButton),this.$searchContainer=ae('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=ae('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=ae('<label class="label" for="searchWithinInput">'+this.content.searchWithin+"</label>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=ae('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=ae('<input class="searchText" id="searchWithinInput" autocomplete="off" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=ae('<button class="imageButton searchButton"></button>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=ae('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=ae('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=ae('<button class="previousResult">'+this.content.previousResult+"</button>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=ae(`<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> '<span class="terms">y</span>'</span></div>`),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=ae('<button class="clearSearch">'+this.content.clearSearch+"</button>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=ae('<button class="nextResult">'+this.content.nextResult+"</button>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=ae('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=ae('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=ae('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=ae('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=ae('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=ae('<div role="heading" class="heading"></div>'),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=ae("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var e=this;this.$searchButton.on("click",s=>{s.preventDefault(),this.search(this.$searchText.val())}),this.$searchText.on("focus",()=>{this.$searchText.val()===this.content.enterKeyword&&this.$searchText.val("")}),this.$placemarkerDetails.on("mouseover",()=>{e.extensionHost.publish(I.SEARCH_PREVIEW_START,this.currentPlacemarkerIndex)}),this.$placemarkerDetails.on("mouseleave",function(){ae(this).hide(),e.extensionHost.publish(I.SEARCH_PREVIEW_FINISH);var s=e.getSearchResultPlacemarkers();s.removeClass("hover")}),this.onAccessibleClick(this.$placemarkerDetails,()=>{e.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex)}),this.$previousResultButton.on("click",s=>{s.preventDefault(),this.isPreviousButtonEnabled()&&e.extensionHost.publish(I.PREV_SEARCH_RESULT)}),this.$nextResultButton.on("click",s=>{s.preventDefault(),this.isNextButtonEnabled()&&e.extensionHost.publish(I.NEXT_SEARCH_RESULT)}),this.$clearSearchResultsButton.on("click",s=>{s.preventDefault(),e.extensionHost.publish(E.CLEAR_ANNOTATIONS)}),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),this.extension.helper.getTotalCanvases()===1&&this.$searchResultsContainer.hide();let i=this.extension.getAutoCompleteUri();i?new it(this.$searchText,(s,o)=>{fetch(ge.format(i,s)).then(a=>a.json()).then(a=>{o(a)})},s=>ae.map(s.terms,o=>o.match),s=>{this.search(s)},300,2,!0,he.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",s=>{s.keyCode===_e.Enter&&e.search(e.$searchText.val())}),this.$printButton.onPressed(()=>{e.extensionHost.publish(I.PRINT)}),this.updatePrintButton();var n=he.getBool(this.config.options.positionMarkerEnabled,!0);n||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())}isSearchEnabled(){return this.extension.isSearchEnabled()}isZoomToSearchResultEnabled(){return he.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}isPreviousButtonEnabled(){let e=this.extension.helper.canvasIndex,i=this.getFirstSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?e<i?!1:!(e===i&&n===0):e>i}isNextButtonEnabled(){let e=this.extension.helper.canvasIndex,i=this.getLastSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?e>i?!1:!(e===i&&n===this.getLastSearchResultRectIndex()):e<i}getSearchResults(){return this.extension.annotations}getCurrentSearchResultRectIndex(){return this.extension.getCurrentAnnotationRectIndex()}getFirstSearchResultCanvasIndex(){let e=this.getSearchResults();return!e||!e.length?-1:e[0].canvasIndex}getLastSearchResultCanvasIndex(){let e=this.getSearchResults();return!e||!e.length?-1:e[e.length-1].canvasIndex}getLastSearchResultRectIndex(){return this.extension.getLastAnnotationRectIndex()}updateNextButton(){let e=this.getSearchResults();e&&e.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))}updatePrevButton(){let e=this.getSearchResults();e&&e.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))}updatePrintButton(){he.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()}search(e){if(this.terms=e,this.terms===""||this.terms===this.content.enterKeyword){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,function(){this.$searchText.focus()});return}this.$searchText.blur(),this.showSearchSpinner(),this.extensionHost.publish(I.SEARCH,this.terms)}getSearchResultPlacemarkers(){return this.$searchResultsContainer.find(".searchResultPlacemarker")}setCurrentSearchResultPlacemarker(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),ae('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")}positionSearchResultPlacemarkers(){let e=this.getSearchResults();if(!e||!e.length)return;let i=this.getSearchResultPlacemarkers(),n=i.length===0;i.remove();let s=this.getPageLineRatio(),o=this.$line.position().top,a=this.$line.position().left,r=this;for(let d=0;d<e.length;d++){let c=e[d],p=c.canvasIndex*s,w=ae('<div class="searchResultPlacemarker" tabindex="0" data-index="'+c.canvasIndex+'"></div>');w[0].ontouchstart=function(b){r.onPlacemarkerTouchStart.call(this,r)},w.click(function(b){r.onPlacemarkerClick.call(this,r)}),w.mouseenter(function(b){r.onPlacemarkerMouseEnter.call(this,r)}),this.onAccessibleClick(w,b=>{r.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex),r.onPlacemarkerMouseLeave.call(this,b,r)},!1),w.mouseleave(function(b){r.onPlacemarkerMouseLeave.call(this,b,r)}),w.blur(function(b){r.onPlacemarkerMouseLeave.call(this,b,r)}),this.$searchResultsContainer.append(w);let y=o-w.height(),R=a+p-w.width()/2;w.css({top:y,left:R}),d===0&&n&&w.focus()}}onPlacemarkerTouchStart(e){e.placemarkerTouched=!0}onPlacemarkerClick(e){e.placemarkerTouched||(e.placemarkerTouched=!1)}onPlacemarkerMouseEnter(e){if(e.placemarkerTouched)return;let i=ae(this);i.addClass("hover");let n=parseInt(i.attr("data-index"));e.extensionHost.publish(I.SEARCH_PREVIEW_START,n);let o=e.getSearchResultPlacemarkers().index(i[0]);e.currentPlacemarkerIndex=n,e.$placemarkerDetails.show();let a="{0} {1}";if(e.isPageModeEnabled()){let w=e.extension.helper.getCanvasByIndex(n),y=Tt.LanguageMap.getValue(w.getLabel());!y&&e.extension.helper.manifest&&(y=e.extension.helper.manifest.options.defaultLabel),y&&(a=ge.format(a,e.content.pageCaps,y))}else a=ge.format(a,e.content.imageCaps,String(n+1));e.$placemarkerDetailsTop.html(a);let r=e.getSearchResults();if(r){let w=r[o],y="";e.terms&&(y=ge.ellipsis(e.terms,e.options.elideDetailsTermsCount));let R=e.content.instanceFound,b=e.content.instancesFound,N="";w.rects.length===1?(N=ge.format(R,y),e.$placemarkerDetailsBottom.html(N)):(N=ge.format(b,String(w.rects.length),y),e.$placemarkerDetailsBottom.html(N))}let d=i.position(),c=d.top-e.$placemarkerDetails.height(),p=d.left;p<e.$placemarkerDetails.width()/2?p=0-i.width()/2:p>e.$line.width()-e.$placemarkerDetails.width()/2?p=e.$line.width()-e.$placemarkerDetails.width()+i.width()/2:p-=e.$placemarkerDetails.width()/2,e.$placemarkerDetails.css({top:c,left:p})}onPlacemarkerMouseLeave(e,i){i.extensionHost.publish(I.SEARCH_PREVIEW_FINISH);let n=ae(this),s=e.toElement||e.relatedTarget,o=ae(s).closest(i.$placemarkerDetails).length;s!=i.$placemarkerDetails.get(0)&&o===0&&(i.$placemarkerDetails.hide(),n.removeClass("hover"))}setPageMarkerPosition(){if(this.extension.helper.canvasIndex===null)return;let e=this.getPageLineRatio(),i=this.$line.position().top,n=this.$line.position().left,s=this.extension.helper.canvasIndex*e,o=i,a=n+s;this.$pagePositionMarker.css({top:o,left:a});let r=this.$line.width();a+this.$pagePositionLabel.outerWidth(!0)>r?(a-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:o,left:a})}clearSearchResults(){if(!this.isSearchEnabled())return;this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus()}getPageLineRatio(){let e=this.$line.width();return this.extension.helper.getTotalCanvases()===1?0:e/(this.extension.helper.getTotalCanvases()-1)}canvasIndexChanged(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()}settingsChanged(){this.setPlacemarkerLabel()}setPlacemarkerLabel(){let e=this.content.displaying,i=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){let n=this.extension.helper.getCanvasByIndex(i),s=Tt.LanguageMap.getValue(n.getLabel());s||(s=this.content.defaultLabel);let o=this.extension.helper.getLastCanvasLabel(!0);o&&this.$pagePositionLabel.html(ge.format(e,this.content.page,Le(s),Le(o)))}else this.$pagePositionLabel.html(ge.format(e,this.content.image,String(i+1),this.extension.helper.getTotalCanvases().toString()))}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Re.page.toString()&&!he.getBool(this.config.options.forceImageMode,!1)}showSearchSpinner(){this.$searchText.addClass("searching")}hideSearchSpinner(){this.$searchText.removeClass("searching")}displaySearchResults(e,i){if(!this.isSearchEnabled())return;this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});let n=this.$searchResultsInfo.find(".info"),s=n.find(".number"),o=n.find(".foundFor"),a=n.find(".terms");i?(n.show(),s.text(this.extension.getTotalAnnotationRects()),e.length===1?o.html(this.content.resultFoundFor):o.html(this.content.resultsFoundFor),a.html(ge.ellipsis(i,this.options.elideResultsTermsCount)),a.prop("title",i)):n.hide(),this.$searchPagerContainer.show(),this.resize()}resize(){super.resize();let e=this.getSearchResults();e&&e.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());let i=this.$element.width()/2;this.$searchPagerControls.css({left:i-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:i-this.$searchOptions.outerWidth()/2})}};var $t=Ne(),Et=class extends ot{constructor(e){super(e)}create(){this.setConfig("multiSelectDialogue"),super.create();let e=this;this.openCommand=E.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=E.HIDE_MULTISELECT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,()=>{this.open(),this.extension.helper.getMultiSelectState().setEnabled(!0),this.galleryComponent.set(this.data)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close(),this.extension.helper.getMultiSelectState().setEnabled(!1)}),this.$title=$t('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=$t('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new Gt({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",n=>{this.extensionHost.publish(E.MULTISELECTION_MADE,n),e.close()},!1),this.$element.hide()}isPageModeEnabled(){return he.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===Re.page.toString()}open(){super.open()}close(){super.close()}resize(){super.resize();let e=this.$gallery.find(".main"),i=this.$gallery.find(".header");e.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-i.height())}};var St=class{};var me=Se(ft());var We=Se(st()),fe=Ne(),Rt=class extends Ut{constructor(e){super(e);this.firstButtonEnabled=!1;this.lastButtonEnabled=!1;this.nextButtonEnabled=!1;this.prevButtonEnabled=!1}create(){if(this.setConfig("headerPanel"),super.create(),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE,i=>{this.canvasIndexChanged(i)}),this.extensionHost.subscribe(E.SETTINGS_CHANGE,()=>{this.modeChanged(),this.updatePagingToggle()}),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE_FAILED,()=>{this.setSearchFieldValue(this.extension.helper.canvasIndex)}),this.extensionHost.subscribe(E.LEFTPANEL_EXPAND_FULL_START,()=>{this.openGallery()}),this.extensionHost.subscribe(E.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.closeGallery()}),this.$prevOptions=fe('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=fe(`
          <button class="btn imageBtn first" tabindex="0" title="${this.content.first}">
            <i class="uv-icon-first" aria-hidden="true"></i>
            <span class="sr-only">${this.content.first}</span>
          </button>
        `),this.$prevOptions.append(this.$firstButton),this.$prevButton=fe(`
          <button class="btn imageBtn prev" tabindex="0" title="${this.content.previous}">
            <i class="uv-icon-prev" aria-hidden="true"></i>
            <span class="sr-only">${this.content.previous}</span>
          </button>
        `),this.$prevOptions.append(this.$prevButton),this.$modeOptions=fe('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=fe('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=fe('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=fe('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=fe('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=fe('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=fe('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),he.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=fe('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new it(this.$autoCompleteBox,(i,n)=>{let s=[],o=this.extension.helper.getCanvases();if(this.isPageModeEnabled())for(let a=0;a<o.length;a++){let r=o[a],d=We.LanguageMap.getValue(r.getLabel());d&&d.startsWith(i)&&s.push(d)}else for(let a=0;a<o.length;a++){let r=o[a];r.index.toString().startsWith(i)&&s.push(r.index.toString())}n(s)},i=>i,i=>{this.search(i)},300,0,he.getBool(this.options.autocompleteAllowWords,!1));else if(he.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=fe('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=fe('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(let i=0;i<this.extension.helper.getTotalCanvases();i++){let n=this.extension.helper.getCanvasByIndex(i),s=Le(We.LanguageMap.getValue(n.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+i+">"+s+"</option>")}this.$imageSelectionBox.change(()=>{let i=parseInt(this.$imageSelectionBox.val());this.extensionHost.publish(I.IMAGE_SEARCH,i)})}this.$total=fe('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=fe(`<a class="go btn btn-primary" tabindex="0">${this.content.go}</a>`),this.$search.append(this.$searchButton),this.$nextOptions=fe('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=fe(`
          <button class="btn imageBtn next" tabindex="0" title="${this.content.next}">
            <i class="uv-icon-next" aria-hidden="true"></i>
            <span class="sr-only">${this.content.next}</span>
          </button>
        `),this.$nextOptions.append(this.$nextButton),this.$lastButton=fe(`
          <button class="btn imageBtn last" tabindex="0" title="${this.content.last}">
            <i class="uv-icon-last" aria-hidden="true"></i>
            <span class="sr-only">${this.content.last}</span>
          </button>
        `),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType()===We.ManifestType.MANUSCRIPT?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=fe(`
          <button class="btn imageBtn gallery" title="${this.content.gallery}">
            <i class="uv-icon-gallery" aria-hidden="true"></i>
            <span class="sr-only">${this.content.gallery}</span>
          </button>
        `),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=fe('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=fe(`
          <button class="btn imageBtn one-up" title="${this.content.oneUp}">
            <i class="uv-icon-one-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.oneUp}</span>
          </button>`),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=fe(`
          <button class="btn imageBtn two-up" title="${this.content.twoUp}">
            <i class="uv-icon-two-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.twoUp}</span>
          </button>
        `),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed(()=>{let i=!1;this.updateSettings({pagingEnabled:i}),this.extensionHost.publish(I.PAGING_TOGGLED,i)}),this.$twoUpButton.onPressed(()=>{let i=!0;this.updateSettings({pagingEnabled:i}),this.extensionHost.publish(I.PAGING_TOGGLED,i)}),this.$galleryButton.onPressed(()=>{this.extensionHost.publish(E.TOGGLE_EXPAND_LEFT_PANEL)}),this.setNavigationTitles(),this.setTotal();let e=this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT;this.extension.helper.getTotalCanvases()===1&&this.$centerOptions.hide(),this.$firstButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(E.FIRST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(E.LAST);break}}),this.$prevButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(E.PREV);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(E.NEXT);break}}),this.$nextButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(E.NEXT);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(E.PREV);break}}),this.$lastButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(E.LAST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(E.FIRST);break}}),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",()=>{this.extensionHost.publish(I.MODE_CHANGE,Re.image.toString())}),this.$pageModeOption.on("click",()=>{this.extensionHost.publish(I.MODE_CHANGE,Re.page.toString())})):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter(()=>{this.$searchText.blur(),this.search(this.$searchText.val())}),this.$searchText.click(function(){fe(this).select()}),this.$searchButton.onPressed(()=>{this.options.autoCompleteBoxEnabled?this.search(this.$autoCompleteBox.val()):this.search(this.$searchText.val())}),this.options.modeOptionsEnabled===!1&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$search.hide(),this.options.helpEnabled===!1&&this.$helpButton.hide(),he.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()}openGallery(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")}closeGallery(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Re.page.toString()}setNavigationTitles(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))}updatePagingToggle(){if(!this.pagingToggleIsVisible()){this.$pagingToggleButtons.hide();return}this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on"))}pagingToggleIsVisible(){return he.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()}updateGalleryButton(){this.galleryIsVisible()||this.$galleryButton.hide()}galleryIsVisible(){return he.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()}setTotal(){let e=this.content.of;this.isPageModeEnabled()?this.$total.html(ge.format(e,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(ge.format(e,this.extension.helper.getTotalCanvases().toString()))}setSearchFieldValue(e){let i=this.extension.helper.getCanvasByIndex(e),n=null;if(this.isPageModeEnabled()){let s=We.LanguageMap.getValue(i.getLabel());s==="-"?n="":n=s}else e+=1,n=e.toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(n):this.$searchText.val(n)}search(e){if(!e){this.extension.showMessage(this.content.emptyValue),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE_FAILED);return}if(this.isPageModeEnabled())this.extensionHost.publish(I.PAGE_SEARCH,e);else{let i;if(this.options.autoCompleteBoxEnabled?i=parseInt(this.$autoCompleteBox.val(),10):i=parseInt(this.$searchText.val(),10),i-=1,isNaN(i)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE_FAILED);return}if(!this.extension.helper.getCanvasByIndex(i)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE_FAILED);return}this.extensionHost.publish(I.IMAGE_SEARCH,i)}}canvasIndexChanged(e){this.setSearchFieldValue(e),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$imageSelectionBox.val(e),(this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT)===me.ViewingDirection.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))}disableFirstButton(){this.firstButtonEnabled=!1,this.$firstButton.disable()}enableFirstButton(){this.firstButtonEnabled=!0,this.$firstButton.enable()}disableLastButton(){this.lastButtonEnabled=!1,this.$lastButton.disable()}enableLastButton(){this.lastButtonEnabled=!0,this.$lastButton.enable()}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.disable()}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.enable()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.disable()}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.enable()}modeChanged(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()}resize(){super.resize(),this.extension.isMobileMetric()?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())}};var Me=Se(at()),_n=Se(ei()),ti=Se(ft());var De=Ne(),Pt=class extends Ft{constructor(e){super(e);this.controlsVisible=!1;this.isCreated=!1;this.isLoaded=!1;this.isFirstLoad=!0;this.navigatedFromSearch=!1;this.nextButtonEnabled=!1;this.prevButtonEnabled=!1}create(){this.setConfig("centerPanel"),super.create(),this.viewerId="osd"+new Date().getTime(),this.$viewer=De('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.extensionHost.subscribe(E.ANNOTATIONS,e=>{this.overlayAnnotations()}),this.extensionHost.subscribe(E.SETTINGS_CHANGE,e=>{this.viewer.gestureSettingsMouse.clickToZoom=e.clickToZoomEnabled}),this.extensionHost.subscribe(E.OPEN_EXTERNAL_RESOURCE,e=>{this.whenResized(async()=>{this.isCreated||this.createUI(),this.isLoaded=!1,await this.openMedia(e),this.isLoaded=!0,this.extensionHost.publish($e.EXTERNAL_RESOURCE_OPENED),this.extensionHost.publish($e.LOAD)})}),this.extensionHost.subscribe(E.CLEAR_ANNOTATIONS,()=>{this.whenCreated(()=>{this.extension.currentAnnotationRect=null,this.clearAnnotations()})}),this.extensionHost.subscribe(I.NEXT_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.nextAnnotation()})}),this.extensionHost.subscribe(I.PREV_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.prevAnnotation()})}),this.extensionHost.subscribe(I.ZOOM_IN,()=>{this.whenCreated(()=>{this.zoomIn()})}),this.extensionHost.subscribe(I.ZOOM_OUT,()=>{this.whenCreated(()=>{this.zoomOut()})}),this.extensionHost.subscribe(I.ROTATE,()=>{this.whenCreated(()=>{this.rotateRight()})}),this.extensionHost.subscribe(E.METRIC_CHANGE,()=>{this.whenCreated(()=>{this.updateResponsiveView()})}),this.extensionHost.subscribe(E.SET_TARGET,e=>{this.whenLoaded(()=>{this.fitToBounds(e,!1)})}),this.extensionHost.subscribe(E.SET_ROTATION,e=>{this.whenLoaded(()=>{this.viewer.viewport.setRotation(e)})})}whenCreated(e){dt.waitFor(()=>this.isCreated,e)}whenLoaded(e){dt.waitFor(()=>this.isLoaded,e)}zoomIn(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*2)}zoomOut(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*.5)}rotateRight(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)}updateResponsiveView(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?this.viewer.autoHideControls=!0:this.viewer.autoHideControls=!1}async createUI(){this.$spinner=De('<div class="spinner"></div>'),this.$content.append(this.$spinner);let e="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";this.viewer=(0,Me.default)({element:this.$viewer[0],showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:he.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",navigatorHeight:"100px",navigatorWidth:"100px",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:he.getBool(this.config.options.constrainDuringPan,!1),immediateRender:he.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:he.getBool(this.config.options.autoHideControls,!0),prefixUrl:null,gestureSettingsMouse:{clickToZoom:he.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:e,GROUP:e,HOVER:e,DOWN:e},zoomOut:{REST:e,GROUP:e,HOVER:e,DOWN:e},home:{REST:e,GROUP:e,HOVER:e,DOWN:e},rotateright:{REST:e,GROUP:e,HOVER:e,DOWN:e},rotateleft:{REST:e,GROUP:e,HOVER:e,DOWN:e},next:{REST:e,GROUP:e,HOVER:e,DOWN:e},previous:{REST:e,GROUP:e,HOVER:e,DOWN:e}}});let i=this,n=Mt(s=>{let o=i.extension.helper.getCurrentCanvas();var a=i.viewer.viewport.pointFromPixel(s.position),r=i.viewer.viewport.viewportToImageCoordinates(a.x,a.y);this.extensionHost.publish(I.DOUBLECLICK,{target:`${o.id}#xywh=${Math.round(r.x)},${Math.round(r.y)},1,1`})},100);this.viewer.addViewerInputHook({hooks:[{tracker:"viewer",handler:"dblClickHandler",hookHandler:s=>{let o=this.extension.getSettings(),a=this.extension.helper.isPagingAvailable();(a&&!o.pagingEnabled||!a)&&this.config.options.doubleClickAnnotationEnabled&&n(s)}}]}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.prop("aria-label",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.prop("aria-label",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.prop("aria-label",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.prop("aria-label",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=De(this.viewer.canvas),this.$canvas.on("contextmenu",()=>!1),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$element.on("mouseleave",()=>{!this.controlsVisible||(this.controlsVisible=!1,this.viewer.setControlsEnabled(!1))}),this.$element.on("mousemove",()=>{if(!this.$prevButton.ismouseover()&&!this.$nextButton.ismouseover()&&!this.$viewer.find(".navigator").ismouseover()){if(!this.controlsVisible)return;this.controlsVisible=!1,this.viewer.setControlsEnabled(!1)}},this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",()=>{this.$spinner.hide()}),this.viewer.addHandler("resize",s=>{this.extensionHost.publish(I.OPENSEADRAGON_RESIZE,s),this.viewerResize(s)}),this.viewer.addHandler("animation-start",s=>{this.extensionHost.publish(I.OPENSEADRAGON_ANIMATION_START,s)}),this.viewer.addHandler("animation",s=>{this.extensionHost.publish(I.OPENSEADRAGON_ANIMATION,s)}),this.viewer.addHandler("animation-finish",s=>{this.currentBounds=this.getViewportBounds(),this.updateVisibleAnnotationRects(),this.extensionHost.publish(I.OPENSEADRAGON_ANIMATION_FINISH,s)}),this.viewer.addHandler("rotate",s=>{this.extensionHost.publish(I.OPENSEADRAGON_ROTATION,s.degrees)}),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0}createNavigationButtons(){let e=this.extension.helper.getViewingDirection()||xe.LEFT_TO_RIGHT;switch(this.$prevButton=De('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=De('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:Me.default.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:Me.default.ControlAnchor.TOP_RIGHT}),e){case xe.BOTTOM_TO_TOP:case xe.TOP_TO_BOTTOM:this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical");break}let i=this;this.onAccessibleClick(this.$prevButton,n=>{if(n.preventDefault(),Me.default.cancelEvent(n),!!i.prevButtonEnabled)switch(e){case xe.LEFT_TO_RIGHT:case xe.BOTTOM_TO_TOP:case xe.TOP_TO_BOTTOM:this.extensionHost.publish(E.PREV);break;case xe.RIGHT_TO_LEFT:this.extensionHost.publish(E.NEXT);break}}),this.onAccessibleClick(this.$nextButton,n=>{if(n.preventDefault(),Me.default.cancelEvent(n),!!i.nextButtonEnabled)switch(e){case xe.LEFT_TO_RIGHT:case xe.BOTTOM_TO_TOP:case xe.TOP_TO_BOTTOM:this.extensionHost.publish(E.NEXT);break;case xe.RIGHT_TO_LEFT:this.extensionHost.publish(E.PREV);break}}),this.$prevButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$nextButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))})}async getGirderTileSource(){return new Promise(e=>{let n=this.extension.helper.getCurrentCanvas().getContent();if(n.length){let o=n[0].getBody();if(o.length){let a=o[0].getServices();if(a.length){let r=a[0].id,d=r;d.endsWith("/")||(d+="/"),d+="tiles",r.endsWith("/")&&(r=r.substr(0,r.length-1)),fetch(d).then(c=>c.json()).then(c=>{let p={height:c.sizeY,width:c.sizeX,tileWidth:c.tileWidth,tileHeight:c.tileHeight,minLevel:0,maxLevel:c.levels-1,units:"mm",spacing:[c.mm_x,c.mm_y],getTileUrl:function(w,y,R,b){var N=d+"/zxy/"+w+"/"+y+"/"+R;return b&&(N+="?"+De.param(b)),N}};c.mm_x||(p.units="pixels",p.spacing=[1,1]),e(p)})}}}})}async openMedia(e){if(!this.viewer)return;this.$spinner.show(),this.items=[];let i=await this.extension.getExternalResources(e),n=this.extension.format===ti.MediaType.GIRDER;try{this.viewer.close(),i=this.getPagePositions(i);for(let s=0;s<i.length;s++){let o=i[s],a;o.hasServiceDescriptor?a=o:n?a=await this.getGirderTileSource():a={type:"image",url:o.id,buildPyramid:!1},this.viewer.addTiledImage({tileSource:a,x:o.x,y:o.y,width:o.width,success:r=>{this.items.push(r),this.items.length===i.length&&this.openPagesHandler(),this.resize(),this.goHome()}})}}catch{}}getPagePositions(e){let i,n,s,o,a,r;if(e.length>1)if(e.length===2)this.extension.helper.isVerticallyAligned()?(s=e[0],s.y=0,o=e[1],o.y=s.height+this.config.options.pageGap):(i=e[0],i.x=0,n=e[1],n.x=i.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(let d=0;d<e.length-1;d++)a=e[d],r=e[d+1],r.y=(a.y||0)+a.height;else for(let d=e.length;d>0;d--)a=e[d],r=e[d-1],r.y=(a.y||0)-a.height;else if(this.extension.helper.isLeftToRight())for(let d=0;d<e.length-1;d++)a=e[d],r=e[d+1],r.x=(a.x||0)+a.width;else for(let d=e.length-1;d>0;d--)a=e[d],r=e[d-1],r.x=(a.x||0)-a.width;return e}openPagesHandler(){this.extensionHost.publish(I.OPENSEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous()&&(this.showPrevButton(),this.showNextButton(),De(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||xe.LEFT_TO_RIGHT)===xe.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton())),this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1}zoomToInitialAnnotation(){let e=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,e&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(e)}overlayAnnotations(){let e=this.getAnnotationsForCurrentImages();this.clearAnnotations();for(let i=0;i<e.length;i++){let n=e[i],s=this.getAnnotationOverlayRects(n);for(let o=0;o<s.length;o++){let a=s[o],r=document.createElement("DIV");if(r.id="annotation-"+a.canvasIndex+"-"+a.resultIndex,r.title=Le(a.chars),a.width===1&&a.height===1){r.className="annotationPin",r.onclick=c=>{c.preventDefault(),this.extensionHost.publish(E.PINPOINT_ANNOTATION_CLICKED,o)};let d=document.createElement("SPAN");d.innerText=String(o+1),r.appendChild(d)}else r.className="annotationRect";this.viewer.addOverlay(r,a)}}}updateBounds(){let e=this.extension.getSettings();if(this.isFirstLoad){this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation));let i=this.extension.data.xywh;i&&(this.initialBounds=Ie.fromString(i),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))}else e.preserveViewport&&this.currentBounds?this.fitToBounds(this.currentBounds):this.goHome()}goHome(){this.viewer.viewport.goHome(!0)}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")}hidePrevButton(){this.disablePrevButton(),this.$prevButton.hide()}showPrevButton(){this.enablePrevButton(),this.$prevButton.show()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")}hideNextButton(){this.disableNextButton(),this.$nextButton.hide()}showNextButton(){this.enableNextButton(),this.$nextButton.show()}fitToBounds(e,i=!0){let n=new Me.default.Rect;n.x=Number(e.x),n.y=Number(e.y),n.width=Number(e.w),n.height=Number(e.h),setTimeout(()=>{this.viewer.viewport.fitBoundsWithConstraints(n,i)},100)}getCroppedImageBounds(){if(!this.viewer||!this.viewer.viewport)return null;let e=this.extension.helper.getCurrentCanvas(),i=this.extension.getCroppedImageDimensions(e,this.viewer);return i?new Ie(i.regionPos.x,i.regionPos.y,i.region.width,i.region.height).toString():null}getViewportBounds(){if(!this.viewer||!this.viewer.viewport)return null;let e=this.viewer.viewport.getBounds(!0);return new Ie(Math.floor(e.x),Math.floor(e.y),Math.floor(e.width),Math.floor(e.height))}viewerResize(e){if(!e.viewport)return;let i=e.viewport.getCenter(!0);!i||setTimeout(function(){e.viewport.panTo(i,!0)},1)}clearAnnotations(){this.viewer.clearOverlays()}getAnnotationsForCurrentImages(){let e=[],i=this.extension.annotations;if(!i||!i.length)return e;let n=this.extension.getPagedIndices();for(let s=0;s<n.length;s++){let o=n[s];for(let a=0;a<i.length;a++)if(i[a].canvasIndex===o){e.push(i[a]);break}}return e}getAnnotationRectsForCurrentImages(){let e=this.getAnnotationsForCurrentImages();return e.length?e.map(i=>i.rects).reduce((i,n)=>i.concat(n)):[]}updateVisibleAnnotationRects(){let e=this.getAnnotationRectsForCurrentImages();for(let i=0;i<e.length;i++){let n=e[i],s=this.viewer.viewport.getBounds();n.isVisible=Nt.hitRect(s.x,s.y,s.width,s.height,n.viewportX,n.viewportY)}}getAnnotationRectIndex(e){return this.getAnnotationRectsForCurrentImages().indexOf(e)}isZoomToSearchResultEnabled(){return he.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}prevAnnotation(){let e=this.getAnnotationRectsForCurrentImages(),i=this.extension.currentAnnotationRect,n=i?this.getAnnotationRectIndex(i):e.length,s=null;for(let o=n-1;o>=0;o--){s=e[o];break}s&&this.isZoomToSearchResultEnabled()?s.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=s,this.navigatedFromSearch=!0,this.extensionHost.publish(E.ANNOTATION_CANVAS_CHANGE,[s])):this.zoomToAnnotation(s):(this.navigatedFromSearch=!0,this.extensionHost.publish(I.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))}nextAnnotation(){let e=this.getAnnotationRectsForCurrentImages(),i=this.extension.currentAnnotationRect,n=i?this.getAnnotationRectIndex(i):-1,s=null;for(let o=n+1;o<e.length;o++){s=e[o];break}s&&this.isZoomToSearchResultEnabled()?s.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=s,this.navigatedFromSearch=!0,this.extensionHost.publish(E.ANNOTATION_CANVAS_CHANGE,[s])):this.zoomToAnnotation(s):(this.navigatedFromSearch=!0,this.extensionHost.publish(I.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))}getAnnotationRectByIndex(e){let i=this.getAnnotationRectsForCurrentImages();return i.length?i[e]:null}getInitialAnnotationRect(){let e=this.getAnnotationRectsForCurrentImages();if(!e.length)return null;if(!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex){let n=e.filter(s=>s.canvasIndex===this.extension.helper.canvasIndex);return n[n.length-1]}return e.filter(n=>n.canvasIndex===this.extension.helper.canvasIndex)[0]}zoomToAnnotation(e){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||e,this.extension.currentAnnotationRect=e,he.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new Ie(e.viewportX,e.viewportY,e.width,e.height),!1);else if(this.currentBounds){let i=e.viewportX-(this.currentBounds.w*.5-e.width*.5),n=e.viewportY-(this.currentBounds.h*.5-e.height*.5),s=this.currentBounds.w,o=this.currentBounds.h,a=new Ie(i,n,s,o);this.fitToBounds(a)}this.highlightAnnotationRect(e),this.extensionHost.publish(E.ANNOTATION_CHANGE)}highlightAnnotationRect(e){let i=De("#annotation-"+e.canvasIndex+"-"+e.index);i.addClass("current"),De(".annotationRect").not(i).removeClass("current")}getAnnotationOverlayRects(e){let i=[];if(!this.extension.resources)return i;let n=this.extension.resources.filter(a=>a.index===e.canvasIndex)[0],s=this.extension.resources.indexOf(n),o=0;s>0&&(o=this.extension.resources[s-1].width);for(let a=0;a<e.rects.length;a++){let r=e.rects[a],d=r.x+o+(s>0?this.config.options.pageGap:0),c=r.y,p=r.width,w=r.height,y=new Me.default.Rect(d,c,p,w);r.viewportX=d,r.viewportY=c,y.canvasIndex=r.canvasIndex,y.resultIndex=r.index,y.chars=r.chars,i.push(y)}return i}resize(){if(super.resize(),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),!this.isCreated)return;this.title&&this.$title.text(Le(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);let e=this.extension.helper.getViewingDirection()||xe.LEFT_TO_RIGHT;if(this.extension.helper.isRightToLeft()?this.$title.addClass("rtl"):this.$title.removeClass("rtl"),this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){let i=Math.floor(this.$content.width()/2);switch(e){case xe.BOTTOM_TO_TOP:this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",i-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",i*-1-this.$nextButton.outerWidth()/2);break;case xe.TOP_TO_BOTTOM:this.$prevButton.css("left",i-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",i*-1-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2);break}}setTimeout(()=>{if(this.extension.helper.isContinuous())if(this.extension.helper.isHorizontallyAligned()){let i=this.$viewer.width()-this.$viewer.rightMargin();this.$navigator.width(i)}else this.$navigator.height(this.$viewer.height())},100)}setFocus(){this.$canvas&&!this.$canvas.is(":focus")&&this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()}setNavigatorVisible(){let e=he.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer&&this.viewer.navigator&&(this.viewer.navigator.setVisible(e),e?this.$navigator.show():this.$navigator.hide())}};var Ce=Ne(),_t=class extends Zt{constructor(e){super(e)}create(){this.setConfig("settingsDialogue"),super.create(),this.$navigatorEnabled=Ce('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=Ce('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=Ce('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=Ce('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=Ce('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=Ce('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=Ce('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=Ce('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=Ce('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=Ce('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=Ce('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=Ce('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change(()=>{let e={};this.$navigatorEnabledCheckbox.is(":checked")?e.navigatorEnabled=!0:e.navigatorEnabled=!1,this.updateSettings(e)}),this.$clickToZoomEnabledCheckbox.change(()=>{let e={};this.$clickToZoomEnabledCheckbox.is(":checked")?e.clickToZoomEnabled=!0:e.clickToZoomEnabled=!1,this.updateSettings(e)}),this.$pagingEnabledCheckbox.change(()=>{let e={};this.$pagingEnabledCheckbox.is(":checked")?e.pagingEnabled=!0:e.pagingEnabled=!1,this.updateSettings(e)}),this.$preserveViewportCheckbox.change(()=>{let e={};this.$preserveViewportCheckbox.is(":checked")?e.preserveViewport=!0:e.preserveViewport=!1,this.updateSettings(e)})}open(){super.open();let e=this.getSettings();e.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),e.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?e.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),e.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")}};var It=class extends qt{constructor(e){super(e);this.extensionHost.subscribe(I.OPENSEADRAGON_OPEN,()=>{this.update()}),this.extensionHost.subscribe(I.OPENSEADRAGON_ANIMATION_FINISH,()=>{this.update()})}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update();let e=this.extension.getViewportBounds(),i=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,e,i),this.$code.val(this.code)}resize(){super.resize()}};var ye=Se(ft());var Pe=Se(st());var oi=Se(ci()),ri=Se(Vt());var ii=t=>{let e,i=new Set,n=(d,c)=>{let p=typeof d=="function"?d(e):d;if(!Object.is(p,e)){let w=e;e=c??typeof p!="object"?p:Object.assign({},e,p),i.forEach(y=>y(e,w))}},s=()=>e,r={setState:n,getState:s,subscribe:d=>(i.add(d),()=>i.delete(d)),destroy:()=>i.clear()};return e=t(n,s,r),r},ni=t=>t?ii(t):ii;var si=()=>ni(t=>({downloadDialogueOpen:!1,dialogueTriggerButton:null,openDownloadDialogue:e=>t({downloadDialogueOpen:!0,dialogueTriggerButton:e}),closeDialogue:()=>t({downloadDialogueOpen:!1,dialogueTriggerButton:null})}));var fi={allowStealFocus:!1,authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,leftPanelEnabled:!0,limitLocales:!1,doubleClickAnnotationEnabled:!1,metrics:[{type:"sm",minWidth:0},{type:"md",minWidth:768},{type:"lg",minWidth:1024},{type:"xl",minWidth:1280}],multiSelectionMimeType:"application/zip",navigatorEnabled:!0,openTemplate:"http://universalviewer.io?manifest={0}",overrideFullScreen:!1,pagingEnabled:!0,pagingOptionEnabled:!0,pessimisticAccessControl:!1,preserveViewport:!1,rightPanelEnabled:!0,saveUserSettings:!1,clickToZoomEnabled:!0,searchWithinEnabled:!0,seeAlsoEnabled:!1,termsOfUseEnabled:!0,theme:"uv-en-GB-theme",tokenStorage:"session",useArrowKeysToNavigate:!1,zoomToSearchResultEnabled:!0,zoomToBoundsEnabled:!0},mi={leftPanel:{options:{autoExpandTreeEnabled:!1,autoExpandTreeIfFewerThan:20,branchNodesExpandOnClick:!0,branchNodesSelectable:!1,defaultToTreeEnabled:!1,defaultToTreeIfGreaterThan:0,elideCount:40,expandFullEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,tabOrder:"",thumbsCacheInvalidation:{enabled:!0,paramType:"?"},thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,topCloseButtonEnabled:!1,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90},content:{close:"$close",collapse:"$collapse",collapseFull:"$collapseFull",date:"$date",expand:"$expandContents",expandFull:"$expandGallery",index:"$index",manifestRanges:"$manifestRanges",searchResult:"$searchResult",searchResults:"$searchResults",sortBy:"$sortBy",thumbnails:"$thumbnails",title:"$contents",volume:"$volume"}},dialogue:{options:{topCloseButtonEnabled:!1},content:{close:"$close"}},downloadDialogue:{options:{confinedImageSize:1e3,currentViewDisabledPercentage:90,downloadCurrentViewEnabled:!0,downloadWholeImageHighResEnabled:!0,downloadWholeImageLowResEnabled:!0,maxImageWidth:5e3,optionsExplanatoryTextEnabled:!1,selectionEnabled:!1,topCloseButtonEnabled:!1},content:{allPages:"$allPages",close:"$close",currentViewAsJpg:"$currentViewAsJpg",currentViewAsJpgExplanation:"$openNewWindow",download:"$download",downloadSelection:"$downloadSelection",downloadSelectionExplanation:"$downloadSelectionExplanation",editSettings:"$editSettings",entireDocument:"$entireDocument",entireFileAsOriginal:"$entireFile",entireFileAsOriginalWithFormat:"$entireFileWithFormat",individualPages:"$individualPages",noneAvailable:"$noDownloadOptionsAvailable",pagingNote:"$pagingNote",preview:"$preview",selection:"$selection",termsOfUse:"$termsOfUse",title:"$download",wholeImageHighRes:"$wholeImageHighRes",wholeImageHighResExplanation:"$openNewWindow",wholeImageLowResAsJpg:"$wholeImageLowResAsJpg",wholeImageLowResAsJpgExplanation:"$openNewWindow",wholeImagesHighRes:"$wholeImagesHighRes",wholeImagesHighResExplanation:"$wholeImagesHighResExplanation"}},genericDialogue:{options:{topCloseButtonEnabled:!1},content:{emptyValue:"$emptyValue",close:"$close",invalidNumber:"$invalidNumber",noMatches:"$noMatches",ok:"$ok",pageNotFound:"$pageNotFound",refresh:"$refresh"}},helpDialogue:{options:{topCloseButtonEnabled:!1},content:{close:"$close",text:"$placeholder_text",title:"$help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,expandFullEnabled:!1,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines",topCloseButtonEnabled:!1},content:{attribution:"$attribution",canvasHeader:"$aboutTheImage",close:"$close",collapse:"$collapseInformation",collapseFull:"$collapseGallery",copiedToClipboard:"$copiedToClipboard",copyToClipboard:"$copyToClipboard",description:"$description",expand:"$expandInformation",expandFull:"$expandGallery",holdingText:"$moduleGoesHere",less:"$less",license:"$license",logo:"$logo",manifestHeader:"$aboutTheItem",more:"$more",noData:"$noDataToDisplay",page:"$page",rangeHeader:"$aboutThisSection",title:"$moreInformation"}},multiSelectDialogue:{options:{galleryThumbChunkedResizingEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,pageModeEnabled:!0,topCloseButtonEnabled:!1},content:{close:"$close",select:"$download",selectAll:"$selectAll",title:"$selectPagesForDownload"}},headerPanel:{options:{autoCompleteBoxEnabled:!0,autocompleteAllowWords:!1,galleryButtonEnabled:!0,imageSelectionBoxEnabled:!1,pageModeEnabled:!1,pagingToggleEnabled:!0,centerOptionsEnabled:!0,localeToggleEnabled:!1,settingsButtonEnabled:!0,helpEnabled:!0,modeOptionsEnabled:!0},content:{close:"$close",emptyValue:"$emptyValue",first:"$first",firstImage:"$firstImage",firstPage:"$firstPage",folio:"$folio",gallery:"$gallery",go:"$go",help:"$help",image:"$image",last:"$last",lastImage:"$lastImage",lastPage:"$lastPage",next:"$next",nextImage:"$nextImage",nextPage:"$nextPage",of:"$of",oneUp:"$singlePageView",page:"$page",pageSearchLabel:"$searchByPageNumber",previous:"$previous",previousImage:"$previousImage",previousPage:"$previousPage",settings:"$settings",twoUp:"$twoPageView"}},centerPanel:{options:{animationTime:.15,autoHideControls:!0,blendTime:0,constrainDuringPan:!1,controlsFadeAfterInactive:1500,controlsFadeDelay:250,controlsFadeLength:250,defaultZoomLevel:0,doubleClickAnnotationEnabled:!1,immediateRender:!1,maxZoomPixelRatio:1.25,mostSpecificRequiredStatement:!0,navigatorPosition:"BOTTOM_RIGHT",pageGap:50,requiredStatementEnabled:!0,showHomeControl:!1,subtitleEnabled:!0,titleEnabled:!0,trimAttributionCount:150,visibilityRatio:.5},content:{attribution:"$attribution",goHome:"$goHome",imageUnavailable:"$imageUnavailable",next:"$next",previous:"$previous",rotateRight:"$rotateRight",zoomIn:"$zoomIn",zoomOut:"$zoomOut"}},footerPanel:{options:{autocompleteAllowWords:!1,elideDetailsTermsCount:20,elideResultsTermsCount:10,forceImageMode:!1,pageModeEnabled:!0,positionMarkerEnabled:!0,bookmarkEnabled:!1,downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,fullscreenEnabled:!0,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,printEnabled:!1,shareEnabled:!0},content:{clearSearch:"$clearSearch",defaultLabel:"-",displaying:"$displaying_A_of_B",enterKeyword:"$enterKeyword",image:"$imageLowercase",imageCaps:"$image",instanceFound:"$instanceFound",instancesFound:"$instancesFound",nextResult:"$nextResult",page:"$pageLowercase",pageCaps:"$page",previousResult:"$previousResult",print:"$print",resultFoundFor:"$resultFoundFor",resultsFoundFor:"$resultsFoundFor",searchWithin:"$searchWithinItem",bookmark:"$add_to_bookmarks",download:"$download",embed:"$embed",exitFullScreen:"$exitFullScreen",feedback:"$feedback",fullScreen:"$fullScreen",moreInfo:"$moreInfo",open:"$open",share:"$share"}},settingsDialogue:{options:{topCloseButtonEnabled:!1},content:{close:"$close",locale:"$locale",navigatorEnabled:"$navigatorEnabled",clickToZoomEnabled:"$clickToZoomEnabled",pagingEnabled:"$goHome",reducedMotion:"$reducedMotion",preserveViewport:"$preserveViewport",title:"$settings",website:"$uvWebsite"}},shareDialogue:{options:{embedEnabled:!0,embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>',instructionsEnabled:!1,shareEnabled:!0,shareFrameEnabled:!0,shareManifestsEnabled:!0,topCloseButtonEnabled:!1},content:{close:"$close",customSize:"$custom",embed:"$embed",embedInstructions:"$embedInstructions",height:"$height",iiif:"$iiifManifest",share:"$share",shareInstructions:"$shareInstructions",shareUrl:"$shareUrl",size:"$size",width:"$width"}},authDialogue:{options:{topCloseButtonEnabled:!1},content:{cancel:"$cancel",confirm:"$confirm",close:"$close"}},clickThroughDialogue:{options:{topCloseButtonEnabled:!1},content:{close:"$close",viewTerms:"$viewTerms"}},loginDialogue:{options:{topCloseButtonEnabled:!1},content:{login:"$login",logout:"$logout",cancel:"$cancel",close:"$close"}},mobileFooterPanel:{options:{bookmarkEnabled:!1,downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,fullscreenEnabled:!0,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,printEnabled:!1,shareEnabled:!0},content:{rotateRight:"$rotateRight",moreInfo:"$moreInfo",zoomIn:"$zoomIn",zoomOut:"$zoomOut",bookmark:"$add_to_bookmarks",download:"$download",embed:"$embed",exitFullScreen:"$exitFullScreen",feedback:"$feedback",fullScreen:"$fullScreen",open:"$open",share:"$share"}},restrictedDialogue:{options:{topCloseButtonEnabled:!1},content:{cancel:"$cancel",close:"$close"}},externalContentDialogue:{options:{topCloseButtonEnabled:!1},content:{cancel:"$cancel",close:"$close",confirm:"$confirm"}}},vi={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xE7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},wi={authCORSError:"$authCORSError",authorisationFailedMessage:"$authorisationFailedMessage",canvasIndexOutOfRange:"$canvasIndexOutOfRange",fallbackDegradedLabel:"$fallbackDegradedLabel",fallbackDegradedMessage:"$fallbackDegradedMessage",forbiddenResourceMessage:"$forbiddenResourceMessage",mediaViewer:"$mediaViewer",skipToDownload:"$skipToDownload",termsOfUse:"$termsOfUse"},Ot={options:fi,modules:mi,localisation:vi,content:wi};var ai=class extends zt{constructor(){super(...arguments);this.currentRotation=0;this.isAnnotating=!1;this.defaultConfig=Ot;this.locales={"en-GB":Ot}}create(){super.create(),this.store=si(),this.store.subscribe(e=>{this.renderDownloadDialogue()}),this.extensionHost.subscribe(E.METRIC_CHANGE,()=>{if(!this.isDesktopMetric()){let e={};e.pagingEnabled=!1,this.updateSettings(e),this.extensionHost.publish(E.UPDATE_SETTINGS)}}),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE,e=>{this.previousAnnotationRect=null,this.currentAnnotationRect=null,this.changeCanvas(e)}),this.extensionHost.subscribe(E.CLEAR_ANNOTATIONS,()=>{this.clearAnnotations(),this.extensionHost.publish(E.ANNOTATIONS_CLEARED),this.fire(E.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(E.DOWN_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(E.END,()=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(E.FIRST,()=>{this.fire(E.FIRST),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(E.GALLERY_DECREASE_SIZE,()=>{this.fire(E.GALLERY_DECREASE_SIZE)}),this.extensionHost.subscribe(E.GALLERY_INCREASE_SIZE,()=>{this.fire(E.GALLERY_INCREASE_SIZE)}),this.extensionHost.subscribe(E.GALLERY_THUMB_SELECTED,()=>{this.fire(E.GALLERY_THUMB_SELECTED)}),this.extensionHost.subscribe(E.HOME,()=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(I.IMAGE_SEARCH,e=>{this.fire(I.IMAGE_SEARCH,e),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,e)}),this.extensionHost.subscribe(E.LAST,()=>{this.fire(E.LAST),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(E.LEFT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.getPrevPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(E.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.isDesktopMetric()&&this.shell.$rightPanel.show()}),this.extensionHost.subscribe(E.LEFTPANEL_COLLAPSE_FULL_FINISH,()=>{this.shell.$centerPanel.show(),this.resize()}),this.extensionHost.subscribe(E.LEFTPANEL_EXPAND_FULL_START,()=>{this.shell.$centerPanel.hide(),this.shell.$rightPanel.hide()}),this.extensionHost.subscribe(E.MINUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(I.MODE_CHANGE,e=>{this.fire(I.MODE_CHANGE,e),this.mode=new Re(e);let i=this.getSettings();this.extensionHost.publish(E.SETTINGS_CHANGE,i)}),this.extensionHost.subscribe(E.MULTISELECTION_MADE,e=>{let i=new St;i.manifestUri=this.helper.manifestUri,i.allCanvases=e.length===this.helper.getCanvases().length,i.canvases=e,i.format=this.data.config.options.multiSelectionMimeType,i.sequence=this.helper.getCurrentSequence().id,this.fire(E.MULTISELECTION_MADE,i)}),this.extensionHost.subscribe(E.NEXT,()=>{this.fire(E.NEXT),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(I.NEXT_SEARCH_RESULT,()=>{this.fire(I.NEXT_SEARCH_RESULT)}),this.extensionHost.subscribe(I.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(I.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.nextSearchResult()}),this.extensionHost.subscribe(I.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(I.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.prevSearchResult()}),this.extensionHost.subscribe(E.OPEN_THUMBS_VIEW,()=>{this.fire(E.OPEN_THUMBS_VIEW)}),this.extensionHost.subscribe(E.OPEN_TREE_VIEW,()=>{this.fire(E.OPEN_TREE_VIEW)}),this.extensionHost.subscribe(E.PAGE_DOWN,()=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(I.PAGE_SEARCH,e=>{this.fire(I.PAGE_SEARCH,e),this.viewLabel(e)}),this.extensionHost.subscribe(E.PAGE_UP,()=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(I.PAGING_TOGGLED,e=>{this.fire(I.PAGING_TOGGLED,e)}),this.extensionHost.subscribe(E.PLUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(E.PREV,()=>{this.fire(E.PREV),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(I.PREV_SEARCH_RESULT,()=>{this.fire(I.PREV_SEARCH_RESULT)}),this.extensionHost.subscribe(I.PRINT,()=>{this.print()}),this.extensionHost.subscribe($e.RELOAD,()=>{this.extensionHost.publish(E.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(E.RIGHT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.getNextPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(I.OPENSEADRAGON_ANIMATION,()=>{this.fire(I.OPENSEADRAGON_ANIMATION)}),this.extensionHost.subscribe(I.OPENSEADRAGON_ROTATION,e=>{this.fire(I.OPENSEADRAGON_ROTATION,e)}),this.extensionHost.subscribe(I.OPENSEADRAGON_ANIMATION_FINISH,e=>{let i=this.centerPanel.getViewportBounds(),n=this.helper.getCurrentCanvas();this.centerPanel&&i&&n&&(this.extensionHost.publish(I.XYWH_CHANGE,i.toString()),this.data.target=n.id+"#xywh="+i.toString(),this.fire(E.TARGET_CHANGE,this.data.target)),this.fire(I.CURRENT_VIEW_URI,{cropUri:this.getCroppedImageUri(n,this.getViewer()),fullUri:this.getConfinedImageUri(n,n.getWidth())})}),this.extensionHost.subscribe(I.OPENSEADRAGON_ANIMATION_START,()=>{this.fire(I.OPENSEADRAGON_ANIMATION_START)}),this.extensionHost.subscribe(I.OPENSEADRAGON_OPEN,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus(),this.fire(I.OPENSEADRAGON_OPEN)}),this.extensionHost.subscribe(I.OPENSEADRAGON_RESIZE,()=>{this.fire(I.OPENSEADRAGON_RESIZE)}),this.extensionHost.subscribe(I.OPENSEADRAGON_ROTATION,e=>{this.data.rotation=e,this.fire(I.OPENSEADRAGON_ROTATION,this.data.rotation),this.currentRotation=e}),this.extensionHost.subscribe(I.SEARCH,e=>{this.fire(I.SEARCH,e),this.search(e)}),this.extensionHost.subscribe(I.SEARCH_PREVIEW_FINISH,()=>{this.fire(I.SEARCH_PREVIEW_FINISH)}),this.extensionHost.subscribe(I.SEARCH_PREVIEW_START,()=>{this.fire(I.SEARCH_PREVIEW_START)}),this.extensionHost.subscribe(E.ANNOTATIONS,e=>{this.fire(E.ANNOTATIONS,e)}),this.extensionHost.subscribe(E.ANNOTATION_CANVAS_CHANGE,e=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,e[0].canvasIndex)}),this.extensionHost.subscribe(E.ANNOTATIONS_EMPTY,()=>{this.fire(E.ANNOTATIONS_EMPTY)}),this.extensionHost.subscribe(E.THUMB_SELECTED,e=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,e.index)}),this.extensionHost.subscribe(E.TREE_NODE_SELECTED,e=>{this.fire(E.TREE_NODE_SELECTED,e.data.path),this.treeNodeSelected(e)}),this.extensionHost.subscribe(E.UP_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(E.UPDATE_SETTINGS,()=>{this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.helper.canvasIndex);let e=this.getSettings();this.extensionHost.publish(E.SETTINGS_CHANGE,e)}),this.extensionHost.subscribe(E.SHOW_DOWNLOAD_DIALOGUE,e=>{this.store.getState().openDownloadDialogue(e[0])}),this.extensionHost.subscribe(E.HIDE_DOWNLOAD_DIALOGUE,()=>{this.store.getState().closeDialogue()}),this.extensionHost.subscribe(E.CLOSE_ACTIVE_DIALOGUE,()=>{this.store.getState().closeDialogue()}),this.extensionHost.subscribe(E.ESCAPE,()=>{this.store.getState().closeDialogue()})}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new Rt(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new Wt(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new Pt(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new jt(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new bt(this.shell.$footerPanel),this.mobileFooterPanel=new yt(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new Xt(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new Jt(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new Et(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new It(this.$shareDialogue),this.$downloadDialogue=$("<div></div>"),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogueRoot=(0,oi.createRoot)(this.$downloadDialogue[0]),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new _t(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new wt(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()}render(){super.render(),this.checkForTarget(),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()}renderDownloadDialogue(){let e=this.isPagingSettingEnabled(),{downloadDialogueOpen:i,dialogueTriggerButton:n}=this.store.getState();i?this.extensionHost.publish(E.SHOW_OVERLAY):this.extensionHost.publish(E.HIDE_OVERLAY);let s=this.getPagedIndices(),o=this.helper.getCanvases().filter((c,p)=>s.includes(p)),a=Lt(this.data.config.modules.dialogue,this.data.config.modules.downloadDialogue),r=this.helper.manifest.getService(ye.ServiceProfile.DOWNLOAD_EXTENSIONS),d=a.options.selectionEnabled&&r?.__jsonld.selectionEnabled;this.downloadDialogueRoot.render((0,ri.createElement)(Yt,{canvases:o,confinedImageSize:a.options.confinedImageSize,content:a.content,downloadCurrentViewEnabled:a.options.downloadCurrentViewEnabled,downloadWholeImageHighResEnabled:a.options.downloadWholeImageHighResEnabled,downloadWholeImageLowResEnabled:a.options.downloadWholeImageLowResEnabled,locale:this.getLocale(),manifest:this.helper.manifest,maxImageWidth:a.options.maxImageWidth,mediaDownloadEnabled:this.helper.isUIEnabled("mediaDownload"),open:i,paged:e,parent:this.shell.$overlays[0],requiredStatement:this.helper.getRequiredStatement()?.value,resources:this.resources,rotation:this.getViewerRotation(),selectionEnabled:d,sequence:this.helper.getCurrentSequence(),termsOfUseEnabled:this.data.config.options.termsOfUseEnabled,triggerButton:n,getCroppedImageDimensions:c=>this.getCroppedImageDimensions(c,this.getViewer()),getConfinedImageDimensions:c=>this.getConfinedImageDimensions(c,a.options.confinedImageSize),getConfinedImageUri:c=>this.getConfinedImageUri(c,a.options.confinedImageSize),onClose:()=>{this.store.getState().closeDialogue()},onDownloadCurrentView:c=>{let p=this.getViewer();window.open(this.getCroppedImageUri(c,p))},onDownloadSelection:()=>{this.store.getState().closeDialogue(),this.extensionHost.publish(E.SHOW_MULTISELECT_DIALOGUE)},onShowTermsOfUse:()=>{this.store.getState().closeDialogue(),this.extensionHost.publish(E.SHOW_TERMS_OF_USE)}}))}checkForTarget(){if(this.data.target){let e=this.data.target.split("#"),i=e[0],n=this.helper.getCanvasIndexById(i);n!==null&&this.helper.canvasIndex!==n&&this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,n);let s=e[1];this.extensionHost.publish(E.SET_TARGET,Ie.fromString(s))}}checkForAnnotations(){if(this.data.annotations){let e=[],i=this.data.annotations;Array.isArray(i)?e=this.groupWebAnnotationsByTarget(this.data.annotations):i.resources.length&&(e=this.groupOpenAnnotationsByTarget(this.data.annotations),this.extensionHost.publish(E.CLEAR_ANNOTATIONS)),this.annotate(e)}}annotate(e,i){this.annotations=e,this.annotations=e.sort((s,o)=>s.canvasIndex-o.canvasIndex);let n=new Kt;n.terms=i,n.annotations=this.annotations,this.extensionHost.publish(E.ANNOTATIONS,n)}groupWebAnnotationsByTarget(e){let i=[];for(let n=0;n<e.length;n++){let s=e[n],o=s.target.match(/(.*)#/)[1],a=this.helper.getCanvasIndexById(o),r=new mt(o);r.canvasIndex=a;let d=i.filter(c=>c.canvasId===r.canvasId)[0];d?d.addRect(s):(r.addRect(s),i.push(r))}return i}groupOpenAnnotationsByTarget(e){let i=[];for(let n=0;n<e.resources.length;n++){let s=e.resources[n],o=s.on.match(/(.*)#/)[1],a=this.helper.getCanvasIndexById(o),r=new mt(o);r.canvasIndex=a;let d=i.filter(c=>c.canvasId===r.canvasId)[0];d?d.addRect(s):(r.addRect(s),i.push(r))}return i.sort((n,s)=>n.canvasIndex-s.canvasIndex),i}checkForSearchParam(){let e=this.data.highlight;e&&(e.replace(/\+/g," ").replace(/"/g,""),this.extensionHost.publish(I.SEARCH,e))}checkForRotationParam(){let e=this.data.rotation;e&&this.extensionHost.publish(E.SET_ROTATION,e)}changeCanvas(e){if(e===-1)return;let i=!1;if(e===this.helper.canvasIndex&&(i=!0),this.helper.isCanvasIndexOutOfRange(e)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),e=0),this.isPagingSettingEnabled()&&!i&&this.getPagedIndices(e).includes(this.helper.canvasIndex)){this.viewCanvas(e);return}this.viewCanvas(e)}getViewer(){return this.centerPanel.viewer}getMode(){if(this.mode)return this.mode;switch(this.helper.getManifestType()){case Pe.ManifestType.MONOGRAPH:return Re.page;case Pe.ManifestType.MANUSCRIPT:return Re.page;default:return Re.image}}getViewportBounds(){if(!this.centerPanel)return null;let e=this.centerPanel.getViewportBounds();return e?e.toString():null}getViewerRotation(){return this.centerPanel?this.currentRotation:null}viewRange(e){let i=this.helper.getRangeByPath(e);if(!i)return;let n=i.getCanvasIds()[0],s=this.helper.getCanvasIndexById(n);this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,s),this.extensionHost.publish(E.RANGE_CHANGE,i)}viewLabel(e){if(!e){this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE_FAILED);return}let i=this.helper.getCanvasIndexByLabel(e);i!=-1?this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,i):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE_FAILED))}treeNodeSelected(e){let i=e.data;if(!!i.type)switch(i.type){case ye.IIIFResourceType.MANIFEST:this.viewManifest(i);break;case ye.IIIFResourceType.COLLECTION:this.viewCollection(i);break;default:this.viewRange(i.path);break}}clearAnnotations(){this.annotations=[],this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.helper.canvasIndex)}prevSearchResult(){let e;if(!!this.annotations)for(let i=this.annotations.length-1;i>=0;i--){let n=this.annotations[i];if(n.canvasIndex<=this.getPrevPageIndex()){e=n,this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,e.canvasIndex);break}}}nextSearchResult(){if(!!this.annotations)for(let e=0;e<this.annotations.length;e++){let i=this.annotations[e];if(i&&i.canvasIndex>=this.getNextPageIndex()){this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,i.canvasIndex);break}}}bookmark(){super.bookmark();let e=this.helper.getCurrentCanvas(),i=new Qt;i.index=this.helper.canvasIndex,i.label=Pe.LanguageMap.getValue(e.getLabel()),i.path=this.getCroppedImageUri(e,this.getViewer()),i.thumb=e.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),i.title=this.helper.getLabel(),i.trackingLabel=window.trackingLabel,i.type=ye.ExternalResourceType.IMAGE,this.fire(E.BOOKMARK,i)}print(){window.print(),this.fire(I.PRINT)}getCroppedImageDimensions(e,i){if(!i||!i.viewport)return null;let n,s;if(e.getWidth()?n=e.getWidth():n=e.externalResource.width,e.getHeight()?s=e.getHeight():s=e.externalResource.height,!n||!s)return null;let o=i.viewport.getBounds(!0),a=new vt,r=Math.floor(o.width),d=Math.floor(o.height),c=Math.floor(o.x),p=Math.floor(o.y);c+r>n?r=n-c:c<0&&(r=r+c),c<0&&(c=0),p+d>s?d=s-p:p<0&&(d=d+p),p<0&&(p=0),r=Math.min(r,n),d=Math.min(d,s);let w=r,y=d,R=e.getMaxDimensions();if(R){if(r>R.width){let b=R.width;d=Math.round(b*(d/r)),r=b}if(d>R.height){let b=R.height;r=Math.round(r/d*b),d=b}}return a.region=new Pe.Size(w,y),a.regionPos=new et(c,p),a.size=new Pe.Size(r,d),a}getCroppedImageUri(e,i){if(!i||!i.viewport)return null;let n=this.getCroppedImageDimensions(e,i);if(!n)return null;let s=this.getImageBaseUri(e),o=this.getImageId(e);if(!o)return null;let a=n.regionPos.x+","+n.regionPos.y+","+n.region.width+","+n.region.height,r=n.size.width+","+n.size.height,d=this.getViewerRotation();return`${s}/${o}/${a}/${r}/${d}/default.jpg`}getConfinedImageDimensions(e,i){let n=e.getWidth(),s=e.getHeight();n||(n=e.externalResource.width),s||(s=e.externalResource.height);let o=new Pe.Size(0,0);if(n>s){o.width=i;let a=Ye.normalise(i,0,n);o.height=Math.floor(s*a)}else{o.height=i;let a=Ye.normalise(i,0,s);o.width=Math.floor(n*a)}return o}getConfinedImageUri(e,i){let n=this.getImageBaseUri(e),s=this.getImageId(e);if(!s)return null;let o="full",a=this.getConfinedImageDimensions(e,i),r=a.width+","+a.height,d=this.getViewerRotation();return`${n}/${s}/${o}/${r}/${d}/default.jpg`}getImageId(e){if(e.externalResource){let i=e.externalResource.data["@id"];if(i)return i.substr(i.lastIndexOf("/")+1)}return null}getImageBaseUri(e){let i=this.getInfoUri(e);return i=i.substr(0,i.lastIndexOf("/")),i.substr(0,i.lastIndexOf("/"))}getInfoUri(e){let i=null,n=e.getImages();if(n&&n.length){let a=n[0].getResource().getServices();for(let r=0;r<a.length;r++){let d=a[r],c=d.id;c.endsWith("/")||(c+="/"),Pe.Utils.isImageProfile(d.getProfile())&&(i=c+"info.json")}}else{n=e.getContent();let o=n[0].getBody();if(o.length){let a=o[0].getServices();for(let r=0;r<a.length;r++){let d=a[r],c=d.id;c.endsWith("/")||(c+="/"),Pe.Utils.isImageProfile(d.getProfile())&&(i=c+"info.json")}}}return i||(i="lib/imageunavailable.json"),i}getEmbedScript(e,i,n,s,o){let a=this.data.config.uri||"",r=this.getSerializedLocales(),c=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}&config=${a}&locales=${r}&xywh=${s}&r=${o}`;return ge.format(e,c,i.toString(),n.toString())}isSearchEnabled(){return!(!he.getBool(this.data.config.options.searchWithinEnabled,!1)||!this.helper.getSearchService())}isPagingSettingEnabled(){return this.helper.isPagingAvailable()?this.getSettings().pagingEnabled:!1}getAutoCompleteService(){let e=this.helper.getSearchService();return e?e.getService(ye.ServiceProfile.SEARCH_0_AUTO_COMPLETE)||e.getService(ye.ServiceProfile.SEARCH_1_AUTO_COMPLETE):null}getAutoCompleteUri(){let e=this.getAutoCompleteService();return e?e.id+"?q={0}":null}getSearchServiceUri(){let e=this.helper.getSearchService();if(!e)return null;let i=e.id;return i=i+"?q={0}",i}search(e){if(this.isAnnotating)return;this.isAnnotating=!0,this.annotations=[];let i=this,n=this.getSearchServiceUri();!n||(n=ge.format(n,encodeURIComponent(e)),this.getSearchResults(n,e,this.annotations,s=>{i.isAnnotating=!1,s.length?i.annotate(s,e):i.showMessage(i.data.config.modules.genericDialogue.content.noMatches,()=>{this.extensionHost.publish(E.ANNOTATIONS_EMPTY)})}))}getSearchResults(e,i,n,s){fetch(e).then(o=>o.json()).then(o=>{o.resources&&o.resources.length&&(n=n.concat(this.groupOpenAnnotationsByTarget(o))),o.next?this.getSearchResults(o.next,i,n,s):s(n)})}getAnnotationRects(){return this.annotations.length?this.annotations.map(e=>e.rects).reduce((e,i)=>e.concat(i)):[]}getCurrentAnnotationRectIndex(){let e=this.getAnnotationRects();return this.currentAnnotationRect?e.indexOf(this.currentAnnotationRect):-1}getTotalAnnotationRects(){return this.getAnnotationRects().length}isFirstAnnotationRect(){return this.getCurrentAnnotationRectIndex()===0}getLastAnnotationRectIndex(){return this.getTotalAnnotationRects()-1}getPrevPageIndex(e=this.helper.canvasIndex){let i;if(this.isPagingSettingEnabled()){let n=this.getPagedIndices(e);this.helper.isRightToLeft()?i=n[n.length-1]-1:i=n[0]-1}else i=e-1;return i}getNextPageIndex(e=this.helper.canvasIndex){let i;if(this.isPagingSettingEnabled()){let n=this.getPagedIndices(e);this.helper.isRightToLeft()?i=n[0]+1:i=n[n.length-1]+1}else i=e+1;return i>this.helper.getTotalCanvases()-1?-1:i}getPagedIndices(e=this.helper.canvasIndex){let n=this.helper.manifest.getSequences()[0],s=n.getCanvases(),o=!!this.getSettings().pagingEnabled&&this.helper.isPaged(),a=this.helper.getViewingDirection(),r=[];if(n.getViewingHint()===ye.ViewingHint.CONTINUOUS)r=s.map((d,c)=>c);else if(!o)r.push(e);else{if(e===0||e===s.length&&s.length%2==0)r=[e];else if(e%2==0){let d=s[e],c=s[e-1];d?.getViewingHint()!==ye.ViewingHint.NON_PAGED&&c?.getViewingHint()!==ye.ViewingHint.NON_PAGED?c?r=[e-1,e]:r=[e]:r=[e]}else{let d=s[e],c=s[e+1];d?.getViewingHint()!==ye.ViewingHint.NON_PAGED&&c?.getViewingHint()!==ye.ViewingHint.NON_PAGED?c?r=[e,e+1]:r=[e]:r=[e]}a===ye.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}return r}};export{ai as default};
/*! @openseadragon-imaging/openseadragon-viewerinputhook 2.2.1 ab9b394 (clean)  @license MIT */
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! License: http://openseadragon.github.io/license/
//! http://openseadragon.github.io
//! openseadragon 2.4.2
