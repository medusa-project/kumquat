import{a as Jt,c as Rt,e as Mt,f as wt,g as Pt}from"./chunk-UYLDA6E6.js";import{a as Ot,b as R,d as X,g as St,j as gt,k as At,l as G,m as ut,n as Lt,o as V,p as b}from"./chunk-2YE6NNA6.js";import{a as H}from"./chunk-T6TTLDCO.js";import{b as j,e as U,g as w}from"./chunk-MP7EINQY.js";import{b as Qt,c as it}from"./chunk-YAXTLTJC.js";var jt=Qt((lt,yt)=>{(function(s,i){typeof lt=="object"&&typeof yt=="object"?yt.exports=i():typeof define=="function"&&define.amd?define("IIIFMetadataComponent",[],i):typeof lt=="object"?lt.IIIFMetadataComponent=i():s.IIIFMetadataComponent=i()})(typeof self!="undefined"?self:lt,function(){return function(s){var i={};function l(c){if(i[c])return i[c].exports;var u=i[c]={i:c,l:!1,exports:{}};return s[c].call(u.exports,u,u.exports,l),u.l=!0,u.exports}return l.m=s,l.c=i,l.d=function(c,u,g){l.o(c,u)||Object.defineProperty(c,u,{enumerable:!0,get:g})},l.r=function(c){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},l.t=function(c,u){if(1&u&&(c=l(c)),8&u||4&u&&typeof c=="object"&&c&&c.__esModule)return c;var g=Object.create(null);if(l.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:c}),2&u&&typeof c!="string")for(var o in c)l.d(g,o,function(v){return c[v]}.bind(null,o));return g},l.n=function(c){var u=c&&c.__esModule?function(){return c.default}:function(){return c};return l.d(u,"a",u),u},l.o=function(c,u){return Object.prototype.hasOwnProperty.call(c,u)},l.p="",l(l.s=0)}([function(s,i,l){s.exports=l(1)},function(s,i,l){"use strict";var c,u=this&&this.__extends||(c=function(h,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}c(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(i,"__esModule",{value:!0});var g,o=l(2),v=l(3),m=l(4);(function(h){h.LINES="lines",h.CHARS="chars"})(g=i.LimitType||(i.LimitType={}));var a=function(h){function e(t){var n=h.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return u(e,h),e.prototype._init=function(){return h.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},e.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:g.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(t){return t},showAllLanguages:!1}},e.prototype._getManifestGroup=function(){return this._metadataGroups.filter(function(t){return t.resource.isManifest()})[0]},e.prototype._getCanvasGroups=function(){return this._metadataGroups.filter(function(t){return t.resource.isCanvas()})},e.prototype.set=function(t){var n=this;if(this._data=Object.assign(this._data,t),this._data&&this._data.helper){var r,d={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(d),this._data.manifestDisplayOrder&&((r=this._getManifestGroup()).items=this._sortItems(r.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach(function(x,y){x.items=n._sortItems(x.items,n._readCSV(n._data.canvasDisplayOrder))}),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((r=this._getManifestGroup()).items=this._exclude(r.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach(function(x,y){x.items=n._exclude(x.items,n._readCSV(n._data.canvasExclude))}),this._data.limitToRange){var E=[];this._metadataGroups.forEach(function(x,y){x.resource.isRange()&&E.push(x)}),E.length&&(this._metadataGroups=E)}this._render()}},e.prototype._sortItems=function(t,n){var r=this,d=[],E=t.slice(0);return n.forEach(function(x,y){var A=E.filter(function(T){return r._normalise(T.getLabel())===x})[0];if(A){d.push(A);var O=E.indexOf(A);O>-1&&E.splice(O,1)}}),E.forEach(function(x,y){d.push(x)}),d},e.prototype._sortGroups=function(t,n){var r=[],d=t.slice(0);return n.forEach(function(E,x){var y=d.filter(function(O){return O.resource.getIIIFResourceType().toLowerCase()==E.toLowerCase()})[0];if(y){r.push(y);var A=d.indexOf(y);A>-1&&d.splice(A,1)}}),r},e.prototype._label=function(t,n){t.forEach(function(r,d){r.label=n[d]})},e.prototype._exclude=function(t,n){var r=this;return n.forEach(function(d,E){var x=t.filter(function(A){return r._normalise(A.getLabel())===d})[0];if(x){var y=t.indexOf(x);y>-1&&t.splice(y,1)}}),t},e.prototype._normalise=function(t){return t?t.toLowerCase().replace(/ /g,""):null},e.prototype._render=function(){var t=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach(function(n,r){var d=t._buildMetadataGroup(n);t._$metadataGroups.append(d);var E=d.find(".value");t._data.limit&&t._data.content&&(t._data.limitType===g.LINES?E.toggleExpandTextByLines(t._data.limit,t._data.content.less,t._data.content.more,function(){}):t._data.limitType===g.CHARS&&E.ellipsisHtmlFixed(t._data.limit,function(){}))})):this._$noData.show()},e.prototype._buildMetadataGroup=function(t){var n=this._$metadataGroupTemplate.clone(),r=n.find(">.header");if(this._data.content){if(t.resource.isManifest()&&this._data.content.manifestHeader)(E=this._sanitize(this._data.content.manifestHeader))&&r.html(E);else if(t.resource.isSequence()&&this._data.content.sequenceHeader)(E=this._sanitize(this._data.content.sequenceHeader))&&r.html(E);else if(t.resource.isRange()&&this._data.content.rangeHeader)(E=this._sanitize(this._data.content.rangeHeader))&&r.html(E);else if(t.resource.isCanvas()&&(t.label||this._data.content.canvasHeader)){var d=t.label||this._data.content.canvasHeader;r.html(this._sanitize(d))}else if(t.resource.isAnnotation()&&this._data.content.imageHeader){var E;(E=this._sanitize(this._data.content.imageHeader))&&r.html(E)}}r.text()||r.hide();for(var x=n.find(".items"),y=0;y<t.items.length;y++){var A=t.items[y],O=this._buildMetadataItem(A);x.append(O)}return n},e.prototype._buildMetadataItem=function(t){var n,r=this._$metadataItemTemplate.clone(),d=r.find(".label"),E=r.find(".values"),x=t.getLabel(),y=x,A=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&y&&t.isRootLevel)switch(y.toLowerCase()){case"attribution":y=this._data.content.attribution;break;case"description":y=this._data.content.description;break;case"license":y=this._data.content.license;break;case"logo":y=this._data.content.logo}if(y=this._sanitize(y),d.html(y),this._addReadingDirection(d,this._getLabelLocale(t)),r.addClass(m.Strings.toCssClass(y)),x&&x.toLowerCase()==="license"&&A.exec(t.value[0].value)!==null)n=this._buildMetadataItemURIValue(t.value[0].value),E.append(n);else if(this._data.showAllLanguages&&t.value&&t.value.length>1)for(var O=0;O<t.value.length;O++){var T=t.value[O];n=this._buildMetadataItemValue(T.value,T.locale),E.append(n)}else{var I=this._getValueLocale(t),f=!1;for(O=0;O<t.value.length;O++){var T=t.value[O];I.toLowerCase()===T.locale.toLowerCase()&&(f=!0,n=this._buildMetadataItemValue(T.value,T.locale),E.append(n))}f||(T=t.value[0])&&(n=this._buildMetadataItemValue(T.value,T.locale),E.append(n))}this._data.copyToClipboardEnabled&&m.Clipboard.supportsCopy()&&d.text()&&this._addCopyButton(r,d,E);var _=this;return r.on("click","a.iiif-viewer-link",function(C){C.preventDefault();var S=$(C.target),L=S.attr("data-uv-navigate")||S.prop("href");_.fire(p.IIIF_VIEWER_LINK_CLICKED,L)}),r.on("click","[data-uv-navigate]",function(C){C.preventDefault();var S=$(C.target).attr("data-uv-navigate")||null;S&&_.fire(p.IIIF_VIEWER_LINK_CLICKED,S)}),r},e.prototype._getLabelLocale=function(t){if(!this._data||!this._data.helper)return"";var n=this._data.helper.options.locale;if(t.label.length){var r=t.label[0].locale;if(r.toLowerCase()!==n.toLowerCase())return r}return n},e.prototype._getValueLocale=function(t){return this._data&&this._data.helper?this._data.helper.options.locale:""},e.prototype._buildMetadataItemValue=function(t,n){t=(t=this._sanitize(t)).replace(`
`,"<br>");var r=this._$metadataItemValueTemplate.clone();return r.html(t),r.find("a").each(function(){var d=$(this);d.hasClass("iiif-viewer-link")||d.prop("target","_blank")}),n&&this._addReadingDirection(r,n),r},e.prototype._buildMetadataItemURIValue=function(t){t=this._sanitize(t);var n=this._$metadataItemURIValueTemplate.clone();return n.prop("href",t),n.text(t),n},e.prototype._addReadingDirection=function(t,n){n=o.Utils.getInexactLocale(n),this._readCSV(this._data.rtlLanguageCodes).filter(function(r){return r===n}).length>0&&(t.prop("dir","rtl"),t.addClass("rtl"))},e.prototype._addCopyButton=function(t,n,r){var d=this._$copyTextTemplate.clone(),E=d.children();n.append(d),m.Device.isTouch()?d.show():(t.on("mouseenter",function(){d.show()}),t.on("mouseleave",function(){d.hide()}),d.on("mouseleave",function(){E.hide()}));var x=this,y=r.text();d.on("click",function(A){x._copyItemValues(d,y)})},e.prototype._copyItemValues=function(t,n){m.Clipboard.copy(n);var r=t.find(".copiedText");r.show(),setTimeout(function(){r.hide()},this._data.copiedMessageDuration)},e.prototype._readCSV=function(t,n){n===void 0&&(n=!0);var r=[];if(t&&(r=t.split(","),n))for(var d=0;d<r.length;d++)r[d]=this._normalise(r[d]);return r},e.prototype._sanitize=function(t){return this._data.sanitizer?this._data.sanitizer(t):null},e.prototype._resize=function(){},e}(v.BaseComponent);i.MetadataComponent=a;var p=function(){function h(){}return h.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",h}();i.Events=p},function(s,i,l){s.exports=function(c){var u={};function g(o){if(u[o])return u[o].exports;var v=u[o]={i:o,l:!1,exports:{}};return c[o].call(v.exports,v,v.exports,g),v.l=!0,v.exports}return g.m=c,g.c=u,g.d=function(o,v,m){g.o(o,v)||Object.defineProperty(o,v,{enumerable:!0,get:m})},g.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},g.t=function(o,v){if(1&v&&(o=g(o)),8&v||4&v&&typeof o=="object"&&o&&o.__esModule)return o;var m=Object.create(null);if(g.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:o}),2&v&&typeof o!="string")for(var a in o)g.d(m,a,function(p){return o[p]}.bind(null,a));return m},g.n=function(o){var v=o&&o.__esModule?function(){return o.default}:function(){return o};return g.d(v,"a",v),v},g.o=function(o,v){return Object.prototype.hasOwnProperty.call(o,v)},g.p="",g(g.s=4)}([function(c,u,g){"use strict";function o(v){for(var m in v)u.hasOwnProperty(m)||(u[m]=v[m])}Object.defineProperty(u,"__esModule",{value:!0}),o(g(6)),o(g(7)),o(g(8)),o(g(9)),o(g(10)),o(g(11)),o(g(12)),o(g(13)),o(g(14)),o(g(15)),o(g(16)),o(g(17)),o(g(18)),o(g(19)),o(g(20)),o(g(21)),o(g(22)),o(g(23)),o(g(24)),o(g(25)),o(g(26)),o(g(27)),o(g(28)),o(g(29)),o(g(30)),o(g(31)),o(g(32)),o(g(2))},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(o){o.BOOKMARKING="oa:bookmarking",o.CLASSIFYING="oa:classifying",o.COMMENTING="oa:commenting",o.DESCRIBING="oa:describing",o.EDITING="oa:editing",o.HIGHLIGHTING="oa:highlighting",o.IDENTIFYING="oa:identifying",o.LINKING="oa:linking",o.MODERATING="oa:moderating",o.PAINTING="sc:painting",o.QUESTIONING="oa:questioning",o.REPLYING="oa:replying",o.TAGGING="oa:tagging",o.TRANSCRIBING="oad:transcribing"}(u.AnnotationMotivation||(u.AnnotationMotivation={})),function(o){o.AUTO_ADVANCE="auto-advance",o.CONTINUOUS="continuous",o.FACING_PAGES="facing-pages",o.HIDDEN="hidden",o.INDIVIDUALS="individuals",o.MULTI_PART="multi-part",o.NO_NAV="no-nav",o.NON_PAGED="non-paged",o.PAGED="paged",o.REPEAT="repeat",o.SEQUENCE="sequence",o.THUMBNAIL_NAV="thumbnail-nav",o.TOGETHER="together",o.UNORDERED="unordered"}(u.Behavior||(u.Behavior={})),function(o){o.CANVAS="canvas",o.CHOICE="choice",o.CONTENT_AS_TEXT="contentastext",o.DOCUMENT="document",o.IMAGE="image",o.MOVING_IMAGE="movingimage",o.PDF="pdf",o.PHYSICAL_OBJECT="physicalobject",o.SOUND="sound",o.TEXTUALBODY="textualbody",o.VIDEO="video"}(u.ExternalResourceType||(u.ExternalResourceType={})),function(o){o.ANNOTATION="annotation",o.CANVAS="canvas",o.COLLECTION="collection",o.MANIFEST="manifest",o.RANGE="range",o.SEQUENCE="sequence"}(u.IIIFResourceType||(u.IIIFResourceType={})),function(o){o.AUDIO_MP4="audio/mp4",o.CORTO="application/corto",o.DRACO="application/draco",o.GLTF="model/gltf+json",o.JPG="image/jpeg",o.M3U8="application/vnd.apple.mpegurl",o.MP3="audio/mp3",o.MPEG_DASH="application/dash+xml",o.OBJ="text/plain",o.PDF="application/pdf",o.PLY="application/ply",o.THREEJS="application/vnd.threejs+json",o.VIDEO_MP4="video/mp4",o.WEBM="video/webm"}(u.MediaType||(u.MediaType={})),function(o){o.DOC="application/msword",o.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",o.PDF="application/pdf"}(u.RenderingFormat||(u.RenderingFormat={})),function(o){o.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",o.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",o.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",o.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",o.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",o.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",o.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",o.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",o.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",o.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",o.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",o.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",o.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",o.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",o.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",o.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",o.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",o.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",o.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",o.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",o.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",o.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",o.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",o.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",o.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",o.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",o.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",o.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",o.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",o.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",o.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",o.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",o.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",o.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",o.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",o.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",o.SEARCH_0="http://iiif.io/api/search/0/search",o.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",o.SEARCH_1="http://iiif.io/api/search/1/search",o.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",o.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",o.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",o.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",o.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",o.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",o.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(u.ServiceProfile||(u.ServiceProfile={})),function(o){o.BOTTOM_TO_TOP="bottom-to-top",o.LEFT_TO_RIGHT="left-to-right",o.RIGHT_TO_LEFT="right-to-left",o.TOP_TO_BOTTOM="top-to-bottom"}(u.ViewingDirection||(u.ViewingDirection={})),function(o){o.CONTINUOUS="continuous",o.INDIVIDUALS="individuals",o.NON_PAGED="non-paged",o.PAGED="paged",o.TOP="top"}(u.ViewingHint||(u.ViewingHint={}))},function(c,u,g){"use strict";var o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(d,E){function x(O){try{A(r.next(O))}catch(T){E(T)}}function y(O){try{A(r.throw(O))}catch(T){E(T)}}function A(O){var T;O.done?d(O.value):(T=O.value,T instanceof n?T:new n(function(I){I(T)})).then(x,y)}A((r=r.apply(e,t||[])).next())})},v=this&&this.__generator||function(e,t){var n,r,d,E,x={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return E={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function y(A){return function(O){return function(T){if(n)throw new TypeError("Generator is already executing.");for(;x;)try{if(n=1,r&&(d=2&T[0]?r.return:T[0]?r.throw||((d=r.return)&&d.call(r),0):r.next)&&!(d=d.call(r,T[1])).done)return d;switch(r=0,d&&(T=[2&T[0],d.value]),T[0]){case 0:case 1:d=T;break;case 4:return x.label++,{value:T[1],done:!1};case 5:x.label++,r=T[1],T=[0];continue;case 7:T=x.ops.pop(),x.trys.pop();continue;default:if(!(d=(d=x.trys).length>0&&d[d.length-1])&&(T[0]===6||T[0]===2)){x=0;continue}if(T[0]===3&&(!d||T[1]>d[0]&&T[1]<d[3])){x.label=T[1];break}if(T[0]===6&&x.label<d[1]){x.label=d[1],d=T;break}if(d&&x.label<d[2]){x.label=d[2],x.ops.push(T);break}d[2]&&x.ops.pop(),x.trys.pop();continue}T=t.call(e,x)}catch(I){T=[6,I],r=0}finally{n=d=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([A,O])}}};Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=g(1),p=g(33);g(34);var h=function(){function e(){}return e.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(t){return t===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===a.ServiceProfile.IMAGE_1_LEVEL_1||t===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===a.ServiceProfile.IMAGE_1_LEVEL_2||t===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(t){return t.indexOf("-")!==-1?t.substr(0,t.indexOf("-")):t},e.getLocalisedValue=function(t,n){if(!Array.isArray(t))return t;for(var r=0;r<t.length;r++){var d=t[r];if(n===d["@language"])return d["@value"]}var E=n.substr(0,n.indexOf("-"));for(r=0;r<t.length;r++){var x=t[r];if(x["@language"]===E)return x["@value"]}return null},e.generateTreeNodeIds=function(t,n){var r;n===void 0&&(n=0),r=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=r;for(var d=0;d<t.nodes.length;d++){var E=t.nodes[d];e.generateTreeNodeIds(E,d)}},e.normaliseType=function(t){return(t=t.toLowerCase()).indexOf(":")!==-1?t.split(":")[1]:t},e.normaliseUrl=function(t){return(t=t.substr(t.indexOf("://"))).indexOf("#")!==-1&&(t=t.split("#")[0]),t},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(t,n){return m.Deserialiser.parse(t,n)},e.checkStatus=function(t){if(t.ok)return t;var n=new Error(t.statusText);return n.response=t,Promise.reject(n)},e.loadManifest=function(t){return new Promise(function(n){fetch(t).then(e.checkStatus).then(function(r){return r.json()}).then(function(r){n(r)})})},e.loadExternalResourcesAuth1=function(t,n,r,d,E,x,y,A){return new Promise(function(O,T){var I=t.map(function(f){return e.loadExternalResourceAuth1(f,n,r,d,E,x,y,A)});Promise.all(I).then(function(){O(t)}).catch(function(f){T(f)})})},e.loadExternalResourceAuth1=function(t,n,r,d,E,x,y,A){return o(this,void 0,void 0,function(){var O;return v(this,function(T){switch(T.label){case 0:return[4,d(t)];case 1:return(O=T.sent())?[4,t.getData(O)]:[3,6];case 2:return T.sent(),t.status!==p.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,r,E,x,y,A)];case 4:T.sent(),T.label=5;case 5:if(t.status===p.OK||t.status===p.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return T.sent(),t.status!==p.MOVED_TEMPORARILY&&t.status!==p.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,r,E,x,y,A)];case 8:T.sent(),T.label=9;case 9:if(t.status===p.OK||t.status===p.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,r,d,E,x,y){return o(this,void 0,void 0,function(){var A,O,T,I,f,_,C,S;return v(this,function(L){switch(L.label){case 0:return t.isAccessControlled()?((A=t.externalService)&&(A.options=t.options),(O=t.kioskService)&&(O.options=t.options),(T=t.clickThroughService)&&(T.options=t.options),(I=t.loginService)&&(I.options=t.options),t.isResponseHandled||t.status!==p.MOVED_TEMPORARILY?[3,2]:[4,x(t)]):[2,t];case 1:return L.sent(),[2,t];case 2:return f=null,_=null,(f=A)?(_=f,[4,e.attemptResourceWithToken(t,r,f)]):[3,4];case 3:return L.sent(),[2,t];case 4:return(f=O)?(_=f,(C=n(f))?[4,d(C)]:[3,7]):[3,7];case 5:return L.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 6:return L.sent(),[2,t];case 7:return(f=T)?(_=f,[4,E(t,f)]):[3,11];case 8:return(S=L.sent())?[4,d(S)]:[3,11];case 9:return L.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 10:return L.sent(),[2,t];case 11:return(f=I)?(_=f,[4,E(t,f)]):[3,15];case 12:return(S=L.sent())?[4,d(S)]:[3,15];case 13:return L.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 14:return L.sent(),[2,t];case 15:return _&&y(t,_),[2]}})})},e.attemptResourceWithToken=function(t,n,r){return o(this,void 0,void 0,function(){var d,E;return v(this,function(x){switch(x.label){case 0:return(d=r.getService(a.ServiceProfile.AUTH_1_TOKEN))?[4,n(t,d)]:[3,3];case 1:return(E=x.sent())&&E.accessToken?[4,t.getData(E)]:[3,3];case 2:return x.sent(),[2,t];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,r,d,E,x,y,A,O,T){return new Promise(function(I,f){var _=t.map(function(C){return e.loadExternalResourceAuth09(C,n,r,d,E,x,y,A,O,T)});Promise.all(_).then(function(){I(t)}).catch(function(C){f(C)})})},e.loadExternalResourceAuth09=function(t,n,r,d,E,x,y,A,O,T){return new Promise(function(I,f){T&&T.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(I(r(t)),I(d(t))):E(t).then(function(){x(t,!0).then(function(_){t.getData(_).then(function(){I(O(t))}).catch(function(C){f(e.createInternalServerError(C))})}).catch(function(_){f(e.createInternalServerError(_))})}).catch(function(_){f(e.createInternalServerError(_))}):I(t)}).catch(function(_){f(e.createInternalServerError(_))}):A(t,n).then(function(_){_?t.getData(_).then(function(){t.status===p.OK?I(O(t)):e.authorize(t,n,r,d,E,x,y,A).then(function(){I(O(t))}).catch(function(C){f(e.createAuthorizationFailedError())})}).catch(function(C){f(e.createAuthorizationFailedError())}):e.authorize(t,n,r,d,E,x,y,A).then(function(){I(O(t))}).catch(function(C){f(e.createAuthorizationFailedError())})}).catch(function(_){f(e.createAuthorizationFailedError())})})},e.createError=function(t,n){var r=new Error;return r.message=n,r.name=String(t),r},e.createAuthorizationFailedError=function(){return e.createError(m.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(m.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(m.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,r,d,E,x,y,A){return new Promise(function(O,T){t.getData().then(function(){t.isAccessControlled()?A(t,n).then(function(I){I?t.getData(I).then(function(){t.status===p.OK?O(t):e.showAuthInteraction(t,n,r,d,E,x,y,O,T)}).catch(function(f){T(e.createInternalServerError(f))}):x(t,!1).then(function(f){f?y(t,f,n).then(function(){t.getData(f).then(function(){t.status===p.OK?O(t):e.showAuthInteraction(t,n,r,d,E,x,y,O,T)}).catch(function(_){T(e.createInternalServerError(_))})}).catch(function(_){T(e.createInternalServerError(_))}):e.showAuthInteraction(t,n,r,d,E,x,y,O,T)})}).catch(function(I){T(e.createInternalServerError(I))}):O(t)})})},e.showAuthInteraction=function(t,n,r,d,E,x,y,A,O){t.status!==p.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?r(t).then(function(){x(t,!0).then(function(T){y(t,T,n).then(function(){t.getData(T).then(function(){A(t)}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(T){O(e.createInternalServerError(T))})}):E(t).then(function(){x(t,!0).then(function(T){y(t,T,n).then(function(){t.getData(T).then(function(){A(t)}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(T){O(e.createInternalServerError(T))})}):A(t)},e.getService=function(t,n){for(var r=this.getServices(t),d=0;d<r.length;d++){var E=r[d];if(E.getProfile()===n)return E}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,r){if(t.hasOwnProperty(n)&&t[n]===r)return t;for(var d=0;d<Object.keys(t).length;d++)if(typeof t[Object.keys(t)[d]]=="object"){var E=e.traverseAndFind(t[Object.keys(t)[d]],n,r);if(E!=null)return E}},e.getServices=function(t){var n,r=[];if(!(n=t.__jsonld?t.__jsonld.service:t.service))return r;Array.isArray(n)||(n=[n]);for(var d=0;d<n.length;d++){var E=n[d];if(typeof E=="string"){var x=this.getResourceById(t.options.resource,E);x&&r.push(new m.Service(x.__jsonld||x,t.options))}else r.push(new m.Service(E,t.options))}return r},e.getTemporalComponent=function(t){var n=/t=([^&]+)/g.exec(t),r=null;return n&&n[1]&&(r=n[1].split(",")),r},e}();u.Utils=h},function(c,u,g){"use strict";g.r(u),u.default=function(o,v){return v=v||{},new Promise(function(m,a){var p=new XMLHttpRequest,h=[],e=[],t={},n=function(){return{ok:(p.status/100|0)==2,statusText:p.statusText,status:p.status,url:p.responseURL,text:function(){return Promise.resolve(p.responseText)},json:function(){return Promise.resolve(JSON.parse(p.responseText))},blob:function(){return Promise.resolve(new Blob([p.response]))},clone:n,headers:{keys:function(){return h},entries:function(){return e},get:function(d){return t[d.toLowerCase()]},has:function(d){return d.toLowerCase()in t}}}};for(var r in p.open(v.method||"get",o,!0),p.onload=function(){p.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(d,E,x){h.push(E=E.toLowerCase()),e.push([E,x]),t[E]=t[E]?t[E]+","+x:x}),m(n())},p.onerror=a,p.withCredentials=v.credentials=="include",v.headers)p.setRequestHeader(r,v.headers[r]);p.send(v.body||null)})}},function(c,u,g){c.exports=g(5)},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(v){for(var m in v)u.hasOwnProperty(m)||(u[m]=v[m])}(g(0));var o=g(2);u.loadManifest=function(v){return o.Utils.loadManifest(v)},u.parseManifest=function(v,m){return o.Utils.parseManifest(v,m)}},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var o=function(){function v(m){this.__jsonld=m,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return v.prototype.getProperty=function(m){var a=null;return this.__jsonld&&((a=this.__jsonld[m])||(a=this.__jsonld["@"+m])),a},v}();u.JSONLDResource=o},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=g(1),p=function(h){function e(t,n){var r=h.call(this,t)||this;return r.options=n,r}return v(e,h),e.prototype.getIIIFResourceType=function(){return m.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){var t=this.getProperty("label");return t?m.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDefaultLabel=function(){return m.LanguageMap.getValue(this.getLabel())},e.prototype.getMetadata=function(){var t=this.getProperty("metadata"),n=[];if(!t)return n;for(var r=0;r<t.length;r++){var d=t[r],E=new m.LabelValuePair(this.options.locale);E.parse(d),n.push(E)}return n},e.prototype.getRendering=function(t){for(var n=this.getRenderings(),r=0;r<n.length;r++){var d=n[r];if(d.getFormat()===t)return d}return null},e.prototype.getRenderings=function(){var t,n=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++){var d=t[r];n.push(new m.Rendering(d,this.options))}return n},e.prototype.getService=function(t){return m.Utils.getService(this,t)},e.prototype.getServices=function(){return m.Utils.getServices(this)},e.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new m.Thumbnail(t,this.options):null},e.prototype.isAnnotation=function(){return this.getIIIFResourceType()===a.IIIFResourceType.ANNOTATION},e.prototype.isCanvas=function(){return this.getIIIFResourceType()===a.IIIFResourceType.CANVAS},e.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},e.prototype.isRange=function(){return this.getIIIFResourceType()===a.IIIFResourceType.RANGE},e.prototype.isSequence=function(){return this.getIIIFResourceType()===a.IIIFResourceType.SEQUENCE},e}(m.JSONLDResource);u.ManifestResource=p},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},h.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],r=new m.Annotation(n,this.options);e.push(r)}return e},h.prototype.getType=function(){var e=this.getProperty("type");return e?m.Utils.normaliseType(e):null},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},h.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},h}(m.ManifestResource);u.Resource=a},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=g(1),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;r.index=-1,r.isLoaded=!1;var d={defaultLabel:"-",locale:"en-GB",resource:r,pessimisticAccessControl:!1};return r.options=Object.assign(d,n),r}return v(e,h),e.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?m.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDescription=function(){var t=this.getProperty("description");return t?m.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getIIIFResourceType=function(){return m.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLogo=function(){var t=this.getProperty("logo");return t?typeof t=="string"?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getLicense=function(){return m.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},e.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},e.prototype.getRelated=function(){return this.getProperty("related")},e.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},e.prototype.getTrackingLabel=function(){var t=this.getService(a.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},e.prototype.getDefaultTree=function(){return this.defaultTree=new m.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},e.prototype.getRequiredStatement=function(){var t=null,n=this.getProperty("requiredStatement");if(n)(t=new m.LabelValuePair(this.options.locale)).parse(n);else{var r=this.getAttribution();r&&((t=new m.LabelValuePair(this.options.locale)).value=r)}return t},e.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},e.prototype.load=function(){var t=this;return new Promise(function(n){if(t.isLoaded)n(t);else{var r=t.options;r.navDate=t.getNavDate();var d=t.__jsonld.id;d||(d=t.__jsonld["@id"]),m.Utils.loadManifest(d).then(function(E){t.parentLabel=m.LanguageMap.getValue(t.getLabel(),r.locale);var x=m.Deserialiser.parse(E,r);(t=Object.assign(t,x)).index=r.index,n(t)})}})},e}(m.ManifestResource);u.IIIFResource=p},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((E=t[n]).items)for(var r=0;r<E.items.length;r++){var d=E.items[r];e.push(new m.AnnotationBody(d,this.options))}else e.push(new m.AnnotationBody(E,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var E=t.items[n];e.push(new m.AnnotationBody(E,this.options))}else e.push(new m.AnnotationBody(t,this.options));return e},h.prototype.getMotivation=function(){return this.getProperty("motivation")||null},h.prototype.getOn=function(){return this.getProperty("on")},h.prototype.getTarget=function(){return this.getProperty("target")},h.prototype.getResource=function(){return new m.Resource(this.getProperty("resource"),this.options)},h}(m.ManifestResource);u.Annotation=a},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getFormat=function(){var e=this.getProperty("format");return e?m.Utils.getMediaType(e):null},h.prototype.getType=function(){return this.getProperty("type")?m.Utils.normaliseType(this.getProperty("type")):null},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h}(m.ManifestResource);u.AnnotationBody=a},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(e,t,n){var r=p.call(this,t)||this;return r.label=e,r.options=n,r}return v(h,p),h.prototype.getIIIFResourceType=function(){return m.Utils.normaliseType(this.getProperty("type"))},h.prototype.getLabel=function(){return this.label},h.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new m.Annotation(t,e.options)})},h.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var r=e.__jsonld.id;r||(r=e.__jsonld["@id"]),m.Utils.loadManifest(r).then(function(d){e.__jsonld=d,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)}).catch(n)}})},h}(m.JSONLDResource);u.AnnotationList=a},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(a,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(a,p)},function(a,p){function h(){this.constructor=a}o(a,p),a.prototype=p===null?Object.create(p):(h.prototype=p.prototype,new h)});Object.defineProperty(u,"__esModule",{value:!0});var m=function(a){function p(h,e){return a.call(this,h,e)||this}return v(p,a),p.prototype.getItems=function(){return this.getProperty("items")},p}(g(0).ManifestResource);u.AnnotationPage=m},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getCanonicalImageUri=function(e){var t,n=null,r="default",d=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],d||(d=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(r="native");else{var E=this.getImages();if(E&&E.length){var x=E[0].getResource(),y=x.getServices();if(d||(d=x.getWidth()),y.length){var A=y[0];n=A.id,r=m.Utils.getImageQuality(A.getProfile())}else if(d===x.getWidth())return x.id}if(!n){var O=this.getProperty("thumbnail");if(O){if(typeof O=="string")return O;if(O["@id"])return O["@id"];if(O.length)return O[0].id}}}return t=d+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,r+".jpg"].join("/")},h.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(n){return n.maxWidth})[0])&&(t=new m.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},h.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new m.AnnotationPage(t[0],this.options)),!n)return e;for(var r=n.getItems(),d=0;d<r.length;d++){var E=r[d],x=new m.Annotation(E,this.options);e.push(x)}return e},h.prototype.getDuration=function(){return this.getProperty("duration")},h.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],r=new m.Annotation(n,this.options);e.push(r)}return e},h.prototype.getIndex=function(){return this.getProperty("index")},h.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(n){return n&&typeof(r=n["@type"])=="string"&&r.toLowerCase()==r.toLowerCase();var r}).map(function(n,r){return new m.AnnotationList(n.label||"Annotation list "+r,n,e.options)}).map(function(n){return n.load()});return Promise.all(t)},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h}(m.Resource);u.Canvas=a},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(1),a=g(0),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r.items=[],r._collections=null,r._manifests=null,t.__collection=r,r}return v(e,h),e.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(t){return t.isCollection()})},e.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(t){return t.isManifest()})},e.prototype.getCollectionByIndex=function(t){for(var n,r=this.getCollections(),d=0;d<r.length;d++){var E=r[d];E.index===t&&(n=E)}if(n)return n.options.index=t,n.load();throw new Error("Collection index not found")},e.prototype.getManifestByIndex=function(t){for(var n,r=this.getManifests(),d=0;d<r.length;d++){var E=r[d];E.index===t&&(n=E)}if(n)return n.options.index=t,n.load();throw new Error("Manifest index not found")},e.prototype.getTotalCollections=function(){return this.getCollections().length},e.prototype.getTotalManifests=function(){return this.getManifests().length},e.prototype.getTotalItems=function(){return this.items.length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):m.ViewingDirection.LEFT_TO_RIGHT},e.prototype.getDefaultTree=function(){return h.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var n=0;n<t.getManifests().length;n++){var r=t.getManifests()[n],d=r.getDefaultTree();d.label=r.parentLabel||a.LanguageMap.getValue(r.getLabel(),this.options.locale)||"manifest "+(n+1),d.navDate=r.getNavDate(),d.data.id=r.id,d.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),t.defaultTree.addNode(d)}},e.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var n=0;n<t.getCollections().length;n++){var r=t.getCollections()[n],d=r.getDefaultTree();d.label=r.parentLabel||a.LanguageMap.getValue(r.getLabel(),this.options.locale)||"collection "+(n+1),d.navDate=r.getNavDate(),d.data.id=r.id,d.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),t.defaultTree.addNode(d)}},e}(a.IIIFResource);u.Collection=p},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var o=function(){function v(m,a){this.start=m,this.end=a}return v.prototype.getLength=function(){return this.end-this.start},v}();u.Duration=o},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var o=g(0),v=function(){function m(a){this.defaultLocale=a}return m.prototype.parse=function(a){this.resource=a,this.label=o.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=o.LanguageMap.parse(this.resource.value,this.defaultLocale)},m.prototype.getLabel=function(){return this.label?o.LanguageMap.getValue(this.label,this.defaultLocale):null},m.prototype.setLabel=function(a){var p=this;if(this.label&&this.label.length){var h=this.label.filter(function(e){return e.locale===p.defaultLocale||e.locale===o.Utils.getInexactLocale(p.defaultLocale)})[0];h&&(h.value=a)}},m.prototype.getValue=function(){if(this.value){var a=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(a=this.label[0].locale),o.LanguageMap.getValue(this.value,a)}return null},m.prototype.setValue=function(a){var p=this;if(this.value&&this.value.length){var h=this.value.filter(function(e){return e.locale===p.defaultLocale||e.locale===o.Utils.getInexactLocale(p.defaultLocale)})[0];h&&(h.value=a)}},m}();u.LabelValuePair=v},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Language=function(o,v){Array.isArray(o)?o.length===1?this.value=o[0]:this.value=o.join("<br/>"):this.value=o,this.locale=v}},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(){return p!==null&&p.apply(this,arguments)||this}return v(h,p),h.parse=function(e,t){var n,r=[];if(!e)return r;if(Array.isArray(e))for(var d=0;d<e.length;d++){var E=e[d];n=typeof E=="string"?new m.Language(E,t):new m.Language(E["@value"],E["@language"]||t),r.push(n)}else{if(typeof e=="string")return n=new m.Language(e,t),r.push(n),r;e["@value"]?(n=new m.Language(e["@value"],e["@language"]||t),r.push(n)):Object.keys(e).forEach(function(x){if(!e[x].length)throw new Error("language must have a value");n=new m.Language(e[x],x),r.push(n)})}return r},h.getValue=function(e,t){if(e.length){if(t){var n=e.filter(function(r){return r.locale===t||m.Utils.getInexactLocale(r.locale)===m.Utils.getInexactLocale(t)})[0];if(n)return n.value}return e[0].value}return null},h}(Array);u.LanguageMap=a},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(1),a=g(0),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;if(r.index=0,r._allRanges=null,r.items=[],r._topRanges=[],r.__jsonld.structures&&r.__jsonld.structures.length)for(var d=r._getTopRanges(),E=0;E<d.length;E++){var x=d[E];r._parseRanges(x,String(E))}return r}return v(e,h),e.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new a.Canvas(t,this.options)),t},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getDefaultTree=function(){if(h.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];r.viewingHint===m.ViewingHint.TOP&&t.push(r)}if(!t.length){var d={};d.ranges=this.__jsonld.structures,t.push(d)}}return t},e.prototype.getTopRanges=function(){return this._topRanges},e.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];if(r["@id"]===t||r.id===t)return r}return null},e.prototype._parseRanges=function(t,n,r){var d,E=null;if(typeof t=="string"&&(E=t,t=this._getRangeById(E)),t){(d=new a.Range(t,this.options)).parentRange=r,d.path=n,r?r.items.push(d):this._topRanges.push(d);var x=t.items||t.members;if(x)for(var y=0;y<x.length;y++){var A=x[y];if(A["@type"]&&A["@type"].toLowerCase()==="sc:range"||A.type&&A.type.toLowerCase()==="range")this._parseRanges(A,n+"/"+y,d);else if(A["@type"]&&A["@type"].toLowerCase()==="sc:canvas"||A.type&&A.type.toLowerCase()==="canvas"){d.canvases||(d.canvases=[]);var O=A.id||A["@id"];d.canvases.push(O)}}else if(t.ranges)for(y=0;y<t.ranges.length;y++)this._parseRanges(t.ranges[y],n+"/"+y,d)}else console.warn("Range:",E,"does not exist")},e.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),n=function(E){var x=t[E];x.id&&r._allRanges.push(x);var y=function(O,T){O.add(T);var I=T.getRanges();return I.length?I.reduce(y,O):O},A=Array.from(x.getRanges().reduce(y,new Set));r._allRanges=r._allRanges.concat(A)},r=this,d=0;d<t.length;d++)n(d);return this._allRanges},e.prototype.getRangeById=function(t){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var d=n[r];if(d.id===t)return d}return null},e.prototype.getRangeByPath=function(t){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var d=n[r];if(d.path===t)return d}return null},e.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var n=0;n<t.length;n++){var r=t[n],d=new a.Sequence(r,this.options);this.items.push(d)}else this.__jsonld.items&&(d=new a.Sequence(this.__jsonld.items,this.options),this.items.push(d));return this.items},e.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},e.prototype.getTotalSequences=function(){return this.getSequences().length},e.prototype.getManifestType=function(){var t=this.getService(m.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):a.ManifestType.EMPTY},e.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===m.ViewingHint.PAGED;var n=this.getBehavior();return!!n&&n===m.Behavior.PAGED},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e}(a.IIIFResource);u.Manifest=p},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(o){o.EMPTY="",o.MANUSCRIPT="manuscript",o.MONOGRAPH="monograph"}(u.ManifestType||(u.ManifestType={}))},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=g(1),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r._ranges=null,r.canvases=null,r.items=[],r}return v(e,h),e.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},e.prototype.getDuration=function(){var t,n;if(this.canvases&&this.canvases.length)for(var r=0;r<this.canvases.length;r++){var d=this.canvases[r],E=m.Utils.getTemporalComponent(d);E&&E.length>1&&(r===0&&(t=Number(E[0])),r===this.canvases.length-1&&(n=Number(E[1])))}else{var x=this.getRanges();for(r=0;r<x.length;r++){var y=x[r].getDuration();y&&(r===0&&(t=y.start),r===x.length-1&&(n=y.end))}}if(t!==void 0&&n!==void 0)return new m.Duration(t,n)},e.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(t){return t.isRange()})},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getTree=function(t){t.data=this,this.treeNode=t;var n=this.getRanges();if(n&&n.length)for(var r=0;r<n.length;r++){var d=n[r],E=new m.TreeNode;t.addNode(E),this._parseTreeNode(E,d)}return m.Utils.generateTreeNodeIds(t),t},e.prototype.spansTime=function(t){var n=this.getDuration();return!!(n&&t>=n.start&&t<=n.end)},e.prototype._parseTreeNode=function(t,n){t.label=m.LanguageMap.getValue(n.getLabel(),this.options.locale),t.data=n,t.data.type=m.Utils.normaliseType(m.TreeNodeType.RANGE),n.treeNode=t;var r=n.getRanges();if(r&&r.length)for(var d=0;d<r.length;d++){var E=r[d];if(E.getBehavior()!==a.Behavior.NO_NAV){var x=new m.TreeNode;t.addNode(x),this._parseTreeNode(x,E)}}},e}(m.ManifestResource);u.Range=p},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(a,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(a,p)},function(a,p){function h(){this.constructor=a}o(a,p),a.prototype=p===null?Object.create(p):(h.prototype=p.prototype,new h)});Object.defineProperty(u,"__esModule",{value:!0});var m=function(a){function p(h,e){return a.call(this,h,e)||this}return v(p,a),p.prototype.getFormat=function(){return this.getProperty("format")},p}(g(0).ManifestResource);u.Rendering=m},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(1),a=g(0),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r.items=[],r._thumbnails=null,r}return v(e,h),e.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var n=0;n<t.length;n++){var r=t[n];(d=new a.Canvas(r,this.options)).index=n,this.items.push(d)}else if(this.__jsonld)for(n=0;n<this.__jsonld.length;n++){var d;r=this.__jsonld[n],(d=new a.Canvas(r,this.options)).index=n,this.items.push(d)}return this.items},e.prototype.getCanvasById=function(t){for(var n=0;n<this.getTotalCanvases();n++){var r=this.getCanvasByIndex(n),d=a.Utils.normaliseUrl(r.id);if(a.Utils.normaliseUrl(t)===d)return r}return null},e.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},e.prototype.getCanvasIndexById=function(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n;return null},e.prototype.getCanvasIndexByLabel=function(t,n){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),n&&(t+="r"));for(var r,d,E,x=/(\d*)\D+(\d*)/,y=0;y<this.getTotalCanvases();y++){var A=this.getCanvasByIndex(y);if(a.LanguageMap.getValue(A.getLabel(),this.options.locale)===t||(r=x.exec(t))&&(d=r[1],(E=r[2])&&new RegExp("^"+d+"\\D+"+E+"$").test(A.getLabel().toString())))return y}return-1},e.prototype.getLastCanvasLabel=function(t){for(var n=this.getTotalCanvases()-1;n>=0;n--){var r=this.getCanvasByIndex(n),d=a.LanguageMap.getValue(r.getLabel(),this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(d))return d}else if(d)return d}return this.options.defaultLabel},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getNextPageIndex=function(t,n){var r;if(n){var d=this.getPagedIndices(t),E=this.getViewingDirection();r=E&&E===m.ViewingDirection.RIGHT_TO_LEFT?d[0]+1:d[d.length-1]+1}else r=t+1;return r>this.getLastPageIndex()?-1:r},e.prototype.getPagedIndices=function(t,n){var r=[];if(n){r=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var d=this.getViewingDirection();d&&d===m.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(t);return r},e.prototype.getPrevPageIndex=function(t,n){var r;if(n){var d=this.getPagedIndices(t),E=this.getViewingDirection();r=E&&E===m.ViewingDirection.RIGHT_TO_LEFT?d[d.length-1]-1:d[0]-1}else r=t-1;return r},e.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n}return 0},e.prototype.getThumbs=function(t,n){for(var r=[],d=this.getTotalCanvases(),E=0;E<d;E++){var x=this.getCanvasByIndex(E),y=new a.Thumb(t,x);r.push(y)}return r},e.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),n=0;n<t.length;n++){var r=t[n].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},e.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},e.prototype.getTotalCanvases=function(){return this.getCanvases().length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},e.prototype.isFirstCanvas=function(t){return t===0},e.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},e.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===m.ViewingHint.PAGED},e.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},e}(a.ManifestResource);u.Sequence=p},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var o=g(0),v=function(){function m(){}return m.parse=function(a,p){return typeof a=="string"&&(a=JSON.parse(a)),this.parseJson(a,p)},m.parseJson=function(a,p){var h;if(p&&p.navDate&&!isNaN(p.navDate.getTime())&&(a.navDate=p.navDate.toString()),a["@type"])switch(a["@type"]){case"sc:Collection":h=this.parseCollection(a,p);break;case"sc:Manifest":h=this.parseManifest(a,p);break;default:return null}else switch(a.type){case"Collection":h=this.parseCollection(a,p);break;case"Manifest":h=this.parseManifest(a,p);break;default:return null}return h.isLoaded=!0,h},m.parseCollection=function(a,p){var h=new o.Collection(a,p);return p?(h.index=p.index||0,p.resource&&(h.parentCollection=p.resource.parentCollection)):h.index=0,this.parseCollections(h,p),this.parseManifests(h,p),this.parseItems(h,p),h},m.parseCollections=function(a,p){var h;if(a.__jsonld.collections?h=a.__jsonld.collections:a.__jsonld.items&&(h=a.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="collection"})),h)for(var e=0;e<h.length;e++){p&&(p.index=e);var t=this.parseCollection(h[e],p);t.index=e,t.parentCollection=a,a.items.push(t)}},m.parseManifest=function(a,p){return new o.Manifest(a,p)},m.parseManifests=function(a,p){var h;if(a.__jsonld.manifests?h=a.__jsonld.manifests:a.__jsonld.items&&(h=a.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="manifest"})),h)for(var e=0;e<h.length;e++){var t=this.parseManifest(h[e],p);t.index=e,t.parentCollection=a,a.items.push(t)}},m.parseItem=function(a,p){if(a["@type"]){if(a["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(a,p);if(a["@type"].toLowerCase()==="sc:collection")return this.parseCollection(a,p)}else if(a.type){if(a.type.toLowerCase()==="manifest")return this.parseManifest(a,p);if(a.type.toLowerCase()==="collection")return this.parseCollection(a,p)}return null},m.parseItems=function(a,p){var h=a.__jsonld.members||a.__jsonld.items;if(h)for(var e=function(d){p&&(p.index=d);var E=t.parseItem(h[d],p);return E?a.items.filter(function(x){return x.id===E.id})[0]?"continue":(E.index=d,E.parentCollection=a,void a.items.push(E)):{value:void 0}},t=this,n=0;n<h.length;n++){var r=e(n);if(typeof r=="object")return r.value}},m}();u.Deserialiser=v},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var m=g(0),a=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},h.prototype.getConfirmLabel=function(){return m.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},h.prototype.getDescription=function(){return m.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},h.prototype.getFailureDescription=function(){return m.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},h.prototype.getFailureHeader=function(){return m.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},h.prototype.getHeader=function(){return m.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},h.prototype.getServiceLabel=function(){return m.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},h.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},h}(m.ManifestResource);u.Service=a},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Size=function(o,v){this.width=o,this.height=v}},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(o){o[o.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",o[o.FORBIDDEN=2]="FORBIDDEN",o[o.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",o[o.RESTRICTED=4]="RESTRICTED"}(u.StatusCode||(u.StatusCode={}))},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var o=g(0);u.Thumb=function(v,m){this.data=m,this.index=m.index,this.width=v;var a=m.getHeight()/m.getWidth();this.height=a?Math.floor(this.width*a):v,this.uri=m.getCanonicalImageUri(v),this.label=o.LanguageMap.getValue(m.getLabel())}},function(c,u,g){"use strict";var o,v=this&&this.__extends||(o=function(a,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(a,p)},function(a,p){function h(){this.constructor=a}o(a,p),a.prototype=p===null?Object.create(p):(h.prototype=p.prototype,new h)});Object.defineProperty(u,"__esModule",{value:!0});var m=function(a){function p(h,e){return a.call(this,h,e)||this}return v(p,a),p}(g(0).Resource);u.Thumbnail=m},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var o=g(0),v=function(){function m(a,p){this.label=a,this.data=p||{},this.nodes=[]}return m.prototype.addNode=function(a){this.nodes.push(a),a.parentNode=this},m.prototype.isCollection=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.COLLECTION)},m.prototype.isManifest=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.MANIFEST)},m.prototype.isRange=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.RANGE)},m}();u.TreeNode=v},function(c,u,g){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(o){o.COLLECTION="collection",o.MANIFEST="manifest",o.RANGE="range"}(u.TreeNodeType||(u.TreeNodeType={}))},function(c,u,g){c.exports=function(o){var v={};function m(a){if(v[a])return v[a].exports;var p=v[a]={i:a,l:!1,exports:{}};return o[a].call(p.exports,p,p.exports,m),p.l=!0,p.exports}return m.m=o,m.c=v,m.d=function(a,p,h){m.o(a,p)||Object.defineProperty(a,p,{enumerable:!0,get:h})},m.r=function(a){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},m.t=function(a,p){if(1&p&&(a=m(a)),8&p||4&p&&typeof a=="object"&&a&&a.__esModule)return a;var h=Object.create(null);if(m.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:a}),2&p&&typeof a!="string")for(var e in a)m.d(h,e,function(t){return a[t]}.bind(null,e));return h},m.n=function(a){var p=a&&a.__esModule?function(){return a.default}:function(){return a};return m.d(p,"a",p),p},m.o=function(a,p){return Object.prototype.hasOwnProperty.call(a,p)},m.p="",m(m.s=0)}([function(o,v,m){o.exports=m(1)},function(o,v,m){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.CONTINUE=100,v.SWITCHING_PROTOCOLS=101,v.PROCESSING=102,v.OK=200,v.CREATED=201,v.ACCEPTED=202,v.NON_AUTHORITATIVE_INFORMATION=203,v.NO_CONTENT=204,v.RESET_CONTENT=205,v.PARTIAL_CONTENT=206,v.MULTI_STATUS=207,v.MULTIPLE_CHOICES=300,v.MOVED_PERMANENTLY=301,v.MOVED_TEMPORARILY=302,v.SEE_OTHER=303,v.NOT_MODIFIED=304,v.USE_PROXY=305,v.TEMPORARY_REDIRECT=307,v.BAD_REQUEST=400,v.UNAUTHORIZED=401,v.PAYMENT_REQUIRED=402,v.FORBIDDEN=403,v.NOT_FOUND=404,v.METHOD_NOT_ALLOWED=405,v.NOT_ACCEPTABLE=406,v.PROXY_AUTHENTICATION_REQUIRED=407,v.REQUEST_TIME_OUT=408,v.CONFLICT=409,v.GONE=410,v.LENGTH_REQUIRED=411,v.PRECONDITION_FAILED=412,v.REQUEST_ENTITY_TOO_LARGE=413,v.REQUEST_URI_TOO_LARGE=414,v.UNSUPPORTED_MEDIA_TYPE=415,v.REQUESTED_RANGE_NOT_SATISFIABLE=416,v.EXPECTATION_FAILED=417,v.IM_A_TEAPOT=418,v.UNPROCESSABLE_ENTITY=422,v.LOCKED=423,v.FAILED_DEPENDENCY=424,v.UNORDERED_COLLECTION=425,v.UPGRADE_REQUIRED=426,v.PRECONDITION_REQUIRED=428,v.TOO_MANY_REQUESTS=429,v.REQUEST_HEADER_FIELDS_TOO_LARGE=431,v.INTERNAL_SERVER_ERROR=500,v.NOT_IMPLEMENTED=501,v.BAD_GATEWAY=502,v.SERVICE_UNAVAILABLE=503,v.GATEWAY_TIME_OUT=504,v.HTTP_VERSION_NOT_SUPPORTED=505,v.VARIANT_ALSO_NEGOTIATES=506,v.INSUFFICIENT_STORAGE=507,v.BANDWIDTH_LIMIT_EXCEEDED=509,v.NOT_EXTENDED=510,v.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(c,u,g){c.exports=window.fetch||(window.fetch=g(3).default||g(3))}])},function(s,i,l){"use strict";l.r(i),l.d(i,"BaseComponent",function(){return c});var c=function(){function u(g){this.options=g,this.options.data=Object.assign({},this.data(),g.data)}return u.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},u.prototype.data=function(){return{}},u.prototype.on=function(g,o,v){var m=this._e||(this._e={});(m[g]||(m[g]=[])).push({fn:o,ctx:v})},u.prototype.fire=function(g){for(var o=[],v=1;v<arguments.length;v++)o[v-1]=arguments[v];for(var m=[].slice.call(arguments,1),a=((this._e||(this._e={}))[g]||[]).slice(),p=0,h=a.length;p<h;p++)a[p].fn.apply(a[p].ctx,m)},u.prototype._resize=function(){},u.prototype.set=function(g){},u}()},function(s,i,l){"use strict";l.r(i),l.d(i,"Async",function(){return u}),l.d(i,"Bools",function(){return g}),l.d(i,"Clipboard",function(){return o}),l.d(i,"Colors",function(){return v}),l.d(i,"Dates",function(){return m}),l.d(i,"Device",function(){return a}),l.d(i,"Documents",function(){return p}),l.d(i,"Events",function(){return h}),l.d(i,"Files",function(){return e}),l.d(i,"Keyboard",function(){return t}),l.d(i,"Maths",function(){return n}),l.d(i,"Size",function(){return r}),l.d(i,"Dimensions",function(){return d}),l.d(i,"Numbers",function(){return E}),l.d(i,"Objects",function(){return x}),l.d(i,"Storage",function(){return y}),l.d(i,"StorageItem",function(){return A}),l.d(i,"StorageType",function(){return c}),l.d(i,"Strings",function(){return O}),l.d(i,"Urls",function(){return T});var c,u=function(){function I(){}return I.waitFor=function(f,_,C,S,L,P){S||(S=200),L||(L=100),P||(P=0),(P+=1)>L?C&&C():f()?_():setTimeout(function(){I.waitFor(f,_,C,S,L,P)},S)},I}(),g=function(){function I(){}return I.getBool=function(f,_){return f??_},I}(),o=function(){function I(){}return I.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},I.copy=function(f){f=I.convertBrToNewLine(f);var _=document.createElement("textarea");_.value=f,I.hideButKeepEnabled(_),document.body.appendChild(_),_.focus(),_.select(),document.execCommand("copy"),document.body.removeChild(_)},I.hideButKeepEnabled=function(f){f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.width="2em",f.style.height="2em",f.style.padding="0",f.style.border="none",f.style.outline="none",f.style.boxShadow="none",f.style.background="transparent"},I.convertBrToNewLine=function(f){return f=f.replace(/<br\s*[\/]?>/gi,`
`)},I}(),v=function(){function I(){}return I.float32ColorToARGB=function(f){return[(4278190080&f)>>>24,(16711680&f)>>>16,(65280&f)>>>8,255&f]},I._componentToHex=function(f){var _=f.toString(16);return _.length==1?"0"+_:_},I.rgbToHexString=function(f){return I.coalesce(f),"#"+I._componentToHex(f[0])+I._componentToHex(f[1])+I._componentToHex(f[2])},I.argbToHexString=function(f){return"#"+I._componentToHex(f[0])+I._componentToHex(f[1])+I._componentToHex(f[2])+I._componentToHex(f[3])},I.coalesce=function(f){for(var _=1;_<f.length;_++)f[_]===void 0&&(f[_]=f[_-1])},I}(),m=function(){function I(){}return I.getTimeStamp=function(){return new Date().getTime()},I}(),a=function(){function I(){}return I.getPixelRatio=function(f){return(window.devicePixelRatio||1)/(f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1)},I.isTouch=function(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints>0},I}(),p=function(){function I(){}return I.isInIFrame=function(){try{return window.self!==window.top}catch{return!0}},I.supportsFullscreen=function(){var f=document.documentElement;return(f.requestFullscreen||f.mozRequestFullScreen||f.webkitRequestFullScreen||f.msRequestFullscreen)!==void 0},I.isHidden=function(){return!!I.getHiddenProp()},I.getHiddenProp=function(){var f=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var _=0;_<f.length;_++)if(f[_]+"Hidden"in document)return f[_]+"Hidden";return null},I}(),h=function(){function I(){}return I.debounce=function(f,_){return _=_||100,function(){if(!f.debouncing){var C=Array.prototype.slice.apply(arguments);f.lastReturnVal=f.apply(window,C),f.debouncing=!0}return clearTimeout(f.debounceTimeout),f.debounceTimeout=setTimeout(function(){f.debouncing=!1},_),f.lastReturnVal}},I}(),e=function(){function I(){}return I.simplifyMimeType=function(f){switch(f){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var _=f.split("/");return _[_.length-1]}},I}(),t=function(){function I(){}return I.getCharCode=function(f){return typeof f.which=="number"?f.which:f.keyCode},I}(),n=function(){function I(){}return I.normalise=function(f,_,C){return(f-_)/(C-_)},I.median=function(f){f.sort(function(C,S){return C-S});var _=Math.floor(f.length/2);return f.length%2?f[_]:(f[_-1]+f[_])/2},I.clamp=function(f,_,C){return Math.min(Math.max(f,_),C)},I}(),r=function(I,f){this.width=I,this.height=f},d=function(){function I(){}return I.fitRect=function(f,_,C,S){var L,P=0,ft=0;return _/f<S/C?(P=f*(L=C/f),ft=_*L):(P=f*(L=S/_),ft=_*L),new r(Math.floor(P),Math.floor(ft))},I.hitRect=function(f,_,C,S,L,P){return L>f&&L<f+C&&P>_&&P<_+S},I}(),E=function(){function I(){}return I.numericalInput=function(f){return f.keyCode==46||f.keyCode==8||f.keyCode==9||f.keyCode==27||f.keyCode==65&&f.ctrlKey===!0||f.keyCode>=35&&f.keyCode<=39||!(f.shiftKey||(f.keyCode<48||f.keyCode>57)&&(f.keyCode<96||f.keyCode>105))||(f.preventDefault(),!1)},I}(),x=function(){function I(){}return I.toPlainObject=function(f){f=Object(f);var _={};for(var C in f)_[C]=f[C];return _},I}(),y=function(){function I(){}return I.clear=function(f){switch(f===void 0&&(f=c.MEMORY),f){case c.MEMORY:this._memoryStorage={};break;case c.SESSION:sessionStorage.clear();break;case c.LOCAL:localStorage.clear()}},I.clearExpired=function(f){f===void 0&&(f=c.MEMORY);for(var _=this.getItems(f),C=0;C<_.length;C++){var S=_[C];this._isExpired(S)&&this.remove(S.key)}},I.get=function(f,_){_===void 0&&(_=c.MEMORY);var C=null;switch(_){case c.MEMORY:C=this._memoryStorage[f];break;case c.SESSION:C=sessionStorage.getItem(f);break;case c.LOCAL:C=localStorage.getItem(f)}if(!C)return null;var S=null;try{S=JSON.parse(C)}catch{return null}return S?this._isExpired(S)?null:(S.key=f,S):null},I._isExpired=function(f){return!(new Date().getTime()<f.expiresAt)},I.getItems=function(f){f===void 0&&(f=c.MEMORY);var _=[];switch(f){case c.MEMORY:for(var C=Object.keys(this._memoryStorage),S=0;S<C.length;S++)(P=this.get(C[S],c.MEMORY))&&_.push(P);break;case c.SESSION:for(S=0;S<sessionStorage.length;S++)(L=sessionStorage.key(S))&&(P=this.get(L,c.SESSION))&&_.push(P);break;case c.LOCAL:for(S=0;S<localStorage.length;S++){var L,P;(L=localStorage.key(S))&&(P=this.get(L,c.LOCAL))&&_.push(P)}}return _},I.remove=function(f,_){switch(_===void 0&&(_=c.MEMORY),_){case c.MEMORY:delete this._memoryStorage[f];break;case c.SESSION:sessionStorage.removeItem(f);break;case c.LOCAL:localStorage.removeItem(f)}},I.set=function(f,_,C,S){S===void 0&&(S=c.MEMORY);var L=1e3*C,P=new A;switch(P.value=_,P.expiresAt=new Date().getTime()+L,S){case c.MEMORY:this._memoryStorage[f]=JSON.stringify(P);break;case c.SESSION:sessionStorage.setItem(f,JSON.stringify(P));break;case c.LOCAL:localStorage.setItem(f,JSON.stringify(P))}return P},I._memoryStorage={},I}(),A=function(){};(function(I){I.MEMORY="memory",I.SESSION="session",I.LOCAL="local"})(c||(c={}));var O=function(){function I(){}return I.ellipsis=function(f,_){if(f.length<=_)return f;var C=f.substr(0,_),S=C.lastIndexOf(" ");return S!=-1&&(C=C.substr(0,Math.min(C.length,S))),C+"&hellip;"},I.htmlDecode=function(f){var _=document.createElement("div");return _.innerHTML=f,_.firstChild.nodeValue},I.format=function(f){for(var _=[],C=1;C<arguments.length;C++)_[C-1]=arguments[C];for(var S=0;S<_.length;S++){var L=new RegExp("\\{"+S+"\\}","gm");f=f.replace(L,_[S])}return f},I.isAlphanumeric=function(f){return/^[a-zA-Z0-9]*$/.test(f)},I.toCssClass=function(f){return f.replace(/[^a-z0-9]/g,function(_){var C=_.charCodeAt(0);return C==32?"-":C>=65&&C<=90?"_"+_.toLowerCase():"__"+("000"+C.toString(16)).slice(-4)})},I.toFileName=function(f){return f.replace(/[^a-z0-9]/gi,"_").toLowerCase()},I.utf8_to_b64=function(f){return window.btoa(unescape(encodeURIComponent(f)))},I}(),T=function(){function I(){}return I.getHashParameter=function(f,_){return _||(_=window.document),_&&_.location?this.getHashParameterFromString(f,_.location.hash):null},I.getHashParameterFromString=function(f,_){var C=new RegExp("#.*[?&]"+f+"=([^&]+)(&|$)").exec(_);return C?decodeURIComponent(C[1].replace(/\+/g," ")):null},I.setHashParameter=function(f,_,C){if(C||(C=window.document),C&&C.location){var S="#?"+this.updateURIKeyValuePair(C.location.hash.replace("#?",""),f,_),L=C.URL;L.indexOf("#")!=-1&&(L=L.substr(0,L.indexOf("#"))),C.location.replace(L+S)}},I.getQuerystringParameter=function(f,_){return _||(_=window),this.getQuerystringParameterFromString(f,_.location.search)},I.getQuerystringParameterFromString=function(f,_){f=f.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var C=new RegExp("[\\?&]"+f+"=([^&#]*)").exec(_);return C?decodeURIComponent(C[1].replace(/\+/g," ")):null},I.setQuerystringParameter=function(f,_,C){if(C||(C=window.document),C&&C.location){var S=this.updateURIKeyValuePair(C.location.hash.replace("#?",""),f,_);window.location.search=S}},I.updateURIKeyValuePair=function(f,_,C){_=encodeURIComponent(_),C=encodeURIComponent(C);var S=f.split("&");S[0]==""&&S.shift();for(var L,P=S.length;P--;)if((L=S[P].split("="))[0]==_){L[1]=C,S[P]=L.join("=");break}return P<0&&(S[S.length]=[_,C].join("=")),S.join("&")},I.getUrlParts=function(f){var _=document.createElement("a");return _.href=f,_},I.convertToRelativeUrl=function(f){var _=this.getUrlParts(f),C=_.pathname+_.searchWithin;return C.startsWith("/")||(C="/"+C),C},I}()}])})});var ot=class{constructor(i,l){this.informationType=i;this.param=l}};var Y;(function(l){l[l.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",l[l.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"})(Y||(Y={}));var ct=class{};ct.FORBIDDEN="forbiddenResourceMessage";var K=it(Rt());var Q=it(Mt());var zt=H(),N=class{static loadExternalResources(i,l){return new Promise(c=>{K.Utils.loadExternalResourcesAuth09(i,l,N.clickThrough,N.restricted,N.login,N.getAccessToken,N.storeAccessToken,N.getStoredAccessToken,N.handleExternalResourceResponse).then(u=>{c(u)}).catch(u=>{switch(u.name){case K.StatusCode.AUTHORIZATION_FAILED.toString():N.publish(b.LOGIN_FAILED);break;case K.StatusCode.FORBIDDEN.toString():N.publish(b.FORBIDDEN);break;case K.StatusCode.RESTRICTED.toString():break;default:N.publish(b.SHOW_MESSAGE,[u.message||u])}})})}static clickThrough(i){return new Promise(l=>{N.publish(b.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:i,acceptCallback:()=>{if(i.clickThroughService){let c=window.open(i.clickThroughService.id),u=window.setInterval(()=>{c&&c.closed&&(window.clearInterval(u),N.publish(b.CLICKTHROUGH),l())},500)}}}])})}static restricted(i){return new Promise((l,c)=>{N.publish(b.SHOW_RESTRICTED_DIALOGUE,[{resource:i,acceptCallback:()=>{N.publish(w.LOAD_FAILED),c(i)}}])})}static login(i){return new Promise(l=>{let c={};i.status===Q.FORBIDDEN&&(c.warningMessage=ct.FORBIDDEN,c.showCancelButton=!0),console.log("login"),N.publish(b.SHOW_LOGIN_DIALOGUE,[{resource:i,loginCallback:()=>{if(i.loginService){let u=window.open(i.loginService.id+"?t="+new Date().getTime()),g=window.setInterval(function(){u&&u.closed&&(window.clearInterval(g),N.publish(b.LOGIN),l())},500)}},logoutCallback:()=>{if(i.logoutService){let u=window.open(i.logoutService.id+"?t="+new Date().getTime()),g=window.setInterval(function(){u&&u.closed&&(window.clearInterval(g),N.publish(b.LOGOUT),l())},500)}},options:c}])})}static getAccessToken(i,l){return new Promise((c,u)=>{if(i.tokenService){let g=i.tokenService.id,o=g+"|"+new Date().getTime(),v=a=>{window.removeEventListener("message",v);let p=a.data;p.error?u(l?p.errorDescription:void 0):c(p)};window.addEventListener("message",v,!1);let m=g+"?messageId="+o;zt("#commsFrame").prop("src",m)}else u("Token service not found")})}static storeAccessToken(i,l,c){return new Promise((u,g)=>{i.tokenService?(G.set(i.tokenService.id,l,l.expiresIn,c),u()):g("Token service not found")})}static getStoredAccessToken(i,l){return new Promise((c,u)=>{let g=[],o=null;if(i.tokenService&&(o=G.get(i.tokenService.id,l)),o)g.push(o);else{let m=V.getUrlParts(i.dataUri).hostname,a=G.getItems(l);for(let p=0;p<a.length;p++)o=a[p],o.key.includes(m)&&g.push(o)}g=g.sort((m,a)=>m.expiresAt-a.expiresAt);let v;g.length&&(v=g[g.length-1].value,c(v))})}static handleExternalResourceResponse(i){return new Promise((l,c)=>{if(i.isResponseHandled=!0,i.status===Q.OK)l(i);else if(i.status===Q.MOVED_TEMPORARILY)l(i),N.publish(b.RESOURCE_DEGRADED,[i]);else if(i.error.status===Q.UNAUTHORIZED||i.error.status===Q.INTERNAL_SERVER_ERROR)c(i.error.statusText);else if(i.error.status===Q.FORBIDDEN){let u=new Error;u.message="Forbidden",u.name=K.StatusCode.FORBIDDEN.toString(),c(u)}else c(i.error.statusText)})}static handleDegraded(i){let l=new ot(Y.DEGRADED_RESOURCE,i);N.publish(b.SHOW_INFORMATION,[l])}};var nt=it(Rt());var Nt=it(Mt()),Wt=H(),M=class{static loadExternalResources(i,l,c){return new Promise(u=>{M.storageStrategy=l,i=i.map(g=>(g.authAPIVersion=1,g.options=c,g)),nt.Utils.loadExternalResourcesAuth1(i,M.openContentProviderInteraction,M.openTokenService,M.getStoredAccessToken,M.userInteractedWithContentProvider,M.getContentProviderInteraction,M.handleMovedTemporarily,M.showOutOfOptionsMessages).then(g=>{u(g)}).catch(g=>{switch(g.name){case nt.StatusCode.AUTHORIZATION_FAILED.toString():M.publish(b.LOGIN_FAILED);break;case nt.StatusCode.FORBIDDEN.toString():M.publish(b.FORBIDDEN);break;case nt.StatusCode.RESTRICTED.toString():break;default:M.publish(b.SHOW_MESSAGE,[g.message||g])}})})}static getCookieServiceUrl(i){return i.id+"?origin="+M.getOrigin()}static openContentProviderInteraction(i){let l=M.getCookieServiceUrl(i);return window.open(l)}static getOrigin(i){let l=window.location;return i&&(l=document.createElement("a"),l.href=i),l.protocol+"//"+l.hostname+(l.port?":"+l.port:"")}static userInteractedWithContentProvider(i){return new Promise(l=>{let c=window.setInterval(()=>{i.closed&&(window.clearInterval(c),l(!0))},500)})}static handleMovedTemporarily(i){return new Promise(l=>{M.showDegradedMessage(i),i.isResponseHandled=!0,l()})}static showDegradedMessage(i){if(i.kioskService)M.publish(b.OPEN_EXTERNAL_RESOURCE,[[i]]);else{let l=new ot(Y.DEGRADED_RESOURCE,i);M.publish(b.SHOW_INFORMATION,[l])}}static storeAccessToken(i,l){return new Promise((c,u)=>{i.tokenService?(G.set(i.tokenService.id,l,l.expiresIn||3600,M.storageStrategy),c()):u("Token service not found")})}static getStoredAccessToken(i){return new Promise((l,c)=>{let u=[],g=null;if(i.tokenService&&(g=G.get(i.tokenService.id,M.storageStrategy)),g)u.push(g);else{let v=V.getUrlParts(i.dataUri).hostname,m=G.getItems(M.storageStrategy);for(let a=0;a<m.length;a++)g=m[a],g.key.includes(v)&&u.push(g)}u=u.sort((v,m)=>v.expiresAt-m.expiresAt);let o=null;u.length&&(o=u[u.length-1].value),l(o)})}static getContentProviderInteraction(i,l){return new Promise(c=>{i.isResponseHandled&&!i.authHoldingPage?(M.showDegradedMessage(i),c(null)):i.authHoldingPage?(i.authHoldingPage.location.href=M.getCookieServiceUrl(l),c(i.authHoldingPage)):M.publish(b.SHOW_AUTH_DIALOGUE,[{service:l,closeCallback:()=>{c(null)},confirmCallback:()=>{let u=M.openContentProviderInteraction(l);c(u)},cancelCallback:()=>{c(null)}}])})}static openTokenService(i,l){return new Promise((c,u)=>{let g=M.getOrigin(l.id),o=new Date().getTime();M.messages[o]={resolve:c,reject:u,serviceOrigin:g,resource:i},window.addEventListener("message",M.receiveToken,!1);let v=l.id+"?messageId="+o+"&origin="+M.getOrigin();Wt("#commsFrame").prop("src",v);let m=5e3;setTimeout(()=>{M.messages[o]&&(M.messages[o].reject("Message unhandled after "+m+"ms, rejecting"),delete M.messages[o])},m)})}static receiveToken(i){if(i.data.hasOwnProperty("messageId")){let l=M.messages[i.data.messageId];l&&i.origin==l.serviceOrigin&&M.storeAccessToken(l.resource,i.data).then(()=>{l.resolve(i.data),delete M.messages[i.data.messageId]})}}static showOutOfOptionsMessages(i,l){if(i.status==Nt.MOVED_TEMPORARILY)return;let c="";l.getFailureHeader()&&(c+="<p>"+l.getFailureHeader()+"</p>"),l.getFailureDescription()&&(c+=l.getFailureDescription()),M.publish(b.SHOW_MESSAGE,[j(c)])}},rt=M;rt.messages={};var mt=class{constructor(i,l,c){this.isResized=!1;this.$element=i,this.fitToParentWidth=l||!1,this.fitToParentHeight=c||!1,this.create()}create(){this.extensionHost?.subscribe(w.RESIZE,()=>{this.resize()})}whenResized(i){Ot.waitFor(()=>this.isResized,i)}onAccessibleClick(i,l,c=!0){c&&i.on("click",u=>{l(u)}),i.on("keyup",u=>{u.keyCode===32&&l(u)})}resize(){let i=this.$element.parent();this.fitToParentWidth&&this.$element.width(i.width()),this.fitToParentHeight&&this.$element.height(i.height()),this.isResized=!0}};var qt=H(),D=class extends mt{constructor(i,l,c){super(i,l,c)}create(){this.extensionHost=this.$element.closest(".uv-iiif-extension-host").data("component"),super.create(),this.extension=this.extensionHost.extension,this.config={},this.config.content={},this.config.options={};var i=this;i.modules&&i.modules.length&&(i.modules=i.modules.reverse(),i.modules.forEach(l=>{i.config=qt.extend(!0,i.config,i.extension.data.config.modules[l])})),this.content=this.config.content,this.options=this.config.options}init(){}setConfig(i){this.modules||(this.modules=[]),this.modules.push(i)}resize(){super.resize()}};var tt=H(),F=class extends D{constructor(i){super(i,!1,!1);this.allowClose=!0;this.isActive=!1;this.isUnopened=!0}create(){this.setConfig("dialogue"),super.create(),this.extensionHost.subscribe(b.CLOSE_ACTIVE_DIALOGUE,()=>{this.isActive&&this.allowClose&&this.close()}),this.extensionHost.subscribe(b.ESCAPE,()=>{this.isActive&&this.allowClose&&this.close()}),this.$top=tt('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=tt('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=tt('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=tt('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=tt('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=tt('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.options.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",i=>{i.preventDefault(),this.close()}),this.returnFunc=this.close}enableClose(){this.allowClose=!0,this.$closeButton.show()}disableClose(){this.allowClose=!1,this.$closeButton.hide()}setDockedPosition(){let i=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),l=0,c=0,u=0;if(this.$triggerButton){let g=4,o=2,v=this.$triggerButton.offset().top,m=this.extension.$element.offset().top,a=this.$element.outerHeight(!0);i=v-m-a+g;let h=this.$triggerButton.offset().left,e=this.extension.$element.offset().left,t=h-e;u=St.normalise(t,0,this.extension.width()),l=Math.floor(this.extension.width()*u-this.$element.width()*u)+o,c=Math.floor(this.$element.width()*u)}this.$bottom.css("backgroundPosition",c+"px 0px"),this.$element.css({top:i,left:l})}open(i){this.$element.attr("aria-hidden","false"),this.$element.show(),i?(this.$triggerButton=tt(i),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout(()=>{let l=this.$element.find(".default");if(l.length)l.focus();else{let c=this.$element.find("input:visible").first();c.length?c.focus():this.$closeButton.focus()}},1),this.extensionHost.publish(b.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()}afterFirstOpen(){}close(){!this.isActive||(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.extensionHost.publish(this.closeCommand),this.extensionHost.publish(b.HIDE_OVERLAY))}resize(){super.resize(),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})}};var Bt=H(),vt=class extends F{constructor(i){super(i)}create(){this.setConfig("authDialogue"),super.create(),this.openCommand=b.SHOW_AUTH_DIALOGUE,this.closeCommand=b.HIDE_AUTH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{let l=Array.isArray(i)?i[0]:i;this.closeCallback=l.closeCallback,this.confirmCallback=l.confirmCallback,this.cancelCallback=l.cancelCallback,this.service=l.service,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Bt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",i=>{i.preventDefault(),this.confirmCallback&&this.confirmCallback(),this.close()}),this.$cancelButton.on("click",i=>{i.preventDefault(),this.cancelCallback&&this.cancelCallback(),this.close()})}open(){if(!this.service){console.error("NO SERVICE");return}super.open();let i=this.service.getHeader(),l=this.service.getDescription(),c=this.service.getConfirmLabel();i&&this.$title.text(j(i)),l&&(this.$message.html(j(l)),this.$message.targetBlank(),this.$message.find("a").on("click",function(){let u=Bt(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,u)})),c&&this.$confirmButton.text(j(c)),this.resize()}resize(){super.resize()}_buttonsToAdd(){var i='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.options.topCloseButtonEnabled&&(i+='<button class="close btn btn-default"></button>'),i}};var Ht=H(),Et=class extends F{constructor(i){super(i)}create(){this.setConfig("clickThroughDialogue"),super.create(),this.openCommand=b.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=b.HIDE_CLICKTHROUGH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Ht('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",i=>{i.preventDefault(),this.close(),this.extensionHost.publish(b.ACCEPT_TERMS),this.acceptCallback&&this.acceptCallback()})}open(){super.open(),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",function(){var i=Ht(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,i)}),this.resize()}resize(){super.resize()}};var kt=H(),bt=class extends F{constructor(i){super(i)}create(){this.setConfig("loginDialogue"),super.create(),this.openCommand=b.SHOW_LOGIN_DIALOGUE,this.closeCommand=b.HIDE_LOGIN_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.loginCallback=i.loginCallback,this.logoutCallback=i.logoutCallback,this.options=i.options,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=kt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",i=>{i.preventDefault(),this.close(),this.loginCallback&&this.loginCallback()}),this.$logoutButton.on("click",i=>{i.preventDefault(),this.close(),this.logoutCallback&&this.logoutCallback()}),this.$cancelButton.on("click",i=>{i.preventDefault(),this.close()}),this.updateLogoutButton()}open(){super.open();let i="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),i=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(i='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+i+"</span>"),this.updateLogoutButton(),this.$message.html(i),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var l=kt(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,l)}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()}updateLogoutButton(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()}resize(){super.resize()}};var Ft=H(),_t=class extends F{constructor(i){super(i)}create(){this.setConfig("restrictedDialogue"),super.create(),this.openCommand=b.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=b.HIDE_RESTRICTED_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.options=i.options,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Ft('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",i=>{i.preventDefault(),this.close()})}open(){super.open(),this.isAccepted=!1;let i="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),i=this.resource.restrictedService.getProperty("description")),this.$message.html(i),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var l=Ft(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,l)}),this.resize()}close(){super.close(),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())}resize(){super.resize()}};var Ut=H(),It=class extends F{constructor(i){super(i)}create(){this.setConfig("genericDialogue"),super.create(),this.openCommand=b.SHOW_GENERIC_DIALOGUE,this.closeCommand=b.HIDE_GENERIC_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.showMessage(i)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$message=Ut("<p></p>"),this.$content.append(this.$message),this.$acceptButton=Ut(`
          <button class="btn btn-primary accept default">
            ${this.content.ok}
          </button>
        `),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed(()=>{this.accept()}),this.returnFunc=()=>{this.isActive&&this.accept()},this.$element.hide()}accept(){this.extensionHost.publish(b.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()}showMessage(i){this.$message.html(i.message),i.buttonText?this.$acceptButton.text(i.buttonText):this.$acceptButton.text(this.content.ok),i.allowClose===!1&&this.disableClose(),this.open()}resize(){super.resize()}};var z=H(),xt=class extends D{constructor(i){super(i,!0,!0)}create(){super.create(),this.extensionHost.subscribe(b.SHOW_OVERLAY,()=>{this.$overlays.show()}),this.extensionHost.subscribe(b.HIDE_OVERLAY,()=>{this.$overlays.hide()}),this.$element.append('<a class="sr-only" href="#download-btn">'+this.extension.data.config.content.skipToDownload+"</a>"),this.$headerPanel=z('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=z('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=z('<div class="centerPanel"></div>'),this.$centerPanel.append('<h2 class="sr-only">'+this.extension.data.config.content.mediaViewer+"</h2>"),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=z('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=z('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=z('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=z('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=z('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$overlays.hide(),this.$genericDialogue=z('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",i=>{z(i.target).hasClass("overlays")&&(i.preventDefault(),this.extensionHost.publish(b.CLOSE_ACTIVE_DIALOGUE))}),new It(this.$genericDialogue)}resize(){super.resize(),setTimeout(()=>{this.$overlays.width(this.extension.width()),this.$overlays.height(this.extension.height())},1);let i=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(U(this.$headerPanel)?this.$headerPanel.height():0)-(U(this.$footerPanel)?this.$footerPanel.height():0)-(U(this.$mobileFooterPanel)?this.$mobileFooterPanel.height():0);this.$mainPanel.height(i)}};var Gt=it(Jt());var k;(function(s){s[s.Backspace=8]="Backspace",s[s.Tab=9]="Tab",s[s.Enter=13]="Enter",s[s.Shift=16]="Shift",s[s.Ctrl=17]="Ctrl",s[s.Alt=18]="Alt",s[s.PauseBreak=19]="PauseBreak",s[s.CapsLock=20]="CapsLock",s[s.Escape=27]="Escape",s[s.Spacebar=32]="Spacebar",s[s.PageUp=33]="PageUp",s[s.PageDown=34]="PageDown",s[s.End=35]="End",s[s.Home=36]="Home",s[s.LeftArrow=37]="LeftArrow",s[s.UpArrow=38]="UpArrow",s[s.RightArrow=39]="RightArrow",s[s.DownArrow=40]="DownArrow",s[s.PrintScrn=44]="PrintScrn",s[s.Insert=45]="Insert",s[s.Delete=46]="Delete",s[s.Zero=48]="Zero",s[s.One=49]="One",s[s.Two=50]="Two",s[s.Three=51]="Three",s[s.Four=52]="Four",s[s.Five=53]="Five",s[s.Six=54]="Six",s[s.Seven=55]="Seven",s[s.Eight=56]="Eight",s[s.Nine=57]="Nine",s[s.a=65]="a",s[s.b=66]="b",s[s.c=67]="c",s[s.d=68]="d",s[s.e=69]="e",s[s.f=70]="f",s[s.g=71]="g",s[s.h=72]="h",s[s.i=73]="i",s[s.j=74]="j",s[s.k=75]="k",s[s.l=76]="l",s[s.m=77]="m",s[s.n=78]="n",s[s.o=79]="o",s[s.p=80]="p",s[s.q=81]="q",s[s.r=82]="r",s[s.s=83]="s",s[s.t=84]="t",s[s.u=85]="u",s[s.v=86]="v",s[s.w=87]="w",s[s.x=88]="x",s[s.y=89]="y",s[s.z=90]="z",s[s.LeftWindowKey=91]="LeftWindowKey",s[s.RightWindowKey=92]="RightWindowKey",s[s.SelectKey=93]="SelectKey",s[s.Numpad0=96]="Numpad0",s[s.Numpad1=97]="Numpad1",s[s.Numpad2=98]="Numpad2",s[s.Numpad3=99]="Numpad3",s[s.Numpad4=100]="Numpad4",s[s.Numpad5=101]="Numpad5",s[s.Numpad6=102]="Numpad6",s[s.Numpad7=103]="Numpad7",s[s.Numpad8=104]="Numpad8",s[s.Numpad9=105]="Numpad9",s[s.Multiply=106]="Multiply",s[s.NumpadPlus=107]="NumpadPlus",s[s.NumpadMinus=109]="NumpadMinus",s[s.DecimalPoint=110]="DecimalPoint",s[s.Divide=111]="Divide",s[s.F1=112]="F1",s[s.F2=113]="F2",s[s.F3=114]="F3",s[s.F4=115]="F4",s[s.F5=116]="F5",s[s.F6=117]="F6",s[s.F7=118]="F7",s[s.F8=119]="F8",s[s.F9=120]="F9",s[s.F10=121]="F10",s[s.F11=122]="F11",s[s.F12=123]="F12",s[s.NumLock=144]="NumLock",s[s.ScrollLock=145]="ScrollLock",s[s.Semicolon=186]="Semicolon",s[s.Equals=187]="Equals",s[s.Comma=188]="Comma",s[s.LessThan=188]="LessThan",s[s.Dash=189]="Dash",s[s.Period=190]="Period",s[s.GreaterThan=190]="GreaterThan",s[s.ForwardSlash=191]="ForwardSlash",s[s.QuestionMark=191]="QuestionMark",s[s.GraveAccent=192]="GraveAccent",s[s.Tilde=192]="Tilde",s[s.OpenCurlyBracket=219]="OpenCurlyBracket",s[s.OpenSquareBracket=219]="OpenSquareBracket",s[s.BackSlash=220]="BackSlash",s[s.VerticalPipe=220]="VerticalPipe",s[s.CloseCurlyBracket=221]="CloseCurlyBracket",s[s.CloseSquareBracket=221]="CloseSquareBracket",s[s.Quote=222]="Quote",s[s.CommandFF=224]="CommandFF"})(k||(k={}));var Dt;(function(s){s[s.Backspace=8]="Backspace",s[s.Enter=13]="Enter",s[s.Spacebar=32]="Spacebar",s[s.Hash=35]="Hash",s[s.GraveAccent=39]="GraveAccent",s[s.DoubleQuote=34]="DoubleQuote",s[s.Asterisk=42]="Asterisk",s[s.Plus=43]="Plus",s[s.Comma=44]="Comma",s[s.Minus=45]="Minus",s[s.Period=46]="Period",s[s.ForwardSlash=47]="ForwardSlash",s[s.Zero=48]="Zero",s[s.One=49]="One",s[s.Two=50]="Two",s[s.Three=51]="Three",s[s.Four=52]="Four",s[s.Five=53]="Five",s[s.Six=54]="Six",s[s.Seven=55]="Seven",s[s.Eight=56]="Eight",s[s.Nine=57]="Nine",s[s.Colon=58]="Colon",s[s.Semicolon=59]="Semicolon",s[s.LessThan=60]="LessThan",s[s.Equals=61]="Equals",s[s.GreaterThan=62]="GreaterThan",s[s.QuestionMark=63]="QuestionMark",s[s.At=64]="At",s[s.OpenSquareBracket=91]="OpenSquareBracket",s[s.BackSlash=92]="BackSlash",s[s.CloseSquareBracket=93]="CloseSquareBracket",s[s.a=97]="a",s[s.b=98]="b",s[s.c=99]="c",s[s.d=100]="d",s[s.e=101]="e",s[s.f=102]="f",s[s.g=103]="g",s[s.h=104]="h",s[s.i=105]="i",s[s.j=106]="j",s[s.k=107]="k",s[s.l=108]="l",s[s.m=109]="m",s[s.n=110]="n",s[s.o=111]="o",s[s.p=112]="p",s[s.q=113]="q",s[s.r=114]="r",s[s.s=115]="s",s[s.t=116]="t",s[s.u=117]="u",s[s.v=118]="v",s[s.w=119]="w",s[s.x=120]="x",s[s.y=121]="y",s[s.z=122]="z",s[s.OpenCurlyBracket=123]="OpenCurlyBracket",s[s.VerticalPipe=124]="VerticalPipe",s[s.CloseCurlyBracket=125]="CloseCurlyBracket",s[s.Tilde=126]="Tilde"})(Dt||(Dt={}));var W=H(),Yt=class{constructor(){this.annotations=[];this.isCreated=!1;this.isLoggedIn=!1;this.metrics=[];this.shifted=!1;this.tabbing=!1;this.locales={}}create(){let i=this;if(this.browserDetect=new Vt,this.browserDetect.init(),N.publish=this.extensionHost.publish.bind(this.extensionHost),rt.publish=this.extensionHost.publish.bind(this.extensionHost),this.$element=W(this.extensionHost.options.target),this.$element.data("component",this.extensionHost),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv-iiif-extension-host"),this.$element.addClass("loading"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.isRightPanelEnabled()&&this.$element.addClass("right-panel-enabled"),this.isLeftPanelEnabled()&&this.$element.addClass("left-panel-enabled"),this.isFooterPanelEnabled()&&this.$element.addClass("footer-panel-enabled"),this.$element.addClass(this.type.name),this.$element.addClass("browser-"+this.browserDetect.browser),this.$element.addClass("browser-version-"+this.browserDetect.version),this.$element.prop("tabindex",-1),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),X.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.isFullScreen()&&this.$element.addClass("fullscreen"),this.$element.on("mousemove",l=>{this.mouseX=l.pageX,this.mouseY=l.pageY}),!this.data.isReload){let l=X.getHiddenProp();if(l){let c=l.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(c,()=>{X.isHidden()||this.resize()})}R.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",c=>{c.preventDefault();let u=c.originalEvent.dataTransfer.getData("URL"),g=V.getUrlParts(u),o=V.getQuerystringParameterFromString("manifest",g.search);if(o||(o=V.getQuerystringParameterFromString("collection",g.search)),o){this.fire(w.DROP,o);let v={};v.iiifManifestId=o,this.reload(v)}}),this.$element.on("dragover",c=>{c.preventDefault()}),this.$element.on("keyup keydown",c=>{this.shifted=c.shiftKey,this.tabbing=c.keyCode===k.Tab}),this.$element.on("keydown",c=>{let u=null,g=!0;!c.ctrlKey&&!c.altKey&&!c.shiftKey&&(c.keyCode===k.Enter&&(u=b.RETURN,g=!1),c.keyCode===k.Escape&&(u=b.ESCAPE),c.keyCode===k.PageUp&&(u=b.PAGE_UP),c.keyCode===k.PageDown&&(u=b.PAGE_DOWN),c.keyCode===k.End&&(u=b.END),c.keyCode===k.Home&&(u=b.HOME),(c.keyCode===k.NumpadPlus||c.keyCode===171||c.keyCode===k.Equals)&&(u=b.PLUS,g=!1),(c.keyCode===k.NumpadMinus||c.keyCode===173||c.keyCode===k.Dash)&&(u=b.MINUS,g=!1),i.useArrowKeysToNavigate()&&(c.keyCode===k.LeftArrow&&(u=b.LEFT_ARROW),c.keyCode===k.UpArrow&&(u=b.UP_ARROW),c.keyCode===k.RightArrow&&(u=b.RIGHT_ARROW),c.keyCode===k.DownArrow&&(u=b.DOWN_ARROW))),u&&(g&&c.preventDefault(),this.extensionHost.publish(u))})}this.extensionHost.subscribe(w.EXIT_FULLSCREEN,()=>{this.isOverlayActive()&&this.extensionHost.publish(b.ESCAPE),this.extensionHost.publish(b.ESCAPE),this.extensionHost.publish(w.RESIZE)}),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.extensionHost.subscribeAll((l,c)=>{[w.LOAD,w.DROP,w.TOGGLE_FULLSCREEN,w.EXTERNAL_RESOURCE_OPENED,w.RELOAD].includes(l)||this.fire(l,c)}),this.extensionHost.subscribe(w.EXTERNAL_RESOURCE_OPENED,()=>{this.fire(w.EXTERNAL_RESOURCE_OPENED)}),this.extensionHost.subscribe(b.LOGIN_FAILED,()=>{this.showMessage(this.data.config.content.authorisationFailedMessage)}),this.extensionHost.subscribe(b.LOGIN,()=>{this.isLoggedIn=!0}),this.extensionHost.subscribe(b.LOGOUT,()=>{this.isLoggedIn=!1}),this.extensionHost.subscribe(b.BOOKMARK,()=>{this.bookmark()}),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,l=>{this.data.canvasIndex=l,this.lastCanvasIndex=this.helper.canvasIndex,this.helper.canvasIndex=l}),this.extensionHost.subscribe(b.CLOSE_LEFT_PANEL,()=>{i.$element.hasClass("loading")&&i.$element.removeClass("loading"),this.resize()}),this.extensionHost.subscribe(b.CLOSE_RIGHT_PANEL,()=>{this.resize()}),this.extensionHost.subscribe(b.COLLECTION_INDEX_CHANGE,l=>{this.data.collectionIndex=l}),this.extensionHost.subscribe(w.CREATED,()=>{this.isCreated=!0}),this.extensionHost.subscribe(b.ESCAPE,()=>{this.isFullScreen()&&!this.isOverlayActive()&&this.extensionHost.publish(w.TOGGLE_FULLSCREEN)}),this.extensionHost.subscribe(w.LOAD,()=>{setTimeout(()=>{this.extensionHost.publish(w.RESIZE),this.fire(w.LOAD,this.helper.getCurrentCanvas().id),this.$element.removeClass("loading")},100)}),this.extensionHost.subscribe(b.FEEDBACK,()=>{this.feedback()}),this.extensionHost.subscribe(b.FORBIDDEN,()=>{this.extensionHost.publish(b.OPEN_EXTERNAL_RESOURCE)}),this.extensionHost.subscribe(w.LOAD_FAILED,()=>{!i.lastCanvasIndex==null&&i.lastCanvasIndex!==i.helper.canvasIndex&&this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,i.lastCanvasIndex)}),this.extensionHost.subscribe(b.MANIFEST_INDEX_CHANGE,l=>{this.data.manifestIndex=l}),this.extensionHost.subscribe(b.OPEN,()=>{let l=Lt.format(this.data.config.options.openTemplate,this.helper.manifestUri);window.open(l)}),this.extensionHost.subscribe(b.OPEN_LEFT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(b.OPEN_RIGHT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(b.RANGE_CHANGE,l=>{l?(this.data.rangeId=l.id,this.helper.rangeId=l.id):(this.data.rangeId=void 0,this.helper.rangeId=void 0)}),this.extensionHost.subscribe(b.RESOURCE_DEGRADED,l=>{N.handleDegraded(l)}),this.extensionHost.subscribe(b.SHOW_MESSAGE,l=>{this.showMessage(l)}),this.extensionHost.subscribe(b.SHOW_TERMS_OF_USE,()=>{let l=this.helper.getLicense();if(!l){let c=this.helper.getRequiredStatement();c&&c.value&&(l=c.value)}l&&this.showMessage(l)}),this.extensionHost.subscribe(w.TOGGLE_FULLSCREEN,()=>{let l=this.data.config.options.overrideFullScreen;this.extensionHost.isFullScreen=!this.extensionHost.isFullScreen,l||(W("#top").focus(),this.extensionHost.isFullScreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")),this.fire(w.TOGGLE_FULLSCREEN,{isFullScreen:this.extensionHost.isFullScreen,overrideFullScreen:l})}),this.shell=new xt(this.$element),this.createModules(),this.extensionHost.publish(w.RESIZE),setTimeout(()=>{this.render(),this.extensionHost.publish(w.CREATED),this._setDefaultFocus()},1)}async loadConfig(i,l){let c=i;l&&(c="_",this.locales._=()=>import(`../../extensions/${l}/config/config.json`));let u=this.locales[c];if(!u)throw new Error("Unable to load config");return typeof u=="object"?u=JSON.parse(JSON.stringify(u)):typeof u=="function"&&(u=await u(),u=JSON.parse(JSON.stringify(u))),this.translateLocale(u,i)}async translateLocale(i,l){let c=await import(`../../../../locales/${l}.json`),u=JSON.stringify(i);for(let g in c){let o=g.replace("$",""),v=new RegExp(`\\$${o}\\b`,"g");u=u.replace(v,c[g])}return u=JSON.parse(u),u}createModules(){this.$authDialogue=W('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new vt(this.$authDialogue),this.$clickThroughDialogue=W('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new Et(this.$clickThroughDialogue),this.$restrictedDialogue=W('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new _t(this.$restrictedDialogue),this.$loginDialogue=W('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new bt(this.$loginDialogue)}_setDefaultFocus(){setTimeout(()=>{this.data.config.options.allowStealFocus&&W("[tabindex=0]").focus()},1)}width(){return this.$element.width()}height(){return this.$element.height()}exitFullScreen(){this.extensionHost.publish(w.EXIT_FULLSCREEN)}fire(i,...l){this.data.debug&&console.log(i,arguments[1]),this.extensionHost.fire(i,arguments[1])}redirect(i){this.fire(b.REDIRECT,i)}refresh(){this.fire(b.REFRESH,null)}render(){if((!this.isCreated||this.data.collectionIndex!==this.helper.collectionIndex)&&this.extensionHost.publish(b.COLLECTION_INDEX_CHANGE,this.data.collectionIndex),(!this.isCreated||this.data.manifestIndex!==this.helper.manifestIndex)&&this.data.iiifManifestId!==void 0&&this.extensionHost.publish(b.MANIFEST_INDEX_CHANGE,this.data.manifestIndex),(!this.isCreated||this.data.canvasIndex!==this.helper.canvasIndex)&&(this.data.canvasIndex===void 0&&(this.data.canvasIndex=0),this.data.canvasId&&(this.data.canvasIndex=this.helper.canvasIndex),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.data.canvasIndex)),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){let i=this.helper.getRangeById(this.data.rangeId);i?this.extensionHost.publish(b.RANGE_CHANGE,i):console.warn("range id not found:",this.data.rangeId)}}_initLocales(){let i=this.data.config.localisation.locales.slice(0),l=this.data.locales,c=[];l?(l.forEach(g=>{let o=i.filter(m=>m.name===g.name);if(o.length){var v=o[0];g.label&&(v.label=g.label),v.added=!0,c.push(v)}}),R.getBool(this.data.config.options.limitLocales,!1)||i.forEach(g=>{g.added||c.push(g),delete g.added}),this.data.locales=c):console.warn("No locales configured")}_parseMetrics(){let i=this.data.config.options.metrics;if(i)for(let l=0;l<i.length;l++){let c=i[l];this.metrics.push(c)}}_updateMetric(){setTimeout(()=>{for(let l=this.metrics.length-1;l>=0;l--){let c=this.metrics[l];if(window.innerWidth>=c.minWidth){if(this.metric!==c.type){this.metric=c.type;for(var i=0;i<this.metrics.length;i++)this.$element.removeClass(this.metrics[i].type);this.$element.addClass(c.type),this.extensionHost.publish(b.METRIC_CHANGE)}break}}},1)}resize(){this._updateMetric(),this.extensionHost.publish(w.RESIZE)}reload(i){this.extensionHost.publish(w.RELOAD,i)}isSeeAlsoEnabled(){return this.data.config.options.seeAlsoEnabled!==!1}getShareUrl(){if(this.data.embedded){if(this.helper.hasRelatedPage()){var i=this.helper.getRelated();return i&&i.length&&(i=i[0]),i["@id"]}let l=this.helper.manifest,c=l&&l.getHomepage();if(c)return c}else return X.isInIFrame()?parent.document.location.href:document.location.href;return null}getIIIFShareUrl(i=!1){let l;return i&&(this.helper.manifest?l=this.helper.manifest.id:l=this.helper.manifestUri),`${l}?manifest=${l}`}getDomain(){return V.getUrlParts(this.helper.manifestUri).host}getAppUri(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/uv.html"}getSettings(){if(R.getBool(this.data.config.options.saveUserSettings,!1)){let i=G.get("uv.settings",ut.LOCAL);if(i)return W.extend(this.data.config.options,i.value)}return this.data.config.options}updateSettings(i){if(R.getBool(this.data.config.options.saveUserSettings,!1)){let l=G.get("uv.settings",ut.LOCAL);l&&(i=W.extend(l.value,i)),G.set("uv.settings",i,31536e4,ut.LOCAL)}this.data.config.options=W.extend(this.data.config.options,i)}getLocale(){return this.helper.options.locale}getSharePreview(){let i=this.helper.getLabel(),l=this.helper.getCurrentCanvas(),c=l.getProperty("thumbnail");return(!c||typeof c!="string")&&(c=l.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:i,image:c}}getPagedIndices(i=this.helper.canvasIndex){return[i]}getCurrentCanvases(){let i=this.getPagedIndices(this.helper.canvasIndex),l=[];for(let c=0;c<i.length;c++){let u=i[c],g=this.helper.getCanvasByIndex(u);g&&l.push(g)}return l}getCanvasLabels(i){let l=this.getPagedIndices(),c="";if(l.length===1)c=i;else for(let u=1;u<=l.length;u++)c.length&&(c+=","),c+=i+" "+u;return c}getCurrentCanvasRange(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())}getExternalResources(i){let l=this.getPagedIndices(),c=[];l.forEach(o=>{let v=this.helper.getCanvasByIndex(o),m;if(v.externalResource?m=v.externalResource:m=new wt(v,{authApiVersion:this.data.config.options.authAPIVersion}),i){let a=i.find(p=>p.dataUri===m.dataUri);a?c.push(a):c.push(m)}else c.push(m)});let u=this.data.config.options.tokenStorage;return this.data.config.options.authAPIVersion===1?new Promise(o=>{let v={locale:this.helper.options.locale};rt.loadExternalResources(c,u,v).then(m=>{this.resources=m.map(a=>this._prepareResourceData(a)),o(this.resources)})}):new Promise(o=>{N.loadExternalResources(c,u).then(v=>{this.resources=v.map(m=>this._prepareResourceData(m)),o(this.resources)})})}_prepareResourceData(i){return i.data.hasServiceDescriptor=i.hasServiceDescriptor(),i.hasServiceDescriptor()||(i.data.id=i.dataUri,i.data.width=i.width,i.data.height=i.height),i.data.index=i.index,At.toPlainObject(i.data)}getMediaFormats(i){let l=i.getContent();return l&&l.length?l[0].getBody():[{id:i.id,type:i.getType(),getFormat:function(){return""}}]}viewCanvas(i){if(this.helper.isCanvasIndexOutOfRange(i)){this.showMessage(this.data.config.content.canvasIndexOutOfRange);return}this.extensionHost.publish(b.OPEN_EXTERNAL_RESOURCE)}showMessage(i,l,c,u){this.closeActiveDialogue(),this.extensionHost.publish(b.SHOW_GENERIC_DIALOGUE,{message:i,acceptCallback:l,buttonText:c,allowClose:u})}closeActiveDialogue(){this.extensionHost.publish(b.CLOSE_ACTIVE_DIALOGUE)}isOverlayActive(){return U(this.shell.$overlays)}isDesktopMetric(){return this.metric==="lg"||this.metric==="xl"}isMobileMetric(){return this.metric==="sm"||this.metric==="md"}viewManifest(i){let l={};l.iiifManifestId=this.helper.manifestUri,l.collectionIndex=this.helper.getCollectionIndex(i),l.manifestIndex=i.index,l.canvasIndex=0,this.reload(l)}viewCollection(i){let l={};l.iiifManifestId=i.parentCollection?i.parentCollection.id:this.helper.manifestUri,l.collectionIndex=i.index,l.manifestIndex=0,l.canvasIndex=0,this.reload(l)}isFullScreen(){return this.extensionHost.isFullScreen}isHeaderPanelEnabled(){return R.getBool(this.data.config.options.headerPanelEnabled,!0)}isLeftPanelEnabled(){if(R.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){let i=this.helper.getViewingHint();if(!i||i&&i!==Gt.ViewingHint.CONTINUOUS)return!0}}return!1}isRightPanelEnabled(){return R.getBool(this.data.config.options.rightPanelEnabled,!0)}isFooterPanelEnabled(){return R.getBool(this.data.config.options.footerPanelEnabled,!0)}isMobile(){let i=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}useArrowKeysToNavigate(){return R.getBool(this.data.config.options.useArrowKeysToNavigate,!0)}bookmark(){}feedback(){this.fire(b.FEEDBACK,this.data)}getAlternateLocale(){let i=null;return this.data.locales&&this.data.locales.length>1&&(i=this.data.locales[1]),i}getSerializedLocales(){return this.data.locales?this.serializeLocales(this.data.locales):null}serializeLocales(i){let l="";for(let c=0;c<i.length;c++){let u=i[c];c>0&&(l+=","),l+=u.name,u.label&&(l+=":"+u.label)}return l}changeLocale(i){let l={};if(this.data.locales){l.locales=this.data.locales.slice(0);let c=l.locales.findIndex(g=>g.name===i),u=0;l.locales.splice(u,0,l.locales.splice(c,1)[0]),this.reload(l)}}dispose(){this.store?.destroy()}},Vt=class{constructor(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]}init(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown",this.browser=="Explorer"&&this.version=="7"&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())}searchString(i){for(var l=0;l<i.length;l++){var c=i[l].string;if(this.versionSearchString=i[l].subString,c.indexOf(i[l].subString)!=-1)return i[l].identity}}searchVersion(i){var l=i.indexOf(this.versionSearchString);if(l!=-1)return parseFloat(i.substring(l+this.versionSearchString.length+1))}searchVersionIE(){var i=navigator.userAgent.toString().toLowerCase(),l=/(trident)(?:.*rv:([\w.]+))?/.exec(i)||/(msie) ([\w.]+)/.exec(i)||["",null,-1],c="unknown";return l!==null&&l.length===3&&l[2]&&(c=l[2].split(".")[0]),c}};var J=H(),Xt=class extends D{constructor(i){super(i)}create(){this.setConfig("footerPanel"),super.create(),this.extensionHost.subscribe(w.TOGGLE_FULLSCREEN,()=>{this.updateFullScreenButton(),this.extensionHost.isFullScreen||setTimeout(()=>{this.resize()},1001)}),this.extensionHost.subscribe(b.METRIC_CHANGE,()=>{this.updateMinimisedButtons(),this.updateMoreInfoButton()}),this.extensionHost.subscribe(b.SETTINGS_CHANGE,()=>{this.updateDownloadButton()}),this.$options=J('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=J(`
          <button class="feedback btn imageBtn" title="${this.content.feedback}">
            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>
            <span class="sr-only">${this.content.feedback}</span>
          </button>
        `),this.$options.prepend(this.$feedbackButton),this.$openButton=J(`
          <button class="open btn imageBtn" title="${this.content.open}">
            <i class="uv-icon-open" aria-hidden="true"></i>
            <span class="sr-only">${this.content.open}</span>
          </button>
        `),this.$options.prepend(this.$openButton),this.$bookmarkButton=J(`
          <button class="bookmark btn imageBtn" title="${this.content.bookmark}">
            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>
            <span class="sr-only">${this.content.bookmark}</span>
          </button>
        `),this.$options.prepend(this.$bookmarkButton),this.$shareButton=J(`
          <button class="share btn imageBtn" title="${this.content.share}">
            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>
            <span class="sr-only">${this.content.share}</span>
          </button>
        `),this.$options.append(this.$shareButton),this.$embedButton=J(`
          <button class="embed btn imageBtn" title="${this.content.embed}">
            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>
            <span class="sr-only">${this.content.embed}</span>
          </button>
        `),this.$options.append(this.$embedButton),this.$downloadButton=J(`
          <button class="download btn imageBtn" title="${this.content.download}" id="download-btn">
            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>
            <span class="sr-only">${this.content.download}</span>
          </button>
        `),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=J(`
          <button class="moreInfo btn imageBtn" title="${this.content.moreInfo}">
            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>
            <span class="sr-only">${this.content.moreInfo}</span>
          </button>
        `),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=J(`
          <button class="fullScreen btn imageBtn" title="${this.content.fullScreen}">
            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>
            <span class="sr-only">${this.content.fullScreen}</span>
          </button>
        `),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed(()=>{this.extensionHost.publish(b.OPEN)}),this.$feedbackButton.onPressed(()=>{this.extensionHost.publish(b.FEEDBACK)}),this.$bookmarkButton.onPressed(()=>{this.extensionHost.publish(b.BOOKMARK)}),this.$shareButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_SHARE_DIALOGUE,this.$shareButton)}),this.$embedButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_EMBED_DIALOGUE,this.$embedButton)}),this.$downloadButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_DOWNLOAD_DIALOGUE,this.$downloadButton)}),this.$moreInfoButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_MOREINFO_DIALOGUE,this.$moreInfoButton)}),this.onAccessibleClick(this.$fullScreenBtn,i=>{i.preventDefault(),this.extensionHost.publish(w.TOGGLE_FULLSCREEN)},!0),R.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()}updateMinimisedButtons(){if(R.getBool(this.options.minimiseButtons,!1)){this.$options.addClass("minimiseButtons");return}this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons")}updateMoreInfoButton(){}updateOpenButton(){R.getBool(this.options.openEnabled,!1)&&X.isInIFrame()?this.$openButton.show():this.$openButton.hide()}updateFullScreenButton(){if(!R.getBool(this.options.fullscreenEnabled,!0)||!X.supportsFullscreen()){this.$fullScreenBtn.hide();return}this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),J(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),J(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen))}updateEmbedButton(){this.extension.helper.isUIEnabled("embed")&&R.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()}updateShareButton(){this.extension.helper.isUIEnabled("share")&&R.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()}updateDownloadButton(){R.getBool(this.options.downloadEnabled,!0)?this.$downloadButton.show():this.$downloadButton.hide()}updateFeedbackButton(){R.getBool(this.options.feedbackEnabled,!1)?this.$feedbackButton.show():this.$feedbackButton.hide()}updateBookmarkButton(){R.getBool(this.options.bookmarkEnabled,!1)?this.$bookmarkButton.show():this.$bookmarkButton.hide()}resize(){super.resize()}};var ht=class{constructor(i,l){this.message=i;this.actions=l}};var Ct=class{constructor(){}};var $t=class{constructor(i){this.extension=i}Get(i){switch(i.informationType){case Y.AUTH_CORS_ERROR:return new ht(this.extension.data.config.content.authCORSError,[]);case Y.DEGRADED_RESOURCE:let l=[],c=new Ct,u;i.param.loginService?u=i.param.loginService.getConfirmLabel():u=i.param.kioskService.getConfirmLabel(),u||(u=this.extension.data.config.content.fallbackDegradedLabel||"login"),c.label=u;let g=i.param;c.action=()=>{i.param.loginService&&(g.authHoldingPage=window.open("","_blank")),this.extension.extensionHost.publish(b.HIDE_INFORMATION),this.extension.extensionHost.publish(b.OPEN_EXTERNAL_RESOURCE,[[g]])},l.push(c);let o;return i.param.loginService?o=i.param.loginService.getServiceLabel():o=i.param.kioskService.getServiceLabel(),o||(o=this.extension.data.config.content.fallbackDegradedMessage),new ht(o,l)}}};var et=H(),Zt=class extends D{constructor(i){super(i,!1,!1)}create(){this.setConfig("headerPanel"),super.create(),this.extensionHost.subscribe(b.SHOW_INFORMATION,i=>{this.showInformation(Array.isArray(i)?i[0]:i)}),this.extensionHost.subscribe(b.HIDE_INFORMATION,()=>{this.hideInformation()}),this.$options=et('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=et('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=et('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=et('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=et(`
          <button class="btn imageBtn settings" tabindex="0" title="${this.content.settings}">
            <i class="uv-icon-settings" aria-hidden="true"></i>
          </button>
        `),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=et('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",i=>{i.preventDefault(),this.extensionHost.publish(b.HIDE_INFORMATION)}),this.$localeToggleButton.on("click",()=>{this.extension.changeLocale(String(this.$localeToggleButton.data("locale")))}),this.$settingsButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_SETTINGS_DIALOGUE,this.$settingsButton)}),R.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()}updateLocaleToggle(){if(!this.localeToggleIsVisible()){this.$localeToggleButton.hide();return}let i=this.extension.getAlternateLocale(),l=i.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",i.name),this.$localeToggleButton.attr("title",i.label),this.$localeToggleButton.text(l)}updateSettingsButton(){R.getBool(this.options.settingsButtonEnabled,!0)?this.$settingsButton.show():this.$settingsButton.hide()}localeToggleIsVisible(){let i=this.extension.data.locales;return i?i.length>1&&R.getBool(this.options.localeToggleEnabled,!1):!1}showInformation(i){let l=new $t(this.extension);if(this.information=l.Get(i),!!this.information){var c=this.$informationBox.find(".message");c.html(this.information.message).find("a").attr("target","_top");var u=this.$informationBox.find(".actions");u.empty();for(let g=0;g<this.information.actions.length;g++){let o=this.information.actions[g],v=et('<a href="#" class="btn btn-default">'+o.label+"</a>");v.on("click",o.action),u.append(v)}this.extensionHost.publish(b.MESSAGE_DISPLAYED,this.information),this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()}}hideInformation(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()}getSettings(){return this.extension.getSettings()}updateSettings(i){this.extension.updateSettings(i),this.extensionHost.publish(b.UPDATE_SETTINGS,i)}resize(){super.resize();let l=this.$element.width()/2,c=this.$centerOptions.outerWidth(),u=l-c/2;if(this.$centerOptions.css({left:u}),U(this.$informationBox)){let g=this.$informationBox.find(".actions"),o=this.$informationBox.find(".message");o.width(Math.floor(this.$element.width())-Math.ceil(o.horizontalMargins())-Math.ceil(g.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),this.information&&o.text(this.information.message)}this.extension.isMobileMetric()?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()}};var Z=H(),at=class extends D{constructor(i){super(i,!1,!0);this.isExpanded=!1;this.isFullyExpanded=!1;this.isUnopened=!0;this.autoToggled=!1;this.expandFullEnabled=!0;this.reducedAnimation=!1}create(){super.create(),this.$top=Z('<div class="top"></div>'),this.$element.append(this.$top),this.$title=Z('<h2 class="title"></h2>'),this.$top.append(this.$title),this.$expandFullButton=Z('<a class="expandFullButton" tabindex="0"></a>'),this.$top.append(this.$expandFullButton),R.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=Z('<div role="button" class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=Z('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=Z('<a role="button" class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=Z('<a class="title"></a>'),this.$closed.append(this.$closedTitle),this.$main=Z('<div class="main"></div>'),this.$element.append(this.$main),this.onAccessibleClick(this.$expandButton,()=>{this.toggle()}),this.$expandFullButton.on("click",()=>{this.expandFull()}),this.$closedTitle.on("click",()=>{this.toggle()}),this.$title.on("click",()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.onAccessibleClick(this.$collapseButton,()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.$top.hide(),this.$main.hide(),this.extensionHost.subscribe(b.SETTINGS_CHANGE,i=>{this.reducedAnimation=i.reducedAnimation||!1})}init(){super.init()}setTitle(i){this.$title.text(i),this.$closedTitle.text(i)}toggle(i){i?this.autoToggled=!0:this.autoToggled=!1,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.reducedAnimation?(this.$element.css("width",this.getTargetWidth()),this.$element.css("left",this.getTargetLeft()),this.toggled()):this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,()=>{this.toggled()})}toggled(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1}expandFull(){this.isExpanded||this.toggled();var i=this.getFullTargetWidth(),l=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:i,left:l},this.options.panelAnimationDuration,()=>{this.expandFullFinish()})}collapseFull(){var i=this.getTargetWidth(),l=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:i,left:l},this.options.panelAnimationDuration,()=>{this.collapseFullFinish()})}getTargetWidth(){return 0}getTargetLeft(){return 0}getFullTargetWidth(){return 0}getFullTargetLeft(){return 0}toggleStart(){}toggleFinish(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()}expandFullStart(){}expandFullFinish(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()}collapseFullStart(){}collapseFullFinish(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()}focusExpandButton(){setTimeout(()=>{this.$expandButton.focus()},1)}focusExpandFullButton(){setTimeout(()=>{this.$expandFullButton.focus()},1)}focusCollapseButton(){setTimeout(()=>{this.$collapseButton.focus()},1)}resize(){super.resize(),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))}};var Tt=class extends at{constructor(i){super(i)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth)}init(){super.init(),R.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen)&&this.toggle(!0),this.extensionHost.subscribe(b.TOGGLE_EXPAND_RIGHT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}getTargetWidth(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth}getTargetLeft(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(b.OPEN_RIGHT_PANEL):this.extensionHost.publish(b.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})}resize(){super.resize(),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})}};var dt=it(jt()),Kt=H(),te=class extends Tt{constructor(i){super(i)}create(){this.setConfig("moreInfoRightPanel"),super.create(),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,()=>{this.databind()}),this.extensionHost.subscribe(b.RANGE_CHANGE,()=>{this.databind()}),this.setTitle(this.config.content.title),this.$metadata=Kt('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new dt.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",i=>{let l=V.getHashParameterFromString("rid",i),c=V.getHashParameterFromString("t",i);if(l&&c===null){let u=this.extension.helper.getRangeById(l);u&&this.extensionHost.publish(b.RANGE_CHANGE,u)}if(c!==null){let u=Number(c);if(!Number.isNaN(u))if(l){let g=this.extension.helper.getRangeById(l);g&&this.extensionHost.publish(b.RANGE_TIME_CHANGE,{rangeId:g.id,time:u})}else this.extensionHost.publish(b.CURRENT_TIME_CHANGE,u)}},!1)}toggleFinish(){super.toggleFinish(),this.databind()}databind(){this.metadataComponent.set(this._getData())}_getCurrentRange(){return this.extension.helper.getCurrentRange()}_getData(){let i=this.extension.getCurrentCanvases();return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:i,canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:R.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new Pt(this.content.license?this.content.license:{}),limit:this.config.options.textLimit||4,limitType:dt.LimitType.LINES,limitToRange:R.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:l=>j(l),showAllLanguages:this.config.options.showAllLanguages}}resize(){super.resize(),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())}};var st;(function(a){a[a.TOP_LEFT=0]="TOP_LEFT",a[a.TOP_CENTER=1]="TOP_CENTER",a[a.TOP_RIGHT=2]="TOP_RIGHT",a[a.CENTER_LEFT=3]="CENTER_LEFT",a[a.CENTER=4]="CENTER",a[a.CENTER_RIGHT=5]="CENTER_RIGHT",a[a.BOTTOM_LEFT=6]="BOTTOM_LEFT",a[a.BOTTOM_CENTER=7]="BOTTOM_CENTER",a[a.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(st||(st={}));var pt=H(),ee=class extends D{constructor(i){super(i,!1,!0);this.subtitleExpanded=!1;this.isAttributionOpen=!1;this.attributionPosition=st.BOTTOM_LEFT;this.isAttributionLoaded=!1}create(){super.create(),this.$title=pt('<h1 class="title"></h1>'),this.$element.append(this.$title),this.$subtitle=pt(`<div class="subtitle">
                                <div class="wrapper">
                                    <button type="button" class="expand-btn" aria-label="Expand">
                                        <span aria-hidden="true">+</span>
                                    </button>
                                    <span class="text"></span>
                                </div>
                            </div>`),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=pt('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$attribution=pt(`
                                <div class="attribution">
                                  <div class="header">
                                    <div class="title"></div>
                                    <button type="button" class="close" aria-label="Close">
                                      <span aria-hidden="true">&#215;</span>
                                    </button>
                                  </div>
                                  <div class="main">
                                    <div class="attribution-text"></div>
                                    <div class="license"></div>
                                    <div class="logo"></div>
                                  </div>
                                </div>
        `),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",i=>{i.preventDefault(),this.closeAttribution()}),this.$subtitleExpand.on("click",i=>{i.preventDefault(),this.subtitleExpanded=!this.subtitleExpanded,this.subtitleExpanded?(this.$subtitleWrapper.addClass("expanded"),this.$subtitleExpand.text("-")):(this.$subtitleWrapper.removeClass("expanded"),this.$subtitleExpand.text("+")),this.resize()}),R.getBool(this.options.titleEnabled,!0)?this.$title.show():this.$title.hide(),R.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.show():this.$subtitle.hide(),this.whenResized(()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(b.RANGE_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(b.MANIFEST_INDEX_CHANGE,()=>{this.updateRequiredStatement()})}openAttribution(){this.$attribution.show(),this.isAttributionOpen=!0}closeAttribution(){this.$attribution.hide(),this.isAttributionOpen=!1}updateRequiredStatement(){if(this.isAttributionLoaded)return;let i=R.getBool(this.config.options.mostSpecificRequiredStatement,!1),l=i?this.extension.helper.getMostSpecificRequiredStatement():this.extension.helper.getRequiredStatement(),c=R.getBool(this.options.requiredStatementEnabled,!0);if(!l||!l.value||!c)return;this.openAttribution();let u=this.$attribution.find(".title"),g=this.$attribution.find(".attribution-text"),o=this.$attribution.find(".license"),v=this.$attribution.find(".logo");if(l.label){let m=j(l.label);u.html(m)}else u.text(this.content.attribution);if(l.value){let m=j(l.value);g.html(m);let a=()=>this.resize();g.find("img").one("load",()=>{this.resize()}).each(function(){this.complete&&a()}),g.find("img").one("error",()=>{a()}),g.targetBlank()}o.hide(),v.hide(),this.resize(),i||(this.isAttributionLoaded=!0)}resize(){super.resize();let i=U(this.extension.shell.$leftPanel)?Math.floor(this.extension.shell.$leftPanel.width()):0,l=U(this.extension.shell.$rightPanel)?Math.floor(this.extension.shell.$rightPanel.width()):0,c=Math.floor(this.$element.parent().width()-i-l);this.$element.css({left:i,width:c});let u,g;this.options&&this.options.titleEnabled===!1||!U(this.$title)?u=0:u=this.$title.outerHeight(!0),this.options&&this.options.subtitleEnabled===!1||!U(this.$subtitle)?g=0:g=this.$subtitle.outerHeight(!0),this.$content.height(this.$element.height()-u-g),this.$content.width(this.$element.width());let o=this.$attribution.find(".attribution-text");if(o.css("maxHeight",`calc(${this.$content.height()}px - 100px)`),o.css("overflow-y","auto"),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case st.BOTTOM_LEFT:this.$attribution.css("bottom",0),this.$attribution.css("left",0);break;case st.BOTTOM_RIGHT:this.$attribution.css("bottom",0),this.$attribution.css("right",0);break}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(j(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.show(),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.hide()}};var ie=class extends at{constructor(i){super(i)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth),this.extensionHost.subscribe(b.TOGGLE_EXPAND_LEFT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}init(){super.init(),R.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen)&&this.toggle(!0)}getTargetWidth(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth}getFullTargetWidth(){return this.$element.parent().width()}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(b.OPEN_LEFT_PANEL):this.extensionHost.publish(b.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})}resize(){super.resize(),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())}};var q=H(),ne=class extends F{constructor(i){super(i)}create(){this.setConfig("settingsDialogue"),super.create(),this.openCommand=b.SHOW_SETTINGS_DIALOGUE,this.closeCommand=b.HIDE_SETTINGS_DIALOGUE;let i;this.extensionHost.subscribe(this.openCommand,l=>{i=l,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{i&&i.focus(),this.close()}),this.$title=q('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$scroll=q('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=q('<div class="version"></div>'),this.$content.append(this.$version),this.$website=q('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=q('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=q('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=q('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this._createAccessibilityMenu(),this.$element.hide()}getSettings(){return this.extension.getSettings()}updateSettings(i){this.extension.updateSettings(i),this.extensionHost.publish(b.UPDATE_SETTINGS,i)}open(){super.open(),this.$version.text("v"+process.env.PACKAGE_VERSION)}_createLocalesMenu(){let i=this.extension.data.locales;if(i&&i.length>1){for(let l=0;l<i.length;l++){let c=i[l];this.$localeDropDown.append('<option value="'+c.name+'">'+c.label+"</option>")}this.$localeDropDown.val(i[0].name)}else this.$locale.hide();this.$localeDropDown.change(()=>{this.extension.changeLocale(this.$localeDropDown.val())})}resize(){super.resize()}_createAccessibilityMenu(){this.$reducedAnimation=q('<div class="setting reducedAnimation"></div>'),this.$scroll.append(this.$reducedAnimation),this.$reducedAnimationCheckbox=q('<input id="reducedAnimation" type="checkbox" tabindex="0" />'),this.$reducedAnimation.append(this.$reducedAnimationCheckbox),this.$reducedAnimationLabel=q('<label for="reducedAnimation">'+this.content.reducedMotion+"</label>"),this.$reducedAnimation.append(this.$reducedAnimationLabel),this.$reducedAnimationCheckbox.change(()=>{let i={};this.$reducedAnimationCheckbox.is(":checked")?i.reducedAnimation=!0:i.reducedAnimation=!1,this.updateSettings(i)})}};var B=H(),se=class extends F{constructor(i){super(i);this.aspectRatio=.75;this.isEmbedViewVisible=!1;this.isShareViewVisible=!1;this.maxWidth=8e3;this.maxHeight=this.maxWidth*this.aspectRatio;this.minWidth=200;this.minHeight=this.minWidth*this.aspectRatio;this.shareManifestsEnabled=!1}create(){this.setConfig("shareDialogue"),super.create(),this.openCommand=b.SHOW_SHARE_DIALOGUE,this.closeCommand=b.HIDE_SHARE_DIALOGUE,this.shareManifestsEnabled=this.options.shareManifestsEnabled||!1;let i;this.extensionHost.subscribe(this.openCommand,c=>{i=c,this.open(c),this.isShareAvailable()?this.openShareView():this.openEmbedView()}),this.extensionHost.subscribe(this.closeCommand,()=>{i&&i.focus(),this.close()}),this.extensionHost.subscribe(b.SHOW_EMBED_DIALOGUE,c=>{this.open(c),this.openEmbedView()}),this.$tabs=B('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=B('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),R.getBool(this.config.options.shareEnabled,!0)&&this.$tabs.append(this.$shareButton),this.$embedButton=B('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),R.getBool(this.config.options.embedEnabled,!1)&&this.$tabs.append(this.$embedButton),this.$tabsContent=B('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=B('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=B('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=B('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=B('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=B(`<input class="shareInput" type="text" readonly="readonly" aria-label="${this.content.shareUrl}"/>`),this.$shareView.append(this.$shareInput),this.$shareFrame=B('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=B('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=B('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=B(`<input class="code" type="text" readonly="readonly" aria-label="${this.content.embed}"/>`),this.$embedView.append(this.$code),this.$customSize=B('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=B('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=B('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=B('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=B('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=B('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);let l=this.extension.getIIIFShareUrl(this.shareManifestsEnabled);this.shareManifestsEnabled&&(this.$iiifButton=B('<a class="imageBtn iiif" href="'+l+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton)),this.$termsOfUseButton=B('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",c=>gt.numericalInput(c)),this.$heightInput.on("keydown",c=>gt.numericalInput(c)),this.$shareInput.focus(function(){B(this).select()}),this.$code.focus(function(){B(this).select()}),this.onAccessibleClick(this.$shareButton,()=>{this.openShareView()}),this.onAccessibleClick(this.$embedButton,()=>{this.openEmbedView()}),this.$customSizeDropDown.change(()=>{this.update()}),this.$widthInput.change(()=>{this.updateHeightRatio(),this.update()}),this.$heightInput.change(()=>{this.updateWidthRatio(),this.update()}),this.onAccessibleClick(this.$termsOfUseButton,()=>{this.extensionHost.publish(b.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.update()}open(i){super.open(i),this.update()}getShareUrl(){return this.extension.getShareUrl()}isShareAvailable(){return!!this.getShareUrl()}update(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();let i=this.getSelectedSize();i.val()==="custom"?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number(i.data("width")),this.currentHeight=Number(i.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()}updateShareOptions(){let i=this.getShareUrl();i&&(this.$shareInput.val(i),this.$shareLink.prop("href",i),this.$shareLink.text(i)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())}updateInstructions(){R.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())}getSelectedSize(){return this.$customSizeDropDown.find(":selected")}updateWidthRatio(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))}updateHeightRatio(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))}updateShareFrame(){let i=this.extension.helper.getShareServiceUrl();!i||(R.getBool(this.config.options.shareFrameEnabled,!0)&&i?(this.$shareFrame.prop("src",i),this.$shareFrame.show()):this.$shareFrame.hide())}updateTermsOfUseButton(){let i=this.extension.helper.getRequiredStatement();R.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&i&&i.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}openShareView(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()}openEmbedView(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()}close(){super.close()}getViews(){return this.$tabsContent.find(".view")}equaliseViewHeights(){this.getViews().equaliseHeight(!0)}resize(){this.equaliseViewHeights(),this.setDockedPosition()}};export{D as a,st as b,ee as c,F as d,k as e,Yt as f,ie as g,Xt as h,Zt as i,jt as j,te as k,ne as l,se as m};
