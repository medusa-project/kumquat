
- provide :body_id, "search"
- provide :title, "Digital Special Collections"

- active_tab = params[:tab] || 'all-items'

:javascript
  $(document).ready(function() {
    // Initialize facets for search_landing page (non-AJAX version)
    const filterForm = $("form.dl-filter");
    
    const createHiddenInputs = function() {
      // Remove existing hidden fq inputs
      filterForm.find('[name="fq[]"]').remove();
      // Create hidden input for each checked checkbox
      filterForm.find('[name=dl-facet-term]:checked').each(function() {
        const input = $('<input type="hidden" name="fq[]">');
        input.val($(this).data('query'));
        filterForm.append(input);
      });
    };
    
    // Handle facet checkbox changes
    filterForm.find('.dl-card-facet [name="dl-facet-term"]').on('change', function() {
      createHiddenInputs();
      filterForm.submit();
    });
    
    // Handle modal facet submissions
    filterForm.find('.dl-modal-facet .modal-footer button.submit').on('click', function(e) {
      e.preventDefault();
      const modal = $(this).parents(".dl-modal-facet");
      modal.modal('hide');
      createHiddenInputs();
      filterForm.submit();
    });
  });

.row
  .col-12
    .card.mb-3
      .card-body
        %ul.nav.nav-pills{role: "tablist"}
          %li.nav-item{role: "presentation"}
            = link_to "All Collections", search_landing_path(tab: 'all-items'), class: "nav-link #{'active' if active_tab == 'all-items'}", role: "tab"
          %li.nav-item{role: "presentation"}
            = link_to "Simple Search", search_landing_path(tab: 'simple-search', q: @permitted_params[:q]), class: "nav-link #{'active' if active_tab == 'simple-search'}", role: "tab"
          %li.nav-item{role: "presentation"}
            = link_to "Advanced Search", search_landing_path(tab: 'advanced-search'), class: "nav-link #{'active' if active_tab == 'advanced-search'}", role: "tab"

.tab-content
  #all-items.tab-pane.fade{class: [('show active' if active_tab == 'all-items')], role: "tabpanel"}
    .row.justify-content-md-center.mt-4
      .col-md-auto
        = paginate(@count, @limit, @current_page, SearchLandingController::PERMITTED_PARAMS)

    .row
      .col-sm-3.col-lg-2
        .facets
          = facets_as_cards(@facets, SearchLandingController::PERMITTED_PARAMS)

      .col-sm-9.col-lg-10
        .card.dl-results-summary
          .card-body
            .row
              #dl-search-status.col-sm-8
                = search_status(@count, @start, @num_results_shown)
                
        .search-results-list
          - if @items.present?
            - @items.each do |item|
              .search-result-item.mb-4.d-flex 
                = thumbnail_tag(item, shape: :square, size: 150)
                .search-result-details.flex-grow-1 
                  =link_to "#{item.title}", item_path(item), class: 'h5 d-block mb-2'
                  %h6= item.element(:creator)
          - else 
            %p.mt-4.text-muted No items found.

  #simple-search.tab-pane.fade{class: [('show active' if active_tab == 'simple-search')], role: "tabpanel"}
    .row.justify-content-md-center.mt-4
      .col-md-6
        = form_tag(search_landing_path, method: :get) do
          .input-group.filter-field
            = search_field_tag(:q, @permitted_params[:q], class: "form-control", 'aria-label': 'Simple Search')
            .input-group-append
              = submit_tag("Search", class: "btn btn-primary")
          = hidden_field_tag(:tab, 'simple-search')
    - if @permitted_params[:q].present?
      .row.justify-content-md-center.mt-4
        .col-md-auto
          = paginate(@count, @limit, @current_page, SpecialCollectionsSearchController::PERMITTED_PARAMS)
      .container.mt-4
        .card.dl-results-summary
          .card-body
            .row
              #dl-search-status.col-sm-8
                = search_status(@count, @start, @num_results_shown)
        .search-results-list.mt-4
          - if @items.present?
            - @items.each do |item|
              .search-result-item.mb-4.d-flex 
                = thumbnail_tag(item, shape: :square, size: 150)
                .search-result-details.flex-grow-1 
                  =link_to "#{item.title}", item_path(item), class: 'h5 d-block mb-2'
                  %h6= item.element(:creator)
          - else
            %p.text-muted No items found.

  #advanced-search.tab-pane.fade{class: [('show active' if active_tab == 'advanced-search')], role: "tabpanel"}
    .row.justify-content-md-center.mt-4
      .col-md-8
        %p.text-center.text-muted Advanced search content will go here